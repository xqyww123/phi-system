<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹library/phi_type_algebra/guess_semimodule.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹library/phi_type_algebra/guess_semimodule.ML›</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>PHI_TYPE_ALGEBRA_DERIVERS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>include</span></span></span><span> </span><span class="entity"><span>PHI_TYPE_ALGEBRA_DERIVERS</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> parse_semimodule_phityp' </span><span class="main"><span>:</span></span><span> </span><span>typ</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> * </span><span>typ</span><span> </span><span>option</span><span> * </span><span>typ</span><span> * </span><span>typ</span><span> </span><span>option</span><span> * </span><span>typ</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> parse_semimodule_phityp </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span>
                           </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Type.phi_type</span></span><span>
                           </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>sort</span><span> * </span><span>sort</span><span class="main"><span>)</span></span><span> </span><span>option</span><span> </span><span class="comment1"><span>(*optionally lift the types to (sort_scalar, sort_model)*)</span></span><span>
                           </span><span class="main"><span>-&gt;</span></span><span> </span><span>typ</span><span> * </span><span>typ</span><span> </span><span>option</span><span> * </span><span>typ</span><span> * </span><span>typ</span><span> </span><span>option</span><span> * </span><span>typ</span><span> * </span><span class="entity"><span>Phi_Type.phi_type</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> Guess_Scalar_Zero </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>guess_property</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> Guess_Scalar_One </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>guess_property</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> Guess_Scalar_Assoc </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>guess_property</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> Guess_Zip_of_Semimodule </span><span class="main"><span>:</span></span><span> </span><span>bool</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>guess_property</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Phi_Type_Derivers</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>PHI_TYPE_ALGEBRA_DERIVERS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Phi_Type</span><span> </span><span>Phi_Type_Derivers</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_semimodule_phityp'</span></span><span> </span><span class="entity"><span>ty</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>reversed_argtys'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_parameterized_phi_ty</span></span><span> </span><span class="entity"><span>ty</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>err_parse</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Automation_Fail</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Pretty</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                            </span><span class="main"><span>[</span></span><span>para</span><span> </span><span class="inner_quoted"><span>"I only accept the semimodule φ-type giving its element φ-type as \
                                  \its last parameter and the sclara as its second last paramter. \
                                  \However, the parameters of the given φ-type does not seem to meet \
                                  \this requirement."</span></span><span class="main"><span>]</span></span><span>
                        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x_ele_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_model_ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>reversed_argtys'</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="entity"><span>x_ele_ty</span></span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.BI|type"><span>BI</span></a><span> </span><span class="entity"><span>T_model_ty</span></span><span>›</span></span></span><span>›</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>s_ty</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>x_ele_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>T_model_ty</span></span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>err_parse</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ele_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty0</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_semimodule_phityp</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>phi0</span></span><span> </span><span class="entity"><span>lift_sorts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ele_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_model_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>parse_semimodule_phityp'</span></span><span> </span><span class="main"><span>(</span></span><span>Term.fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>term </span><span class="entity"><span>phi0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ele_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>lift_sorts</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sort_scalar</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sort_model</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lift_types_sort</span></span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                                                 </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>s_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sort_scalar</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>model_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sort_model</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>inst'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Phi_Help.certify_tyvars</span></span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>inst</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s_ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term_Subst.instantiateT</span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>s_ty0</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term_Subst.instantiateT</span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>x_ty0</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>model_ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term_Subst.instantiateT</span><span> </span><span class="entity"><span>inst</span></span><span> </span><span class="entity"><span>model_ty0</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T_model_ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>Term_Subst.instantiateT</span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_model_ty0</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>instantiate_phi</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst'</span></span><span class="main"><span>,</span></span><span>Vars.empty</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi0</span></span><span>
                   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ele_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ele_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_model_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi0</span></span><span class="main"><span>)</span></span><span>

   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ele_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(*TODO: extend me! return x_ele_ty!*)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>Guess_Scalar_framework</span></span><span> </span><span class="entity"><span>involve_T</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sorts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_goal_term_and_parse_result</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>Guess_Framework</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ele_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>parse_semimodule_phityp</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>sorts</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>maxidx_of_phi</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>FT_term</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fix_phi_term_params</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>parse_fail</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Automation_Fail</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Pretty</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
                              </span><span class="main"><span>[</span></span><span>para</span><span> </span><span class="inner_quoted"><span>"Fail to parse the φ-type as a module φ-type"</span></span><span class="main"><span>]</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>opt_T_term</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_term</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>involve_T</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>separate_module_tyopr</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>FT_term</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>parse_fail</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>separate_scalar_tyopr</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>FT_term</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>parse_fail</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
  
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eta_F_term</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"unfolded_F"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Term.fastype_of</span><span> </span><span class="entity"><span>F_term</span></span><span class="main"><span>)</span></span><span>
</span><span class="comment1"><span>(*Abs ("s", s_ty, Abs ("T", Term.fastype_of T_term, Abs ("x", x_ty,
                            <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹φType x_ty model_ty› $ Bound 0 $ (Term.incr_boundvars 3 F_term $ Bound 2 $ Bound 1))))*)</span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goal_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>parse_result</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="entity"><span>mk_goal_term_and_parse_result</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ele_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eta_F_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>opt_T_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>goal_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>parse_result</span></span><span> </span><span>o</span><span> </span><span>Thm.prop_of</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(*
fun Guess_Scalar_framework (unfold_place, sorts, mk_goal_term_and_parse_result)
                           (phi : phi_type) ctxt =
  let val (s_ty, x_ele_ty, x_ty, T_model_ty, model_ty, phi) = parse_semimodule_phityp ctxt phi sorts
      val module_ty = s_ty --&gt; mk_phi_type_ty (model_ty, x_ele_ty) --&gt; mk_phi_type_ty (model_ty, x_ty)
      val idx = maxidx_of_phi phi ~1 + 1
      val ((_, FT_term), ctxt) = fix_phi_term_params (#term phi) ctxt
      val (F_term $ _ $ T_term) = FT_term

      val eta_F_term = Abs ("s", s_ty, Abs ("T", Term.fastype_of T_term, Abs ("x", x_ty,
                          <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹φType x_ty model_ty› $ Bound 0 $ (Term.incr_boundvars 3 F_term $ Bound 2 $ Bound 1))))
      val (goal_term, parse_result) =
              mk_goal_term_and_parse_result (s_ty, x_ele_ty, x_ty, T_model_ty, model_ty, module_ty, idx, F_term, eta_F_term, T_term, ctxt)
      val reason = Conv.gconv_rule (HOLogic.Trueprop_conv (funpow unfold_place Conv.fun_conv (Conv.arg1_conv (
                      Conv.abs_conv (Conv.abs_conv (Conv.abs_conv (fn (_, ctxt) =&gt;
                      fn ctm =&gt; Conv.rewrs_conv (map (fn th =&gt; th RS' (ctxt, @{thm' HOL.eq_reflection}))
                                           (#equations phi)) ctm) o snd) o snd) ctxt
                      )))) 1
                #&gt; Phi_Reasoner.reason NONE NONE ctxt
   in case Phi_Help.reason_tracing_tyinst ctxt reason goal_term
        |&gt; Option.map (apsnd (simplify_guessing_reasoning ctxt))
   of SOME (inst, ret) =&gt;
        let val (prop, params, conds, ants) = parse_result (Thm.prop_of ret)
            val ants = constrain_antecedents conds ants
            val (inst'2, ctxt) = Variable.import_inst true (prop :: ants) ctxt
            val (prop :: ants) = map (Term_Subst.instantiate inst'2) (prop :: ants)
            val params = map (Option.map (Term_Subst.instantiate inst'2)) params
         in Seq.single (ants, prop, params,
                        phi |&gt; instantiate_phi (inst, Vars.empty)
                            |&gt; instantiate_phi (Phi_Help.certify_vars (Context.Proof ctxt) inst'2),
                        ctxt)
        end
    | NONE =&gt; guess_fail ctxt phi (K [])
  end
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>Guess_Scalar_Zero</span></span><span> </span><span class="entity"><span>is_closed</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Guess_Scalar_framework</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.type|class"><span>type</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/Groups.html#Groups.one|class"><span>one</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eta_F_term</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.Trueprop</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Guess_Scalar_Zero|const"><span>Guess_Scalar_Zero</span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>s_ty</span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span>model_ty</span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span><span>›</span></span><span>
              </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>s_ty</span></span><span>›</span></span><span>
              </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>model_ty</span></span><span>›</span></span><span>
              </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>x_ty</span></span><span>›</span></span><span>
              </span><span>$</span><span> </span><span class="entity"><span>F_term</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>eta_F_term</span></span><span>
              </span><span>$</span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"zero"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s_ty</span></span><span class="main"><span>)</span></span><span>
              </span><span>$</span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"ants"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
              </span><span>$</span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"conds"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
           </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*Trueprop*)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*Guess_Scalar_Zero*)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ty_s</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ty_model</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ty_x</span></span><span>
                  </span><span>$</span><span> </span><span class="entity"><span>F</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>zero</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ants</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>conds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.dest_type</span><span> </span><span class="entity"><span>ty_s</span></span><span class="main"><span>,</span></span><span> </span><span>Logic.dest_type</span><span> </span><span class="entity"><span>ty_model</span></span><span class="main"><span>,</span></span><span> </span><span>Logic.dest_type</span><span> </span><span class="entity"><span>ty_x</span></span><span class="main"><span>)</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.Trueprop</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>
                      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_closed</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Closed_Module_Zero|const"><span>Closed_Module_Zero</span></a><span> </span><span class="entity"><span class="entity"><span>s_ty</span></span></span><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span class="entity"><span>model_ty</span></span><span>›</span></span><span>
                                    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Module_Zero|const"><span>Module_Zero</span></a><span> </span><span class="entity"><span class="entity"><span>s_ty</span></span></span><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span class="entity"><span>model_ty</span></span><span>›</span></span><span class="main"><span>)</span></span><span>
                        </span><span>$</span><span> </span><span class="entity"><span>F</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>zero</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                   </span><span>NONE</span><span> </span><span>::</span><span> </span><span class="entity"><span>parse_inst_params_from_phi_term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>F</span></span><span> </span><span>$</span><span> </span><span>Term.dummy</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                   </span><span class="entity"><span>conds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ants</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>Guess_Scalar_One</span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Guess_Scalar_framework</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ele_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eta_F_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_term</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>a1_ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>TVar</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"a<span class="hidden">⇩</span><sub>1</sub>"</span></span><span class="main"><span>,</span></span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.type|class"><span>type</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>xL</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>a1_ty</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>x_ty</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>xR</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>a1_ty</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x_ele_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_term</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x_ele_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_term</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span class="entity"><span>b</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Automation_Fail</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>›</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Guess_Scalar_One\&lt;^sub&gt;I|const"><span>Guess_Scalar_One<span class="hidden">⇩</span><sub>I</sub></span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>s_ty</span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span>T_model_ty</span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>model_ty</span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span>x_ele_ty</span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>a1_ty</span></span></span></span></span><span>›</span></span><span>
                           </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Guess_Scalar_One\&lt;^sub&gt;E|const"><span>Guess_Scalar_One<span class="hidden">⇩</span><sub>E</sub></span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>s_ty</span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span>T_model_ty</span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>model_ty</span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span>x_ele_ty</span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span>a1_ty</span></span></span><span>›</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>s_ty</span></span><span>›</span></span><span>
                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>T_model_ty</span></span><span>›</span></span><span>
                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>model_ty</span></span><span>›</span></span><span>
                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>x_ele_ty</span></span><span>›</span></span><span>
                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>x_ty</span></span><span>›</span></span><span>
                </span><span>$</span><span> </span><span class="entity"><span>F_term</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>eta_F_term</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>T_term</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"T<span class="hidden">⇩</span><sub>1</sub>"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Phi_Syntax.mk_phi_type_ty</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>a1_ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"one"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s_ty</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Dx"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xL</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"f"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xL</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>xR</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"P"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>xL</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"ants"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"conds"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*Trueprop*)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*Guess_Scalar_One*)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ty_s</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ty_model</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ty_x</span></span><span>
                    </span><span>$</span><span> </span><span class="entity"><span>F</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>T1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>one</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Dx</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>P</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ants</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>conds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                        </span><span class="main"><span>(</span></span><span>Logic.dest_type</span><span> </span><span class="entity"><span>ty_s</span></span><span class="main"><span>,</span></span><span> </span><span>Logic.dest_type</span><span> </span><span class="entity"><span>ty_model</span></span><span class="main"><span>,</span></span><span> </span><span>Logic.dest_type</span><span> </span><span class="entity"><span>ty_x</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ty_x_1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>domain_type</span><span> </span><span class="main"><span>(</span></span><span>Term.fastype_of</span><span> </span><span class="entity"><span>T1</span></span><span class="main"><span>)</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.Trueprop</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Module_One\&lt;^sub&gt;I|const"><span>Module_One<span class="hidden">⇩</span><sub>I</sub></span></a><span> </span><span class="entity"><span class="entity"><span>s_ty</span></span></span><span> </span><span class="entity"><span class="entity"><span>x_ty</span></span></span><span> </span><span class="entity"><span class="entity"><span>model_ty</span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>ty_x_1</span></span></span></span></span><span>›</span></span><span>
                                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Module_One\&lt;^sub&gt;E|const"><span>Module_One<span class="hidden">⇩</span><sub>E</sub></span></a><span> </span><span class="entity"><span class="entity"><span>s_ty</span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span>model_ty</span></span></span><span> </span><span class="entity"><span class="entity"><span>ty_x_1</span></span></span><span>›</span></span><span class="main"><span>)</span></span><span>
                        </span><span>$</span><span> </span><span class="entity"><span>F</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>T1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>one</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Dx</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                   </span><span>NONE</span><span> </span><span>::</span><span> </span><span class="entity"><span>parse_inst_params_from_phi_term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>F</span></span><span> </span><span>$</span><span> </span><span>Term.dummy</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                   </span><span class="entity"><span>conds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ants</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
       </span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>Guess_Scalar_Assoc</span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Guess_Scalar_framework</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ele_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eta_F_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>T_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>x_ele_ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the</span><span> </span><span class="entity"><span>x_ele_ty</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T_model_ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the</span><span> </span><span class="entity"><span>T_model_ty</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T_term</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>the</span><span> </span><span class="entity"><span>T_term</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ct</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>TVar</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"c<span class="hidden">⇩</span><sub>t</sub>"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.type|class"><span>type</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>st</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>TVar</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"s<span class="hidden">⇩</span><sub>s</sub>"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.type|class"><span>type</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>TVar</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"s<span class="hidden">⇩</span><sub>t</sub>"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.type|class"><span>type</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>at</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>as_t</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>TVar</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"a<span class="hidden">⇩</span><sub>t</sub>"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.type|class"><span>type</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>TVar</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"a<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>t</sub>"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.type|class"><span>type</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Fs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ft</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"F<span class="hidden">⇩</span><sub>s</sub>"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>mk_phi_type_ty</span></span><span class="main"><span>(</span></span><span class="entity"><span>ct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>at</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>mk_phi_type_ty</span></span><span class="main"><span>(</span></span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>as_t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"F<span class="hidden">⇩</span><sub>t</sub>"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>mk_phi_type_ty</span></span><span class="main"><span>(</span></span><span class="entity"><span>T_model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ele_ty</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>mk_phi_type_ty</span></span><span class="main"><span>(</span></span><span class="entity"><span>ct</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>at</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>as_t</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>TVar</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"a<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>t</sub>"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.type|class"><span>type</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>›</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Guess_Scalar_Assoc\&lt;^sub&gt;I|const"><span>Guess_Scalar_Assoc<span class="hidden">⇩</span><sub>I</sub></span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>s_ty</span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>T_model_ty</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>model_ty</span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>x_ele_ty</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>ss</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span>at</span></span></span><span> </span><span class="entity"><span class="entity"><span>ct</span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span>as_t</span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>st</span></span></span></span></span></span><span>›</span></span><span>
                               </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Guess_Scalar_Assoc\&lt;^sub&gt;E|const"><span>Guess_Scalar_Assoc<span class="hidden">⇩</span><sub>E</sub></span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>s_ty</span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>T_model_ty</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>model_ty</span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>x_ele_ty</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>ss</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span>at</span></span></span><span> </span><span class="entity"><span class="entity"><span>ct</span></span></span><span> </span><span class="entity"><span class="entity"><span>as_t</span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>st</span></span></span></span></span></span><span>›</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>s_ty</span></span><span>›</span></span><span>
                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>T_model_ty</span></span><span>›</span></span><span>
                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>model_ty</span></span><span>›</span></span><span>
                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>x_ele_ty</span></span><span>›</span></span><span>
                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>x_ty</span></span><span>›</span></span><span>
                </span><span>$</span><span> </span><span class="entity"><span>Fs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Ft</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>F_term</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>eta_F_term</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>T_term</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Ds"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Dt"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>st</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Dx"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>st</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>as_t</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"smul"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>st</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>s_ty</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"f"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ss</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>st</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>as_t</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>as_t</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"ants"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"conds"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>

             </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*Trueprop*)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*Guess_Scalar_Assoc*)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span>
                    </span><span>$</span><span> </span><span class="entity"><span>Fs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Ft</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Fc</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>T</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Dt</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Dx</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>smul</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ants</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>conds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="entity"><span>ss'</span></span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="entity"><span>st'</span></span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="entity"><span>t1</span></span><span> </span><span class="entity"><span>t2</span></span><span>›</span></span></span><span>›</span></span></span><span>›</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.fastype_of</span><span> </span><span class="entity"><span>f</span></span><span>
                     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>as_t'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ast'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>t2</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>t1</span></span><span class="main"><span>)</span></span><span>
                     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="entity"><span>a'</span></span><span> </span><span class="quoted"><span>‹</span><span>Type</span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>c'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>›</span></span><span>›</span></span></span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="entity"><span>at'</span></span><span> </span><span class="quoted"><span>‹</span><span>Type</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ct'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>›</span></span><span>›</span></span></span><span>›</span></span></span><span>›</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.fastype_of</span><span> </span><span class="entity"><span>Ft</span></span><span>
                     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="entity"><span>sc'</span></span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="quoted"><span>‹</span><span>Type</span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>cst'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>›</span></span><span>›</span></span></span><span>›</span></span></span><span>›</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.fastype_of</span><span> </span><span class="entity"><span>Fc</span></span><span>
                     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>head</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Module_Assoc\&lt;^sub&gt;I|const"><span>Module_Assoc<span class="hidden">⇩</span><sub>I</sub></span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>ss'</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span>at'</span></span></span><span> </span><span class="entity"><span class="entity"><span>ct'</span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span>as_t'</span></span></span></span><span> </span><span class="entity"><span class="entity"><span>cst'</span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>st'</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span>a'</span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span>c'</span></span></span></span><span> </span><span class="entity"><span class="entity"><span>sc'</span></span></span><span> </span><span class="entity"><span class="entity"><span>ast'</span></span></span><span>›</span></span><span>
                                            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Module_Assoc\&lt;^sub&gt;E|const"><span>Module_Assoc<span class="hidden">⇩</span><sub>E</sub></span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>ss'</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span>at'</span></span></span><span> </span><span class="entity"><span class="entity"><span>ct'</span></span></span><span> </span><span class="entity"><span class="entity"><span>as_t'</span></span></span><span> </span><span class="entity"><span class="entity"><span>cst'</span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>st'</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span>a'</span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span>c'</span></span></span></span><span> </span><span class="entity"><span class="entity"><span>sc'</span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span>ast'</span></span></span></span><span>›</span></span><span>
                     </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>xx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.Trueprop</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>head</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Fs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Ft</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Fc</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>T</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Dt</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Dx</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>smul</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.Trueprop</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>head</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Fs</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Ft</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Fc</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>T</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Dt</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Dx</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>smul</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span>NONE</span><span> </span><span>::</span><span> </span><span class="entity"><span>parse_inst_params_from_phi_term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Fc</span></span><span> </span><span>$</span><span> </span><span>Term.dummy</span><span> </span><span>$</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                      </span><span class="entity"><span>conds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ants</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>Guess_Zip_of_Semimodule</span></span><span> </span><span class="entity"><span>is_zip</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Guess_Scalar_framework</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.type|class"><span>type</span></a><span>›</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_BI.Algebras.html#Algebras.sep_magma_1|class"><span>sep_magma_1</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>F_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>eta_F_term</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>›</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>
              </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_zip</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Guess_Zip_of_Semimodule|const"><span>Guess_Zip_of_Semimodule</span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>s_ty</span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span>model_ty</span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span></span></span></span></span></span><span>›</span></span><span>
                         </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Guess_Unzip_of_Semimodule|const"><span>Guess_Unzip_of_Semimodule</span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>s_ty</span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span>model_ty</span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span></span></span></span></span><span>›</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>s_ty</span></span><span>›</span></span><span>
                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>model_ty</span></span><span>›</span></span><span>
                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.type</span><span> </span><span class="entity"><span>x_ty</span></span><span>›</span></span><span>
                </span><span>$</span><span> </span><span class="entity"><span>F_term</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>eta_F_term</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"scalar_domain"</span></span><span class="main"><span>,</span></span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s_ty</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"abstract_domain"</span></span><span class="main"><span>,</span></span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s_ty</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>s_ty</span></span><span> </span><span>--&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_zip</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>prod</span></a><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span class="entity"><span>x_ty</span></span><span>›</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"f"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s_ty</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>s_ty</span></span><span> </span><span>--&gt;</span><span>
                          </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_zip</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>prod</span></a><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span class="entity"><span>x_ty</span></span><span>›</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span>--&gt;</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>prod</span></a><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span class="entity"><span>x_ty</span></span><span>›</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"antecedents"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
                </span><span>$</span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"conditions"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*Trueprop*)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*Guess_(Un)Zip_of_Semimodule*)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ty_s</span></span><span>  </span><span>$</span><span> </span><span class="entity"><span>ty_model</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ty_x</span></span><span>
                    </span><span>$</span><span> </span><span class="entity"><span>F</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Dx</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>f</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>ants</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>conds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>s_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                        </span><span class="main"><span>(</span></span><span>Logic.dest_type</span><span> </span><span class="entity"><span>ty_s</span></span><span class="main"><span>,</span></span><span> </span><span>Logic.dest_type</span><span> </span><span class="entity"><span>ty_model</span></span><span class="main"><span>,</span></span><span> </span><span>Logic.dest_type</span><span> </span><span class="entity"><span>ty_x</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>xxx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
                              </span><span class="entity"><span>HOLogic.Trueprop</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>
                      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_zip</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Module_Distr_Homo\&lt;^sub&gt;Z|const"><span>Module_Distr_Homo<span class="hidden">⇩</span><sub>Z</sub></span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>s_ty</span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span></span></span></span><span> </span><span class="entity"><span>model_ty</span></span><span>›</span></span><span>
                                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Module_Distr_Homo\&lt;^sub&gt;S|const"><span>Module_Distr_Homo<span class="hidden">⇩</span><sub>S</sub></span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>s_ty</span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span></span></span><span> </span><span class="entity"><span>model_ty</span></span><span>›</span></span><span class="main"><span>)</span></span><span>
                        </span><span>$</span><span> </span><span class="entity"><span>F</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Dx</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.Trueprop</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>
                      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_zip</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Module_Distr_Homo\&lt;^sub&gt;Z|const"><span>Module_Distr_Homo<span class="hidden">⇩</span><sub>Z</sub></span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>s_ty</span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span></span></span></span><span> </span><span class="entity"><span>model_ty</span></span><span>›</span></span><span>
                                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Module_Distr_Homo\&lt;^sub&gt;S|const"><span>Module_Distr_Homo<span class="hidden">⇩</span><sub>S</sub></span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>s_ty</span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span></span></span><span> </span><span class="entity"><span>model_ty</span></span><span>›</span></span><span class="main"><span>)</span></span><span>
                        </span><span>$</span><span> </span><span class="entity"><span>F</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Ds</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Dx</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                   </span><span>NONE</span><span> </span><span>::</span><span> </span><span class="entity"><span>parse_inst_params_from_phi_term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>F</span></span><span> </span><span>$</span><span> </span><span>Term.dummy</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                   </span><span class="entity"><span>conds</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ants</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>)</span></span><span>


</span><span class="comment1"><span>(*
fun Guess_Scalar_One_E (phi : phi_type) ctxt =
  let val (s_ty, x_ele_ty, x_ty, model_ty, phi) = parse_semimodule_phityp ctxt phi NONE
      val idx = maxidx_of_phi phi ~1 + 1
      val ((_, FT_term), ctxt) = fix_phi_term_params (#term phi) ctxt
      val (F_term $ _ $ T_term) = FT_term

      val eta_F_term = Abs ("s", s_ty, Abs ("T", Term.fastype_of T_term, Abs ("x", x_ty,
                          <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹φType x_ty model_ty› $ Bound 0 $ (Term.incr_boundvars 3 F_term $ Bound 2 $ Bound 1))))

      val goal_term =
            <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Trueprop› $ (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Guess_Scalar_One s_ty model_ty x_ele_ty x_ty›
              $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type s_ty›
              $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type model_ty›
              $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type x_ele_ty›
              $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type x_ty›
              $ F_term $ eta_F_term $ T_term
              $ Var (("one", idx), s_ty)
              $ Var (("Dx", idx), x_ty --&gt; HOLogic.boolT)
              $ Var (("f", idx), x_ty --&gt; x_ele_ty)
              $ Var (("ants", idx), HOLogic.boolT)
              $ Var (("conds", idx), HOLogic.boolT))

      val reason = Conv.gconv_rule (HOLogic.Trueprop_conv (funpow 5 Conv.fun_conv (Conv.arg1_conv (
                      Conv.abs_conv (Conv.abs_conv (Conv.abs_conv (fn (_, ctxt) =&gt;
                      fn ctm =&gt; Conv.rewrs_conv (map (fn th =&gt; th RS' (ctxt, @{thm' HOL.eq_reflection}))
                                           (#equations phi)) ctm) o snd) o snd) ctxt
                      )))) 1
                #&gt; Phi_Reasoner.reason NONE NONE ctxt
   in case Phi_Help.reason_tracing_tyinst ctxt reason goal_term
        |&gt; Option.map (apsnd (simplify_guessing_reasoning ctxt))
   of SOME (inst, ret) =&gt;
       (case Thm.prop_of ret
          of _ (*Trueprop*) $ (_ (*Guess_Scalar_One*) $ _ $ _ $ _ $ _
                $ F $ _ $ T $ one $ Dx $ f $ ants $ conds) =&gt;
            let val ants = constrain_antecedents conds ants
                val head = <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Module_One s_ty x_ele_ty model_ty x_ty›
                val prop = HOLogic.Trueprop $ (head $ F $ T $ one $ Dx $ f)
             in Seq.single (ants, prop,
                            NONE :: parse_inst_params_from_phi_term (F $ Term.dummy $ T),
                            instantiate_phi (inst, Vars.empty) phi,
                            ctxt)
            end
           | _ =&gt; error "BUG")
    | NONE =&gt; guess_fail ctxt phi (K [])
  end
*)</span></span><span>

</span><span class="comment1"><span>(*
fun Guess_Unzip_of_Semimodule ctxt (phi : phi_type) (s_ty, x_ty, model_ty, typ_expr) =
  let val goal_term =
            <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Trueprop› $ (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Guess_Unzip_of_Semimodule s_ty model_ty x_ty›
                $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type s_ty›
                $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type model_ty›
                $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type x_ty›
                $ typ_expr
                $ Var(("scalar_domain",0), s_ty --&gt; HOLogic.boolT)
                $ Var(("abstract_domain",0), s_ty --&gt; s_ty --&gt; x_ty --&gt; HOLogic.boolT)
                $ Var(("zip", 0), s_ty --&gt; s_ty --&gt; x_ty --&gt; <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹prod x_ty x_ty›)
                $ Var(("antecedents", 0), HOLogic.boolT)
                $ Var(("conditions", 0), HOLogic.boolT))
      val reason = Conv.gconv_rule (HOLogic.Trueprop_conv (funpow 4 Conv.fun_conv (Conv.arg1_conv (
                      Conv.top_rewrs_conv (map (fn th =&gt; th RS' (ctxt, @{thm' HOL.eq_reflection}))
                                               (#equations phi)) ctxt
                      )))) 1
                #&gt; Phi_Reasoner.reason NONE NONE ctxt
   in case Phi_Help.reason_tracing_tyinst ctxt reason goal_term
   of SOME (inst, ret) =&gt;
        (case Thm.prop_of ( ret
                         |&gt; Simplifier.simplify (ctxt addsimps
                                @{thms' Premise_norm[where mode=‹default›]
                                        Premise_norm[where mode=‹MODE_GUARD›]
                                        Ant_Seq_reduct
                                        HOL.imp_conjR[folded Ant_Seq_def]
                                        HOL.all_conj_distrib[folded Ant_Seq_def]}) )
           of _ (*Trueprop*) $ (_ (*Guess_Unzip_of_Semimodule*)
                    $ _ $ _ $ _ $ _ $ Ds $ Dx $ zi $ ants $ cond)
                =&gt; (Ds, Dx, zi, constrain_antecedents cond ants, inst)
            | _ =&gt; error "BUG")
    | NONE =&gt; raise Automation_Fail (fn () =&gt; let open Pretty in
              [block (text "Fail to guess the semimodule unzip operation as there is no registered \
                           \record giving the semimodule between scalar algebra" @
                      [brk 1, Syntax.pretty_typ ctxt s_ty, brk 1] @
                      text "abstrct algebra" @
                      [brk 1, Syntax.pretty_typ ctxt x_ty, brk 1] @
                      text "and concrete algebra" @
                      [brk 1, Syntax.pretty_typ ctxt model_ty, str ".", brk 1] @
                      text "You may either annotate the form of the rule or provide the record by"),
               block ([keyword1 "lemma", brk 1, str "[φreasoner]", brk 1,
                       str "‹", Syntax.pretty_term ctxt goal_term, str "›"])]
            end)
  end


fun Guess_Zip_of_Semimodule ctxt (phi : phi_type) (s_ty, x_ty, model_ty, typ_expr) =
  let val goal_term =
            <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Trueprop› $ (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Guess_Zip_of_Semimodule s_ty model_ty x_ty›
                $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type s_ty›
                $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type model_ty›
                $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type x_ty›
                $ typ_expr
                $ Var(("scalar_domain",0), s_ty --&gt; HOLogic.boolT)
                $ Var(("abstract_domain",0), s_ty --&gt; s_ty --&gt; <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹prod x_ty x_ty› --&gt; HOLogic.boolT)
                $ Var(("zip", 0), s_ty --&gt; s_ty --&gt; <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹prod x_ty x_ty› --&gt; x_ty)
                $ Var(("antecedents", 0), HOLogic.boolT)
                $ Var(("conditions", 0), HOLogic.boolT))
      val reason = Conv.gconv_rule (HOLogic.Trueprop_conv (funpow 4 Conv.fun_conv (Conv.arg1_conv (
                      Conv.top_rewrs_conv (map (fn th =&gt; th RS' (ctxt, @{thm' HOL.eq_reflection}))
                                               (#equations phi)) ctxt
                      )))) 1
                #&gt; Phi_Reasoner.reason NONE NONE ctxt
   in case Phi_Help.reason_tracing_tyinst ctxt reason goal_term
   of SOME (inst, ret) =&gt;
        (case Thm.prop_of ( ret
                         |&gt; Simplifier.simplify (ctxt addsimps
                                @{thms' Premise_norm[where mode=‹default›]
                                        Premise_norm[where mode=‹MODE_GUARD›]
                                        Ant_Seq_reduct
                                        HOL.imp_conjR[folded Ant_Seq_def]
                                        HOL.all_conj_distrib[folded Ant_Seq_def]}) )
           of _ (*Trueprop*) $ (_ (*Guess_Zip_of_Semimodule*)
                    $ _ $ _ $ _ $ _ $ Ds $ Dx $ zi $ ants $ cond)
                =&gt; (Ds, Dx, zi, constrain_antecedents cond ants, inst)
            | _ =&gt; error "BUG")
    | NONE =&gt; raise Automation_Fail (fn () =&gt; let open Pretty in
              [block (text "Fail to guess the semimodule zip operation as there is no registered \
                           \record giving the semimodule between scalar algebra" @
                      [brk 1, Syntax.pretty_typ ctxt s_ty, brk 1] @
                      text "abstrct algebra" @
                      [brk 1, Syntax.pretty_typ ctxt x_ty, brk 1] @
                      text "and concrete algebra" @
                      [brk 1, Syntax.pretty_typ ctxt model_ty, str ".", brk 1] @
                      text "You may either annotate the form of the rule or provide the record by"),
               block ([keyword1 "lemma", brk 1, str "[φreasoner]", brk 1,
                       str "‹", Syntax.pretty_term ctxt goal_term, str "›"])]
            end)
  end
*)</span></span><span>


</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre>
</body>

</html>