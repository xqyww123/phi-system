<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹library/phi_type_algebra/object_equiv.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹library/phi_type_algebra/object_equiv.ML›</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>PHI_TYPE_ALGEBRA_DERIVERS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>include</span></span></span><span> </span><span class="entity"><span>PHI_TYPE_ALGEBRA_DERIVERS</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> conv_hol_imp_to_meta_if_has </span><span class="main"><span>:</span></span><span> </span><span>conv</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> conv_hol_imps_to_metas_if_has </span><span class="main"><span>:</span></span><span> </span><span>conv</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> object_equiv </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>quiet</span></span><span> * </span><span>Position.T</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>deriving_instruction</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Type.derive</span></span><span>
</span><span class="comment1"><span>(*val object_equiv_singular : quiet -&gt; deriving_instruction list -&gt; Phi_Type.derive*)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Phi_Type_Derivers</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>PHI_TYPE_ALGEBRA_DERIVERS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Phi_Type</span><span> </span><span>Phi_Type_Derivers</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>conv_hol_imps_to_metas_if_has</span></span><span> </span><span class="entity"><span>Cant</span></span><span> </span><span class="entity"><span>Cconcl</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_imp|fact"><span>atomize_imp</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>then_conv</span><span>
           </span><span>Conv.implies_conv</span><span> </span><span class="entity"><span>Cant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conv_hol_imps_to_metas_if_has</span></span><span> </span><span class="entity"><span>Cant</span></span><span> </span><span class="entity"><span>Cconcl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>Pure.imp</span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span>Conv.implies_conv</span><span> </span><span class="entity"><span>Cant</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conv_hol_imps_to_metas_if_has</span></span><span> </span><span class="entity"><span>Cant</span></span><span> </span><span class="entity"><span>Cconcl</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Cconcl</span></span><span> </span><span class="entity"><span>ctm</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>atomize_imp_tag</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>lemma</span></span><span>
      </span><span class="quoted"><span>‹ </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.implies|const"><span>⟶</span></a></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Action_Tag|const"><span>@tag</span></a></span><span> </span><span class="free"><span>C</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="main"><span>⟹</span></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Action_Tag|const"><span>@tag</span></a></span><span> </span><span class="free"><span>C</span></span><span class="main"><span>)</span></span><span> ›</span></span><span>
      </span><span class="quasi_keyword"><span>by</span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span>:</span></span><span> </span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Action_Tag_def|fact"><span>Action_Tag_def</span></a><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_imp|fact"><span>atomize_imp</span></a><span class="main"><span>)</span></span><span class="antiquote"><span>}</span></span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>conv_hol_imp_to_meta_if_has</span></span><span> </span><span class="entity"><span>Cant</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_imp|fact"><span>atomize_imp</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>then_conv</span><span>
           </span><span>Conv.arg1_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.Trueprop_conv</span></span><span> </span><span class="entity"><span>Cant</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Action_Tag|const"><span>Action_Tag</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>
              </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>atomize_imp_tag</span></span><span> </span><span>then_conv</span><span>
           </span><span>Conv.arg1_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.Trueprop_conv</span></span><span> </span><span class="entity"><span>Cant</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.all_conv</span><span> </span><span class="entity"><span>ctm</span></span><span>


</span><span class="comment1"><span>(*** Object Equivalence ***)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span>

</span><span class="comment1"><span>(*
fun need_infer sequent =
  case Thm.concl_of sequent
    of _ (*Trueprop*) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹Object_Equiv›, _) $ _ $ Var _) =&gt; true
     | _ (*Trueprop*) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹Object_Equiv›, _) $ _ $
            Abs (_, _, Abs (_, _,
              Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ (Var _ $ Bound 1 $ Bound 0) $ _))) =&gt; true
     | _ =&gt; false

fun infer_equiv ctxt sequent =
  let val var = case Thm.concl_of sequent
                  of _ (*Trueprop*) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹Object_Equiv›, _) $ _ $ Var v) =&gt; v
                   | _ (*Trueprop*) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹Object_Equiv›, _) $ _ $
                          Abs (_, _, Abs (_, _,
                            Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ (Var v $ Bound 1 $ Bound 0) $ _))) =&gt; v
                   | _ =&gt; error "BUG gZvGQ6CHTG+D2d27jtExHQ"
      val (tya, tyb) = case snd var of <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹fun a <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹fun b _›› =&gt; (a,b)
      val (_,oblg) = PLPR_Syntax.dest_premise_tag (Thm.major_prem_of sequent)
      
      val exists_bad = exists_subterm (fn Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹Satisfiable›, _) =&gt; true
                                        | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹Satisfaction›, _) =&gt; true
                                        | _ =&gt; false)

      fun refine_term default (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹HOL.implies› $ A $ B) =
            if exists_bad A then refine_term default B
                            else <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹HOL.implies› $ A $ refine_term default B
        | refine_term _ (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹HOL.disj› $ A $ B) =
            <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹HOL.disj› $ refine_term <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹False› A $ refine_term <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹False› B
        | refine_term default X = if exists_bad X then default else X

      fun infer lev (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.implies›, _) $ (Var v' $ x $ y) $ Y) =
            if v' = var
            then Phi_Help.subst_with_loose_bounds [(x, Bound (lev+1)), (y, Bound lev)] Y
              |&gt; refine_term <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹True›
            else <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹True›
        | infer lev (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ X $ Y) =
            <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹HOL.conj› $ infer lev X $ infer lev Y
        | infer lev (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.disj›, _) $ X $ Y) =
            <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹HOL.disj› $ infer lev X $ infer lev Y
        | infer lev ((H as Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _)) $ Abs (N, Ty, X)) =
            H $ Abs (N, Ty, infer (lev+1) X)
        | infer lev (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹HOL.All ty› $ X) =
            infer lev (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹HOL.All ty› $ Abs ("_", ty, Term.incr_boundvars 1 X $ Bound 0))
        | infer lev ((H as Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.Ex›, _)) $ Abs (N, Ty, X)) =
            H $ Abs (N, Ty, infer (lev+1) X)
        | infer lev (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹HOL.Ex ty› $ X) =
            infer lev (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹HOL.Ex ty› $ Abs ("_", ty, Term.incr_boundvars 1 X $ Bound 0))
        | infer lev ((H as Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹special_Ex›, _)) $ Abs (N, Ty, X)) =
            H $ Abs (N, Ty, infer (lev+1) X)
        | infer lev (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹special_Ex ty› $ X) =
            infer lev (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹special_Ex ty› $ Abs ("_", ty, Term.incr_boundvars 1 X $ Bound 0))
        | infer _ _ = <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹True›

      val eq = Abs ("x", tya, Abs ("y", tyb, infer 0 oblg))
            |&gt; Thm.cterm_of ctxt
   in Thm.instantiate (TVars.empty, Vars.make [(var, eq)]) sequent
  end
*)</span></span><span>

</span><span class="comment1"><span>(*if the φ-type is recursive, guess the reachability relation from the relation operator of the BNF,
  or else, leave it as a schematic variable because we can infer it from the proof obligation later.

  If the φ-type has any parameters whose logic type looks like a φ-type, the reachability relations
  of the parameters are also assumed as antecedents of the guessing property, and also used in
  above guessing the reachability relations of the target φ-type.*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>guess_property_obj_eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>phi</span></span><span class="main"><span>:</span></span><span class="entity"><span>phi_type</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>T_term</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>fix_phi_term_params</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rev_arg_tys</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_parameterized_phi_ty</span></span><span> </span><span class="main"><span>(</span></span><span>Term.fastype_of</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>term </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_Ants</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ty</span></span><span>::</span><span class="entity"><span>rev_arg_tys</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eq</span></span><span>::</span><span class="entity"><span>eq_names</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ants</span></span><span> </span><span class="entity"><span>param_eqs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T_term</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
           </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span class="entity"><span>dest_parameterized_phi_ty</span></span><span> </span><span class="entity"><span>Ty</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rev_arg_tys_A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty_A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>model_ty_A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arity_A</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>rev_arg_tys_A</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>typ</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>x_ty_A</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>x_ty_A</span></span><span> </span><span>--&gt;</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>›</span></span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ant</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Term.incr_bv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>arity_A</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                              </span><span>|&gt;</span><span> </span><span>fold_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>arity_A</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span>-</span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rev_arg_tys_A</span></span><span>          
                              </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.Object_Equiv|const"><span>Object_Equiv</span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span>x_ty_A</span></span></span></span><span> </span><span class="entity"><span>model_ty_A</span></span><span>›</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span> </span><span>$</span><span> </span><span>Free</span><span class="main"><span>(</span></span><span class="entity"><span>eq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typ</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                              </span><span>|&gt;</span><span> </span><span>fold</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                  </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.All|const"><span>All</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span>
                                    </span><span>$</span><span> </span><span>Abs</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>,</span></span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span>
                                 </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rev_arg_tys_A</span></span><span>
                   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>mk_Ants</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rev_arg_tys</span></span><span> </span><span class="entity"><span>eq_names</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ant</span></span><span>::</span><span class="entity"><span>ants</span></span><span class="main"><span>)</span></span><span>
                              </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>x_ty_A</span></span><span class="main"><span>,</span></span><span> </span><span>Free</span><span class="main"><span>(</span></span><span class="entity"><span>eq</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>typ</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>::</span><span class="entity"><span>param_eqs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>T_term</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mk_Ants</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rev_arg_tys</span></span><span> </span><span class="entity"><span>eq_names</span></span><span> </span><span class="entity"><span>ants</span></span><span> </span><span class="entity"><span>param_eqs</span></span><span> </span><span class="entity"><span>T_term</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_Ants</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ants</span></span><span> </span><span class="entity"><span>param_eqs</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ants</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>param_eqs</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_Ants</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>ListPair.UnequalLengths</span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arity</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>rev_arg_tys</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rev_eq_names'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>Variable.names_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"eq"</span></span><span> </span><span class="entity"><span>arity</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rev_eq_names</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Variable.add_fixes</span><span> </span><span class="entity"><span>rev_eq_names'</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ants</span></span><span class="main"><span>,</span></span><span class="entity"><span>param_eqs</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_Ants</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rev_arg_tys</span></span><span> </span><span class="entity"><span>rev_eq_names</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>T_term</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eq_terms</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="main"><span>#</span></span><span>is_recursive </span><span class="entity"><span>phi</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>guess_self_rel</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>param_eqs</span></span><span> </span><span class="entity"><span>x_ty</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Seq.single</span><span> </span><span class="main"><span>(</span></span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"eq"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>x_ty</span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>HOLogic.boolT</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>cond_T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>guess_conditions</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.Object_Equiv|const"><span>Object_Equiv</span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span><span> </span><span class="entity"><span>model_ty</span></span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>T_term</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ants_U</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>oblg_U</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>guess_conditions</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.Object_Equiv|const"><span>Object_Equiv</span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span><span> </span><span class="entity"><span>model_ty</span></span><span>›</span></span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>T_term</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pass_eq</span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>oblg_U</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>eq</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>,</span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"y"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>x_ty</span></span><span class="main"><span>,</span></span><span>
                    </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eq</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span>
                                    </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cond_T</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oblg_U</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>eq_terms</span></span><span>
   </span><span>|&gt;</span><span> </span><span>Seq.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>eq_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>ants_U</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>ants</span></span><span class="main"><span>,</span></span><span>
         </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>›</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.Object_Equiv|const"><span>Object_Equiv</span></a><span> </span><span class="entity"><span class="entity"><span class="entity"><span>x_ty</span></span></span></span><span> </span><span class="entity"><span>model_ty</span></span><span>›</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>T_term</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>pass_eq</span></span><span> </span><span class="entity"><span>eq_term</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
         </span><span>NONE</span><span> </span><span>::</span><span> </span><span class="entity"><span>parse_inst_params_from_phi_term</span></span><span> </span><span class="entity"><span>T_term</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>OE_reasoning</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.proof_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Reasoner.add_pass</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span>Const</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"φTA.OE"</span></span><span class="main"><span>,</span></span><span>TFree</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">pattern_prop</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.Object_Equiv|const"><span>Object_Equiv</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span class="main"><span>,</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rules</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>priority</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pats</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>guard</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                       </span><span class="main"><span>(</span></span><span class="entity"><span>rules</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Reasoner.NORMAL_LOCAL_CUT'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>priority</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pats</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>guard</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>default_reasoning</span></span><span> </span><span>true</span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>pass_make_ToA</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>reasoner_group</span></span><span> </span><span class="main"><span>%</span></span><span>deriving_local_rules</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.mk_ToA_rule|fact"><span>mk_ToA_rule</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                          </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>reasoner_group</span></span><span> </span><span class="main"><span>%</span></span><span>deriving_local_rules</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.mk_ToA_rule&apos;|fact"><span>mk_ToA_rule'</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
           </span><span>oo</span><span> </span><span class="entity"><span>default_reasoning_configure</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>exhaustive_PLPR_reasoner</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>chk_unfolded</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../IDE_CP_Applications1.html#IDE_CP_Applications1.OPEN|const"><span>OPEN</span></a><span>›</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span> </span><span class="entity"><span>rule</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_obj_equal'</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>instruction</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>phi0</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>phi_type</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thy0</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_hint</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>parse_hint</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.Object_Equiv|const"><span>Object_Equiv</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>T'</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>T'</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>extract_oprs_from_hint</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.Object_Equiv|const"><span>Object_Equiv</span></a><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>eq</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>eq</span></span><span class="main"><span>]</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>extract_oprs_from_hint</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>equip_expansion</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>equip_expansion_ss</span></span><span> </span><span class="entity"><span>phi0</span></span><span>
    </span><span class="comment1"><span>(*val phitm = Thm.cterm_of ctxt0 (#term phi0)
      val OE_IND_I = Drule.infer_instantiate ctxt0 [(("T",0), phitm)]
                        <span class="hidden">\&lt;^</span><span class="control">instantiate</span><span class="hidden">&gt;</span>‹'a=‹Thm.ctyp_of_cterm phitm› and T=phitm in
                            lemma ‹OE_IND T ≡ T› by (simp add: OE_IND_def)›
                  |&gt; @{print}*)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ind_conv</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>default_ind_conv</span></span><span> </span><span class="main"><span>(</span></span><span>
               </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#offset_292960..292974"><span>φTA_OE_rewr_IH</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>then_conv</span><span>
                    </span><span class="entity"><span>Phi_Conv.meta_all_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.implies_conv</span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.intro_\&lt;phi&gt;TA_ANT|fact"><span>intro_φTA_ANT</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>Conv.all_conv</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span>
               </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#offset_293506..293520"><span>φTA_OE_rewr_CL</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                     </span><span class="entity"><span>Phi_Conv.meta_all_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                       </span><span class="entity"><span>Phi_Reasoners.asm_full_rewrite</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>
                          </span><span class="entity"><span>equip_expansion</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#offset_293700..293711"><span>ex_pure_imp</span></a><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/BNF_Fixpoint_Base.html#BNF_Fixpoint_Base.conj_imp_eq_imp_imp|fact"><span>conj_imp_eq_imp_imp</span></a><span> </span><span>Pure.norm_hhf_eq</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                       </span><span class="entity"><span>Phi_Conv.meta_alls_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                          </span><span>Conv.implies_conv</span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.intro_\&lt;phi&gt;TA_ANT|fact"><span>intro_φTA_ANT</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                              </span><span class="main"><span>(</span></span><span class="entity"><span>conv_hol_imps_to_metas_if_has</span></span><span>
                                  </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.Trueprop_conv</span></span><span> </span><span class="main"><span>(</span></span><span>
                                      </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Premise_def|fact"><span>Premise_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a><span> mode</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.MODE_GUARD|const"><span>MODE_GUARD</span></a></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                                  </span><span class="main"><span>(</span></span><span class="entity"><span>wrap_ind_target</span></span><span> </span><span class="entity"><span>phi0</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                     </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                    </span><span class="comment1"><span>(*(Conv.implies_concl_conv (
                       Conv.rewr_conv @{thm' atomize_all[symmetric]} then_conv
                       Phi_Conv.meta_alls_conv (fn _ =&gt; Conv.rewr_conv @{thm' atomize_imp[symmetric]}) ctxt then_conv
                      ))*)</span></span><span>
                  </span><span class="comment1"><span>(*Conv.implies_conv
                      (Conv.rewr_conv @{thm' intro_φTA_ANT})
                      (Phi_Conv.hol_alls_to_meta_alls (fn _ =&gt;
                          conv_hol_imp_to_meta_if_has (Conv.rewr_conv @{thm' Action_Tag_def[symmetric, where A=φTA_pure_facts]})
                        ) ctxt)*)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pre_simp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>default_pre_simplifier</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Conv.meta_all_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
           </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Conv.meta_all_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Reasoners.asm_rewrite</span></span><span> </span><span>true</span><span> </span><span>o</span><span> </span><span class="entity"><span>equip_expansion</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
            </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#offset_293326..293341"><span>φTA_OE_rewr_pre</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>infer</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>is_some</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>instruction</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>is_recursive </span><span class="entity"><span>phi0</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>predicate_infer</span></span><span> </span><span>false</span><span>
                          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.Object_Equiv|const"><span>Object_Equiv</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span>Var</span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span>
                            </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.Object_Equiv|const"><span>Object_Equiv</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span>
                                    </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span>
                                        </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Var</span><span> </span><span class="entity"><span>v</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span>
                            </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.Object_Equiv|const"><span>Object_Equiv</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Term.is_schematic</span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>Match</span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>)</span></span><span>
                          </span><span class="main"><span>(</span></span><span class="entity"><span>oblg_solver'</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>K</span><span> </span><span>NONE</span><span>
</span><span class="comment1"><span>(*      fun infer (_, ctxt, rule) =
            if need_infer rule
            then rule
                   |&gt; Phi_Help.beta_eta_contract
                   |&gt; Simplifier.rewrite_rule ctxt @{thms special_Ex_def}
                   |&gt; infer_equiv ctxt
                   |&gt; oblg_solver name ctxt
                   |&gt; SOME
            else NONE*)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>is_some</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>instruction</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>K</span><span> </span><span>I</span><span>
                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>simplifier_by_LPR'</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#offset_294390..294401"><span>φTA_OE_simp</span></a><span class="antiquote"><span>}</span></span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>def_contains_satisfaction</span></span><span> </span><span class="entity"><span>phi0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>thy0</span></span><span>
                      </span><span>|&gt;</span><span> </span><span>Config.put</span><span> </span><span class="entity"><span>Phi_Reasoner.ignore_dup_reasoner</span></span><span> </span><span>true</span><span>
                      </span><span>|&gt;</span><span> </span><span class="entity"><span>Bundle.includes</span></span><span> </span><span class="main"><span>[</span></span><span class="inner_quoted"><span>"Phi_BI.ToA_extract_pure_sat"</span></span><span class="main"><span>]</span></span><span>
                      </span><span>|&gt;</span><span> </span><span>Config.restore</span><span> </span><span class="entity"><span>Phi_Reasoner.ignore_dup_reasoner</span></span><span> </span><span class="entity"><span>thy0</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>thy0</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deriving_framework</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>parse_hint</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>extract_oprs_from_hint</span></span><span class="main"><span>,</span></span><span>
                                      </span><span class="entity"><span>guess_property_obj_eq</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#offset_292301..292318"><span>Object_Equiv_rule</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                                      </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pure_PLPR_reasoning</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                       </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>default_ind_inst</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ind_conv</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>OE_reasoning</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                                      </span><span class="entity"><span>infer</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pre_simp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simp</span></span><span class="main"><span>)</span></span><span>
                                     </span><span class="entity"><span>phi0</span></span><span> </span><span class="entity"><span>instruction</span></span><span>
                                     </span><span class="main"><span>(</span></span><span class="comment1"><span>(*Config.put search_CSTR_rules true*)</span></span><span> </span><span class="entity"><span>thy</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Seq.pull</span><span> </span><span class="entity"><span>rules</span></span><span>
   </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Automation_Fail</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"Fail to derive any property"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rule'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thy</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Local_Theory.declaration</span><span> </span><span class="main"><span>{</span></span><span>syntax</span><span class="main"><span>=</span></span><span>false</span><span class="main"><span>,</span></span><span>pervasive</span><span class="main"><span>=</span></span><span>false</span><span class="main"><span>,</span></span><span> pos</span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>3</span></span><span> </span><span class="entity"><span>instruction</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>(</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>Config.map_generic</span><span> </span><span class="entity"><span>Phi_Reasoner.trace</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>=&gt;</span></span><span class="entity"><span>i</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="entity"><span>Phi_Reasoner.add_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pos </span><span class="entity"><span>phi0</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Phi_Reasoner.TO_BE_OVERRIDE'</span></span><span>
                                           </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>reasoner_group</span></span><span> </span><span class="main"><span>%</span></span><span>derived_object_equiv</span><span class="antiquote"><span>}</span></span></span></span><span>
                                                              </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>instruction</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                                           </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>[</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>rule'</span></span><span class="main"><span>]</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>Config.restore_generic</span><span> </span><span class="entity"><span>Phi_Reasoner.trace</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>note_properties_s</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>phi0</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rule'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
            </span><span>|&gt;</span><span> </span><span>pair</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rule'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="comment1"><span>(*
fun chk_is_singular ctxt tm =
  let fun chk_None (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹φNone›, _)) = true
        | chk_None (Abs (_, _, X)) = chk_None X
        | chk_None _ = false
   in case Logic.strip_assums_concl tm
   of Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹Trueprop›, _) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹Object_Equiv›, _) $ T $ eq) =&gt;
            exists chk_None (snd (Term.strip_comb (Envir.beta_eta_contract T)))
     | _ =&gt; malformed_hint ctxt tm (K [])
  end

fun gen_obj_equal'' name NONE ctxt_derv phi thy = gen_obj_equal' name NONE ctxt_derv phi thy
  | gen_obj_equal'' name (SOME (H, group)) ctxt_derv phi thy =
      if chk_is_singular ctxt_derv H
      then gen_obj_equal_singular name (SOME (H, group)) ctxt_derv phi thy
      else gen_obj_equal' name (SOME (H, group)) ctxt_derv phi thy
*)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>

</span><span class="comment1"><span>(*val object_equiv_singular = deriver_framework (ACCEPT_NO_HINT, ONLY_ONCE, "Object_Equiv<span class="hidden">⇩</span><sub>O</sub>") gen_obj_equal_singular*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>object_equiv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deriver_framework</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ACCEPT_ANY_HINTS</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ONLY_ONCE_IF_NO_HINT</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"Object_Equiv"</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>gen_obj_equal'</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>