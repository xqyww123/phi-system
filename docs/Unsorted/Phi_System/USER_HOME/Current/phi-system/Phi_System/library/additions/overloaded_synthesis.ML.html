<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File â€¹library/additions/overloaded_synthesis.MLâ€º</title>
</head>


<body>
<div class="head">
<h1>File â€¹library/additions/overloaded_synthesis.MLâ€º</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>PHI_SYNTHESIS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>include</span></span></span><span> </span><span class="entity"><span>PHI_SYNTHESIS</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>ovld_signat</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Signature</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> term list * term </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Operator</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> term
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> declare_overloaded_operator </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>ovld_signat</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Position.T</span><span>
                               </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Reasoner.mode'</span></span><span> * </span><span class="entity"><span>Reasoner_Group.group</span></span><span> </span><span>option</span><span>
                               </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Phi_Synthesis</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>PHI_SYNTHESIS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Phi_Synthesis</span><span>

</span><span class="comment1"><span>(*The maximal index must be 0!*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>overload_rule_of</span></span><span> </span><span class="entity"><span>arity</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>arity</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../IDE_CP_Reasoning3.html#IDE_CP_Reasoning3.overloaded_synthesis_nullary|fact"><span>overloaded_synthesis_nullary</span></a><span class="antiquote"><span>}</span></span></span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../IDE_CP_Reasoning3.html#IDE_CP_Reasoning3.overloaded_synthesis_unary|fact"><span>overloaded_synthesis_unary</span></a><span class="antiquote"><span>}</span></span></span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../IDE_CP_Reasoning3.html#IDE_CP_Reasoning3.overloaded_synthesis_binary|fact"><span>overloaded_synthesis_binary</span></a><span class="antiquote"><span>}</span></span></span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="inner_numeral"><span>3</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../IDE_CP_Reasoning3.html#IDE_CP_Reasoning3.overloaded_synthesis_ternary|fact"><span>overloaded_synthesis_ternary</span></a><span class="antiquote"><span>}</span></span></span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"Arity greater than 3 is not supported yet."</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>ovld_signat</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Signature</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> term list * term </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Operator</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> term

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>declare_overloaded_operator</span></span><span> </span><span class="entity"><span>signat0</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mode</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>prio_group</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt0</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.proof_of</span><span> </span><span class="entity"><span>ctxt0</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>default_signature</span></span><span> </span><span class="entity"><span>operator0</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.augment</span><span> </span><span class="entity"><span>operator0</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>operator</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>singleton</span><span> </span><span class="main"><span>(</span></span><span>Variable.export_terms</span><span> </span><span class="entity"><span>ctxt'</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>operator0</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arg_tys</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>binder_types</span><span> </span><span class="main"><span>(</span></span><span>Term.fastype_of</span><span> </span><span class="entity"><span>operator</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arity</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>arg_tys</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arg_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>Variable.names_of</span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"x"</span></span><span> </span><span class="entity"><span>arity</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phi_names</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>Variable.names_of</span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"T"</span></span><span> </span><span class="entity"><span>arity</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>arg_tys</span></span><span> </span><span class="entity"><span>arg_names</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>phis</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>â€¹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.\&lt;phi&gt;arg|type"><span>Ï†arg</span></a><span>â€º</span></span></span><span> </span><span>--&gt;</span><span> </span><span class="entity"><span>T</span></span><span> </span><span>--&gt;</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>â€¹</span><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.assn|type"><span>assn</span></a><span>â€º</span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                            </span><span class="entity"><span>arg_tys</span></span><span> </span><span class="entity"><span>phi_names</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arg_specs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map2</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Abs</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>â€¹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.\&lt;phi&gt;arg|type"><span>Ï†arg</span></a><span>â€º</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Phi_Syntax.mk_phi_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>T</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                                 </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>phis</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>list_comb</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>operator</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>y_phi_name</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Name.invent</span><span> </span><span class="main"><span>(</span></span><span>Variable.names_of</span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"U"</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>y_phi</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>y_phi_name</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>â€¹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.\&lt;phi&gt;arg|type"><span>Ï†arg</span></a><span>â€º</span></span></span><span> </span><span>--&gt;</span><span> </span><span>Term.fastype_of</span><span> </span><span class="entity"><span>y</span></span><span> </span><span>--&gt;</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>â€¹</span><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.assn|type"><span>assn</span></a><span>â€º</span></span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>y_spec</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>â€¹</span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.\&lt;phi&gt;arg|type"><span>Ï†arg</span></a><span>â€º</span></span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Phi_Syntax.mk_phi_type</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>y_phi</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>arg_specs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>y_spec</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>args0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ret0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>signat0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>Signature</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>s</span></span><span>
                                        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Operator</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>default_signature</span></span><span> </span><span class="entity"><span>f</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>args</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Logic.incr_indexes</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args0</span></span><span class="main"><span>,</span></span><span>
                         </span><span>Logic.incr_indexes</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ret0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>arity</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>args</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>overload_rule_of</span></span><span> </span><span class="entity"><span>arity</span></span><span>
            </span><span>|&gt;</span><span> </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span>
                  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"YY"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span>
                  </span><span>map_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"S"</span></span><span>^</span><span>string_of_int</span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1</span></span><span>+</span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Phi_Reasoner.info_pretty</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pretty.chunks</span><span> </span><span class="main"><span>[</span></span><span>
                </span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"Obtain the rule of overloaded synthesis:"</span></span><span class="main"><span>,</span></span><span>
                </span><span>Thm.pretty_thm</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>rule</span></span><span>
              </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dom_ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rng_ty</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.dest_funT</span><span> </span><span class="main"><span>(</span></span><span>Term.fastype_of</span><span> </span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ret_val_ty</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Procedure_Syntax.dest_argT</span></span><span> </span><span class="entity"><span>dom_ty</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pattern1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">pattern_prop</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>â€¹</span><span class="keyword1"><span>PROP</span></span><span> </span><a class="entity_ref" href="../../../../../../IDE_CP_Reasoning3.html#IDE_CP_Reasoning3.Gen_Synthesis_Rule|const"><span>Gen_Synthesis_Rule</span></a><span>
                        </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.All|const"><span>âˆ€</span></a></span><span class="bound"><span>vs</span></span><span class="main"><span>::</span></span><span class="tvar"><span>?'a</span></span><span class="main"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.\&lt;phi&gt;Procedure|const"><span>ğ—‰ğ—‹ğ—ˆğ–¼</span></a></span><span> </span><span class="var"><span>?F</span></span><span> </span><span class="bound"><span>vs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.\&lt;phi&gt;Procedure|const"><span>â¦ƒ</span></a></span><span> </span><span class="var"><span>?X</span></span><span> </span><span class="bound"><span>vs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.\&lt;phi&gt;Procedure|const"><span>âŸ¼</span></a></span><span> </span><span class="main"><span>Î»</span></span><span class="bound"><span>ret</span></span><span class="main"><span>::</span></span><span class="tvar"><span>?'y</span></span><span> </span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.\&lt;phi&gt;arg|type"><span>Ï†arg</span></a><span class="main"><span>.</span></span><span> </span><span class="var"><span>?YY</span></span><span> </span><span class="bound"><span>ret</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.\&lt;phi&gt;Procedure|const"><span>â¦„</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.\&lt;phi&gt;Procedure|const"><span>ğ—ğ—ğ—‹ğ—ˆğ—ğ—Œ</span></a></span><span> </span><span class="var"><span>?E</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="var"><span>?An</span></span><span> </span><span class="var"><span>?Re</span></span><span>â€º</span></span></span><span>
                  </span><span>|&gt;</span><span> </span><span>subst_vars</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"'y"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ret_val_ty</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"YY"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>Syntax.check_term</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.set_mode</span><span> </span><span>Proof_Context.mode_schematic</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pattern2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">pattern_prop</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>â€¹</span><span class="keyword1"><span>PROP</span></span><span> </span><a class="entity_ref" href="../../../../../../IDE_CP_Reasoning3.html#IDE_CP_Reasoning3.Gen_Synthesis_Rule|const"><span>Gen_Synthesis_Rule</span></a><span>
                        </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.All|const"><span>âˆ€</span></a></span><span class="bound"><span>vs</span></span><span class="main"><span>::</span></span><span class="tvar"><span>?'a</span></span><span class="main"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.\&lt;phi&gt;Procedure|const"><span>ğ—‰ğ—‹ğ—ˆğ–¼</span></a></span><span> </span><span class="var"><span>?F</span></span><span> </span><span class="bound"><span>vs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.\&lt;phi&gt;Procedure|const"><span>â¦ƒ</span></a></span><span> </span><span class="var"><span>?X</span></span><span> </span><span class="bound"><span>vs</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.\&lt;phi&gt;Procedure|const"><span>âŸ¼</span></a></span><span> </span><span class="main"><span>Î»</span></span><span class="bound"><span>ret</span></span><span class="main"><span>::</span></span><span class="tvar"><span>?'y</span></span><span> </span><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.\&lt;phi&gt;arg|type"><span>Ï†arg</span></a><span class="main"><span>.</span></span><span> </span><span class="var"><span>?YY</span></span><span> </span><span class="bound"><span>ret</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.REMAINS|const"><span>ğ—‹ğ–¾ğ—†ğ–ºğ—‚ğ—‡ğ—Œ</span></a></span><span> </span><span class="var"><span>?R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.\&lt;phi&gt;Procedure|const"><span>â¦„</span></a></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../../../../../Spec_Framework.html#Spec_Framework.\&lt;phi&gt;Procedure|const"><span>ğ—ğ—ğ—‹ğ—ˆğ—ğ—Œ</span></a></span><span> </span><span class="var"><span>?E</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="var"><span>?An</span></span><span> </span><span class="var"><span>?Re</span></span><span>â€º</span></span></span><span>
                  </span><span>|&gt;</span><span> </span><span>subst_vars</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"'y"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ret_val_ty</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"YY"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>Syntax.check_term</span><span> </span><span class="main"><span>(</span></span><span>Proof_Context.set_mode</span><span> </span><span>Proof_Context.mode_schematic</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maxidx_of_term</span><span> </span><span class="entity"><span>ret</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>no_val_ret</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Seq.chop</span><span> </span><span class="inner_numeral"><span>2</span></span><span> </span><span class="main"><span>(</span></span><span>Unify.hounifiers</span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span>Envir.empty</span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>ret</span></span><span class="main"><span>,</span></span><span> </span><span>Abs</span><span class="main"><span>(</span></span><span class="inner_quoted"><span>""</span></span><span class="main"><span>,</span></span><span class="entity"><span>dom_ty</span></span><span class="main"><span>,</span></span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"X"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>rng_ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>env</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>Envir.norm_term</span><span> </span><span class="entity"><span>env</span></span><span> </span><span class="main"><span>(</span></span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"X"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>rng_ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>synthesis_mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ret'</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"A"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ret'</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../IDE_CP_Reasoning3.html#IDE_CP_Reasoning3.synthesis_gen_mode_overloaded_I|fact"><span>synthesis_gen_mode_overloaded_I</span></a><span class="antiquote"><span>}</span></span></span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>no_val_ret</span></span><span>

   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>ctxt0</span></span><span>
   </span><span>|&gt;</span><span> </span><span class="entity"><span>Phi_Reasoner.add_rule</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="entity"><span>prio_group</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rule</span></span><span class="main"><span>]</span></span><span>
   </span><span>|&gt;</span><span> </span><span class="entity"><span>Phi_Reasoner.add_rule</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>Phi_Reasoner.NORMAL_LOCAL_CUT'</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>reasoner_group</span></span><span> </span><span class="main"><span>%</span></span><span>Ï†synthesis_gen_by_overloading</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>pattern1</span></span><span class="main"><span>,</span></span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../IDE_CP_Reasoning3.html#IDE_CP_Reasoning3.make_overloaded_synthesis_rule|fact"><span>make_overloaded_synthesis_rule</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span>
   </span><span>|&gt;</span><span> </span><span class="entity"><span>Phi_Reasoner.add_rule</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>Phi_Reasoner.NORMAL_LOCAL_CUT'</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>reasoner_group</span></span><span> </span><span class="main"><span>%</span></span><span>Ï†synthesis_gen_by_overloading</span><span class="main"><span>+</span></span><span>10</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>pattern2</span></span><span class="main"><span>,</span></span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../IDE_CP_Reasoning3.html#IDE_CP_Reasoning3.make_overloaded_synthesis_rule&apos;|fact"><span>make_overloaded_synthesis_rule'</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span>
   </span><span>|&gt;</span><span> </span><span>is_some</span><span> </span><span class="entity"><span>synthesis_mode</span></span><span> </span><span>?</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
      </span><span class="entity"><span>Phi_Reasoner.add_rule</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>Phi_Reasoner.NORMAL_LOCAL_CUT'</span></span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>reasoner_group</span></span><span> </span><span class="main"><span>%</span></span><span>synthesis_gen_mode_overridded</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>[</span></span><span>the</span><span> </span><span class="entity"><span>synthesis_mode</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="comment1"><span>(*
structure Overloaded = Generic_Data (
  type T = term Net.net
  val empty = Net.empty
  val merge = Net.merge (op aconv)
)

fun is_overloaded term ctxt =
  Net.match_term (Overloaded.get ctxt) term
    |&gt; exists (fn X =&gt; ) *)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre>
</body>

</html>