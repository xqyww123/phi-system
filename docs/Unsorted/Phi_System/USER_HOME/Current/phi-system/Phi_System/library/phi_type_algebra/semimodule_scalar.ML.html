<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹library/phi_type_algebra/semimodule_scalar.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹library/phi_type_algebra/semimodule_scalar.ML›</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>PHI_TYPE_ALGEBRA_DERIVERS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>include</span></span></span><span> </span><span class="entity"><span>PHI_TYPE_ALGEBRA_DERIVERS</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> semimodule_assoc_I </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>quiet</span></span><span> * </span><span>Position.T</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>deriving_instruction</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Type.derive</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> semimodule_assoc_E </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>quiet</span></span><span> * </span><span>Position.T</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>deriving_instruction</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Type.derive</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Phi_Type_Derivers</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>PHI_TYPE_ALGEBRA_DERIVERS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Phi_Type</span><span> </span><span>Phi_Type_Derivers</span><span>


</span><span class="comment1"><span>(*
fun infer_the_default_scalar_domain ctxt (s_ty, x_ty, model_ty) =
  let val g_Sdom = <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Trueprop› $ (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹guess_domain_of_scalar s_ty model_ty x_ty›
                                        $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type s_ty›
                                        $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type model_ty›
                                        $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type x_ty›
                                        $ Var(("p",0), s_ty --&gt; HOLogic.boolT))
   in Goal.init (Thm.cterm_of ctxt g_Sdom)
   |&gt; Phi_Reasoner.reason NONE NONE ctxt
   |&gt; (fn SOME ret =&gt; (case Thm.prop_of ret
                         of _ (*Pure.prop*) $ (_ (*Trueprop*) $ (_ (*guess_domain_of_scalar*)
                                    $ _ $ _ $ _ $ S)) =&gt; S
                          | _ =&gt; error "BUG")
        | _ =&gt; Abs("_", s_ty, <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹True›))
  end
*)</span></span><span>
</span><span class="comment1"><span>(*
fun Guess_Scalar_Assoc is_intro (phi : phi_type) ctxt =
  let val (s_ty, x_ele_ty, x_ty, model_ty, phi) = parse_semimodule_phityp ctxt phi NONE
      val idx = maxidx_of_phi phi ~1 + 1
      val ((_, FT_term), ctxt) = fix_phi_term_params (#term phi) ctxt
      val (F_term $ _ $ T_term) = FT_term

      val (ss, st) = (TVar (("s<span class="hidden">⇩</span><sub>s</sub>", idx), <span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span>‹type›), TVar (("s<span class="hidden">⇩</span><sub>t</sub>", idx), <span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span>‹type›))
      val (at, as_t) = (TVar (("a<span class="hidden">⇩</span><sub>t</sub>", idx), <span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span>‹type›), TVar (("a<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>_</sub><span class="hidden">⇩</span><sub>t</sub>", idx), <span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span>‹type›))
      val (Fs, Ft) = (Var (("F<span class="hidden">⇩</span><sub>s</sub>", idx), ss --&gt; mk_phi_type_ty(model_ty, at) --&gt; mk_phi_type_ty(model_ty, as_t)),
                      Var (("F<span class="hidden">⇩</span><sub>t</sub>", idx), st --&gt; mk_phi_type_ty(model_ty, x_ele_ty) --&gt; mk_phi_type_ty(model_ty, at)))
      val eta_F_term = Abs ("s", s_ty, Abs ("T", Term.fastype_of T_term, Abs ("x", x_ty,
                          <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹φType x_ty model_ty› $ Bound 0 $ (Term.incr_boundvars 3 F_term $ Bound 2 $ Bound 1))))
      val goal_term =
            <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Trueprop› $ (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Guess_Scalar_Assoc s_ty model_ty x_ele_ty x_ty ss at as_t st›
                $ (if is_intro then <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹True› else <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹False›)
                $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type s_ty›
                $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type model_ty›
                $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type x_ele_ty›
                $ <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.type x_ty›
                $ Fs $ Ft $ F_term $ eta_F_term $ T_term
                $ Var(("Ds",0), ss --&gt; HOLogic.boolT)
                $ Var(("Dt",0), st --&gt; HOLogic.boolT)
                $ Var(("Dx",0), ss --&gt; st --&gt; as_t --&gt; HOLogic.boolT)
                $ Var(("smul",0), ss --&gt; st --&gt; s_ty)
                $ Var(("f", 0), ss --&gt; st --&gt; as_t --&gt; x_ty)
                $ Var(("antecedents", 0), HOLogic.boolT)
                $ Var(("conditions", 0), HOLogic.boolT))
      val reason = Conv.gconv_rule (HOLogic.Trueprop_conv (funpow 7 Conv.fun_conv (Conv.arg1_conv (
                      Conv.abs_conv (Conv.abs_conv (Conv.abs_conv (fn (_, ctxt) =&gt;
                      fn ctm =&gt; Conv.rewrs_conv (map (fn th =&gt; th RS' (ctxt, @{thm' HOL.eq_reflection}))
                                           (#equations phi)) ctm) o snd) o snd) ctxt
                      )))) 1
                #&gt; Phi_Reasoner.reason NONE NONE ctxt
   in case Phi_Help.reason_tracing_tyinst ctxt reason goal_term
   of SOME (inst, ret) =&gt;
        (case Thm.prop_of ( ret
                         |&gt; Simplifier.simplify (ctxt addsimps
                                @{thms' Premise_norm[where mode=‹default›]
                                        Premise_norm[where mode=‹MODE_GUARD›]
                                        Ant_Seq_reduct
                                        HOL.imp_conjR[folded Ant_Seq_def]
                                        HOL.all_conj_distrib[folded Ant_Seq_def]}) )
           of _ (*Trueprop*) $ (_ (*Guess_Scalar_Assoc*) $ _ $ _ $ _ $ _ $ _
                    $ Fs $ Ft $ Fc $ _ $ T $ Ds $ Dt $ Dx $ smul $ f $ ants $ conds)
                =&gt; let val ants = constrain_antecedents conds ants
                       val <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹fun ss' <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹fun st' <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹fun as_t' ast'››› = Term.fastype_of f
                       val <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹fun _ <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹fun <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹fun a' ‹Type(_, [c'])›› <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹fun at' _››› = Term.fastype_of Ft
                       val <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹fun sc' _› = Term.fastype_of Fc
                       val head = if is_intro then <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Module_Assoc<span class="hidden">⇩</span><sub>I</sub> ss' at' c' as_t' st' a' sc' ast'›
                                              else <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Module_Assoc<span class="hidden">⇩</span><sub>E</sub> ss' at' c' as_t' st' a' sc' ast'›
                       val prop = HOLogic.Trueprop $ (head $ Fs $ Ft $ Fc $ T $ Ds $ Dt $ Dx $ smul $ f)
                    in Seq.single (ants, prop,
                                   NONE :: parse_inst_params_from_phi_term (Fc $ Term.dummy $ T),
                                   instantiate_phi (inst, Vars.empty) phi,
                                   ctxt)
                   end
            | _ =&gt; error "BUG")
    | NONE =&gt; guess_fail ctxt phi (K [])
  end
*)</span></span><span>
</span><span class="comment1"><span>(*
fun guess_property is_intro (phi0 : phi_type) ctxt =
  let val (s_ty, x_ty, model_ty, phi) = parse_semimodule_phityp ctxt phi0 (<span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span>‹type›, <span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span>‹sep_carrier›)
      val ((_, FT_term), ctxt) = fix_phi_term_params (#term phi) ctxt
      val (F_term $ _ $ T_term) = FT_term
      (*val ([Dx_name], ctxt) = Variable.add_fixes ["Dx"] ctxt
      val Dx = Free(Dx_name, x_ty --&gt; HOLogic.boolT)
      val AD = <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Abstract_Domain<span class="hidden">⇩</span><sub>M</sub><span class="hidden">⇩</span><sub>C</sub> x_ty model_ty› $ T_term $ Dx*)
      val Ds = infer_the_default_scalar_domain ctxt (s_ty, x_ty, model_ty)
   in Seq.single ([], <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Trueprop› $ (xxxx (*(if is_intro then <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Module_Assoc<span class="hidden">⇩</span><sub>I</sub> s_ty x_ty model_ty›
                                                      else <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Module_Assoc<span class="hidden">⇩</span><sub>E</sub> s_ty x_ty model_ty›)*)
                                            $ F_term $ T_term $ Ds (* $ Dx *)),
                  NONE :: parse_inst_params_from_phi_term FT_term, phi, ctxt)
  end
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_MS</span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>name</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>instruction</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>phi0</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>phi_type</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>parse_hint</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>parse_hint</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Module_Assoc\&lt;^sub&gt;I|const"><span>Module_Assoc<span class="hidden">⇩</span><sub>I</sub></span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>F1</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>F1</span></span><span>
             </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.Module_Assoc\&lt;^sub&gt;E|const"><span>Module_Assoc<span class="hidden">⇩</span><sub>E</sub></span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>F1</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>F1</span></span><span>
          </span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>extract_oprs_from_hint</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>reasoning</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>default_reasoning</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>default_reasoning_configure</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                          </span><span class="main"><span>(</span></span><span class="entity"><span>exhaustive_PLPR_reasoner</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>chk_unfolded</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>phi</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>phi</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>simp</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span>I</span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>equip_expansion</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>equip_expansion_ss</span></span><span> </span><span class="entity"><span>phi0</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>eqs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="entity"><span>Phi_Syntax.wrap_equation_by_OPEN</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>equations </span><span class="entity"><span>phi0</span></span><span class="main"><span>)</span></span><span>
              </span><span>@</span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span>  </span><span class="entity"><span>Phi_Syntax.wrap_equation_by_OPEN</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>type_equations </span><span class="entity"><span>phi0</span></span><span class="main"><span>)</span></span><span>
              </span><span>@</span><span> </span><span>map</span><span> </span><span class="entity"><span>Phi_Syntax.wrap_equation_by_MAKE</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>equations </span><span class="entity"><span>phi0</span></span><span class="main"><span>)</span></span><span>
              </span><span>@</span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span>Option.map</span><span> </span><span class="entity"><span>Phi_Syntax.wrap_equation_by_MAKE</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>type_equations </span><span class="entity"><span>phi0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ind_conv</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>default_ind_conv</span></span><span> </span><span class="main"><span>(</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span>Conv.rewr_conv</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#offset_334059..334075"><span>φTA_MS<span class="hidden">⇩</span><sub>I</sub>_rewr_IH</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                                              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.\&lt;phi&gt;TA_common_rewr_imp2_noact|fact"><span>φTA_common_rewr_imp2_noact</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                  </span><span>Conv.implies_conv</span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.intro_\&lt;phi&gt;TA_ANT|fact"><span>intro_φTA_ANT</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                                    </span><span class="main"><span>(</span></span><span>Conv.bottom_rewrs_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms'</span></span><span> </span><a class="entity_ref" href="../../../../../../IDE_CP_Applications1.html#IDE_CP_Applications1.OPEN_def|fact"><span>OPEN_def</span></a><span> </span><a class="entity_ref" href="../../../../../../IDE_CP_Applications1.html#IDE_CP_Applications1.MAKE_def|fact"><span>MAKE_def</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>TA_common_rewr_imp2_noact</span></span><span> </span><span>then_conv</span><span>
                  </span><span class="entity"><span>Phi_Reasoners.asm_rewrite</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>equip_expansion</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="entity"><span>eqs</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                  </span><span>Conv.implies_conv</span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#Phi_Type.intro_\&lt;phi&gt;TA_ANT|fact"><span>intro_φTA_ANT</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
                                    </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Conv.meta_alls_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                        </span><span class="entity"><span>conv_hol_imps_to_metas_if_has</span></span><span> </span><span>Conv.all_conv</span><span> </span><span>Conv.all_conv</span><span>
                                     </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                                   
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deriving_framework</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>parse_hint</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>extract_oprs_from_hint</span></span><span class="main"><span>,</span></span><span>
                                      </span><span class="entity"><span>Guess_Scalar_Assoc</span></span><span> </span><span class="entity"><span>is_intro</span></span><span class="main"><span>,</span></span><span>
                                      </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_intro</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#offset_333154..333167"><span>φTA_MS<span class="hidden">⇩</span><sub>I</sub>_rule</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Type.html#offset_333607..333620"><span>φTA_MS<span class="hidden">⇩</span><sub>E</sub>_rule</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                      </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_intro</span></span><span>
                                              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>default_ind_inst</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>,</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                                              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>default_ind_inst</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>r</span></span><span class="main"><span>,</span></span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>r</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                              </span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                        </span><span class="entity"><span>ind_conv</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>reasoning</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
                                      </span><span>K</span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>K</span><span> </span><span>I</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>simp</span></span><span class="main"><span>)</span></span><span>
                                    </span><span class="entity"><span>phi0</span></span><span> </span><span class="entity"><span>instruction</span></span><span> </span><span class="entity"><span>thy</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Seq.pull</span><span> </span><span class="entity"><span>rules</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Automation_Fail</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"Fail to derive any property"</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>|</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rule'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>thy</span></span><span>
        </span><span>|&gt;</span><span> </span><span>Local_Theory.declaration</span><span> </span><span class="main"><span>{</span></span><span>syntax</span><span class="main"><span>=</span></span><span>false</span><span class="main"><span>,</span></span><span> pervasive</span><span class="main"><span>=</span></span><span>false</span><span class="main"><span>,</span></span><span> pos</span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>3</span></span><span> </span><span class="entity"><span>instruction</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>lthy</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>lthy</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Config.map_generic</span><span> </span><span class="entity"><span>Phi_Reasoner.trace</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>=&gt;</span></span><span class="entity"><span>i</span></span><span>-</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
              </span><span>|&gt;</span><span> </span><span class="entity"><span>Phi_Reasoner.add_rule</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span>pos </span><span class="entity"><span>phi0</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Phi_Reasoner.TO_BE_OVERRIDE'</span></span><span>
                                       </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>the_default</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>reasoner_group</span></span><span> </span><span class="main"><span>%</span></span><span>φTA_derived_properties</span><span class="antiquote"><span>}</span></span></span></span><span>
                                                          </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span class="entity"><span>instruction</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                                       </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>[</span></span><span>Morphism.thm</span><span> </span><span class="entity"><span>m</span></span><span> </span><span class="entity"><span>rule'</span></span><span class="main"><span>]</span></span><span>
              </span><span>|&gt;</span><span> </span><span>Config.restore_generic</span><span> </span><span class="entity"><span>Phi_Reasoner.trace</span></span><span> </span><span class="entity"><span>lthy</span></span><span class="main"><span>)</span></span><span>
        </span><span>|&gt;</span><span> </span><span class="entity"><span>note_properties_s</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>phi0</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rule'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
        </span><span>|&gt;</span><span> </span><span>pair</span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rule'</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>semimodule_assoc_I</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deriver_framework</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>ACCEPT_ONE_HINT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ONLY_ONCE</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"Module_Assoc<span class="hidden">⇩</span><sub>I</sub>"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gen_MS</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>semimodule_assoc_E</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>deriver_framework</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>ACCEPT_ONE_HINT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ONLY_ONCE</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>"Module_Assoc<span class="hidden">⇩</span><sub>E</sub>"</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>gen_MS</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre>
</body>

</html>