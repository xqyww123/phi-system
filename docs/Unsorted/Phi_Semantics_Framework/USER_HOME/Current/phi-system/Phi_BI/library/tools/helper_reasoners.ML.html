<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹library/tools/helper_reasoners.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹library/tools/helper_reasoners.ML›</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>PHI_REASONERS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>include</span></span></span><span> </span><span class="entity"><span>PHI_REASONERS</span></span><span>

</span><span class="comment1"><span>(*For a ToA like ‹if C then A else B 𝗍𝗋𝖺𝗇𝗌𝖿𝗈𝗋𝗆𝗌 Y› that will be split to two subgoals and in which
  the schematic variables in the target ‹Y› may be instantiated to different values,
  reasoner_ToA_conditioned_subgoals merges the instantiations between the two subgoals.
  For example, if the two branches returns ‹Y[x/a]› and ‹Y[x/b]› respectively for different two
  instantiations ‹a› and ‹b›, reasoner_ToA_conditioned_subgoals returns ‹Y[x/(if C then a else b)]›
  for each schematic variable.

  See ‹case_sum A B x 𝗍𝗋𝖺𝗇𝗌𝖿𝗈𝗋𝗆𝗌 Y› as an example.

  The normal rule must of form, for example:
    ‹     Y ≡ If C Y<span class="hidden">⇩</span><sub>a</sub> Y<span class="hidden">⇩</span><sub>B</sub>
      ⟹ ⋯ such as X<span class="hidden">⇩</span><sub>a</sub> 𝗍𝗋𝖺𝗇𝗌𝖿𝗈𝗋𝗆𝗌 Y<span class="hidden">⇩</span><sub>a</sub>
      ⟹ If C X<span class="hidden">⇩</span><sub>a</sub> X<span class="hidden">⇩</span><sub>b</sub> 𝗍𝗋𝖺𝗇𝗌𝖿𝗈𝗋𝗆𝗌 Y ›
  with R:
    ‹     Y ≡ If C Y<span class="hidden">⇩</span><sub>a</sub> Y<span class="hidden">⇩</span><sub>B</sub>
      ⟹ ⋯ such as X<span class="hidden">⇩</span><sub>a</sub> 𝗍𝗋𝖺𝗇𝗌𝖿𝗈𝗋𝗆𝗌 Y<span class="hidden">⇩</span><sub>a</sub>
      ⟹ If C X<span class="hidden">⇩</span><sub>a</sub> X<span class="hidden">⇩</span><sub>b</sub> 𝗍𝗋𝖺𝗇𝗌𝖿𝗈𝗋𝗆𝗌 Y 𝗋𝖾𝗆𝖺𝗂𝗇𝗌 R ›
  quick rule is the quick-cut used when the Y contains no schematic variables.
  *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> reasoner_ToA_conditioned_subgoals </span><span class="main"><span>:</span></span><span>
          </span><span>thm</span><span> </span><span class="comment1"><span>(*rule having no Remainder*)</span></span><span> * </span><span>thm</span><span> </span><span class="comment1"><span>(*with conditioned Remainder*)</span></span><span> </span><span class="comment1"><span>(** thm (*necessarily with remainder*)*)</span></span><span> *
        </span><span class="main"><span>(</span></span><span> </span><span>bool</span><span> </span><span class="comment1"><span>(*if to split the source or to split the target*)</span></span><span> *
          </span><span>thm</span><span> </span><span>list</span><span> </span><span class="comment1"><span>(*rewrites degenerating the branch*)</span></span><span> * 
          </span><span>thm</span><span> </span><span>list</span><span> </span><span class="comment1"><span>(*reductions*)</span></span><span class="main"><span>)</span></span><span> *
        </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span>
            </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>indexname</span><span> * </span><span>typ</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> </span><span class="comment1"><span>(*vars in Y*)</span></span><span> * </span><span>cterm</span><span> </span><span class="comment1"><span>(*LHS, the Y*)</span></span><span> * </span><span>cterm</span><span> </span><span class="comment1"><span>(*RHS, the If C Y<span class="hidden">⇩</span><sub>a</sub> Y<span class="hidden">⇩</span><sub>B</sub>*)</span></span><span>
            </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>cterm</span><span> </span><span>Vars.table</span><span> </span><span class="comment1"><span>(*instantiations*)</span></span><span> * </span><span>term</span><span class="comment1"><span>(*the condition term*)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> *
        </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="comment1"><span>(*context for preparation time*)</span></span><span>
     </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> * </span><span>thm</span><span class="main"><span>)</span></span><span> </span><span>Seq.seq</span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Phi_Reasoners</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>PHI_REASONERS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Phi_Reasoners</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>reasoner_ToA_conditioned_subgoals</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ruleR</span></span><span class="main"><span>,</span></span><span> </span><span class="comment1"><span>(*ruleRT,*)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>split_source</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>degenerates</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>reds</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                                       </span><span class="entity"><span>mk_insts</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt_gen</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>has_remainder</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>No_Rem</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Has_Rem</span></span><span> </span><span class="comment1"><span>(*| True_Rem*)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>has_no_var</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>maxidx_of_term</span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>strip</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Trueprop|const"><span>Trueprop</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip</span></span><span> </span><span class="entity"><span>X</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Orelse_shortcut|const"><span>Orelse_shortcut</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>strip</span></span><span> </span><span class="entity"><span>X</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>strip</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>X</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>dest_Tr</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>split_source</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>2</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
             </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Syntax.dest_transformation</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>strip</span></span><span> </span><span class="main"><span>(</span></span><span>Logic.strip_assums_concl</span><span> </span><span class="entity"><span>tm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.REMAINS|const"><span>REMAINS</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Y</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span>
               </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Has_Rem</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.\&lt;phi&gt;Type|const"><span>φType</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.\&lt;phi&gt;Prod&apos;|const"><span>φProd'</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span>
               </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"BAD CONFIGURATION"</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>No_Rem</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_inst</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="entity"><span>abst</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>X</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_inst</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>abst</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>X</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>mk_inst</span></span><span> </span><span class="entity"><span>base</span></span><span> </span><span class="entity"><span>abst</span></span><span> </span><span class="main"><span>(</span></span><span>Var</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>take</span><span> </span><span class="entity"><span>abst</span></span><span> </span><span class="main"><span>(</span></span><span>binder_types</span><span> </span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Ty</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>Y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"_"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Ty</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>base</span></span><span>
             </span><span>|&gt;</span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt_gen</span></span><span>
             </span><span>|&gt;</span><span> </span><span>pair</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span class="entity"><span>ty</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_quick_rule</span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Y</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>dest_Tr</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.concl_of</span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Ys</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_filter</span><span> </span><span class="main"><span>(</span></span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>mk_inst</span></span><span> </span><span class="entity"><span>Y</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span>o</span><span> </span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>dest_Tr</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prems_of</span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Thm.instantiate</span><span> </span><span class="main"><span>(</span></span><span>TVars.empty</span><span class="main"><span>,</span></span><span> </span><span>Vars.make</span><span> </span><span class="entity"><span>Ys</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rule</span></span><span>
         </span><span>|&gt;</span><span> </span><span>Simplifier.rewrite_rule</span><span> </span><span class="entity"><span>ctxt_gen</span></span><span> </span><span class="entity"><span>degenerates</span></span><span>
         </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>HOL.refl</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>RS'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt_gen</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span>|&gt;</span><span> </span><span>Thm.trim_context</span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>quick_rule</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>quick_ruleR</span></span><span class="comment1"><span>(*, quick_ruleRT*)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>mk_quick_rule</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mk_quick_rule</span></span><span> </span><span class="entity"><span>ruleR</span></span><span class="comment1"><span>(*, mk_quick_rule ruleRT*)</span></span><span class="main"><span>)</span></span><span>

   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Seq.make</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Y</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>has_rem</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>dest_Tr</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.major_prem_of</span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>no_var</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span> </span><span class="comment1"><span>(*has_no_var Y*)</span></span><span> </span><span class="comment1"><span>(*BUG: this short cut has problem, so disabled, may re-enable it after fixing*)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>no_var</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>has_rem</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>No_Rem</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>quick_rule</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Has_Rem</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>quick_ruleR</span></span><span> </span><span class="comment1"><span>(*| True_Rem =&gt; quick_ruleRT*)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>has_rem</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>No_Rem</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Has_Rem</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ruleR</span></span><span> </span><span class="comment1"><span>(*| True_Rem =&gt; ruleRT*)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sequent'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rule'</span></span><span> </span><span class="entity"><span>RS'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>no_var</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Seq.empty</span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
      </span><span class="comment1"><span>(*val Y0 = case Thm.major_prem_of sequent'
                 of Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹Pure.eq›, _) $ Y $ _ =&gt; Y
                  | _ =&gt; error "BUG: reasoner_ToA_conditioned_subgoals: bad rule"*)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>equation0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'N</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>Phi_Help.strip_meta_hhf_c</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_implies</span><span> </span><span class="main"><span>(</span></span><span>Thm.cprop_of</span><span> </span><span class="entity"><span>sequent'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="comment1"><span>(*val qvar_names = Names.build (fold (Names.add_set o Term.term_name o Thm.term_of) qvars)
      val idx = Thm.maxidx_of sequent' *)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Y</span></span><span class="main"><span>,</span></span><span class="entity"><span>RHS</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>equation0</span></span><span>
                 </span><span>|&gt;</span><span> </span><span class="entity"><span>Phi_Help.dest_Trueprop_c</span></span><span>
                 </span><span>|&gt;</span><span> </span><span class="entity"><span>Phi_Help.dest_binop_c</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>vars</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Term.add_vars</span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>Y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
            </span><span class="comment1"><span>(*TODO: existing `mk_insts` have to be improved.
                    diverge the schematic variables in object side only and keeps variables in
                    types unchanged. May provide a generic implementation.*)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>inst</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>condition_term</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_insts</span></span><span> </span><span class="entity"><span>ctxt'N</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vars</span></span><span class="main"><span>,</span></span><span class="entity"><span>Y</span></span><span class="main"><span>,</span></span><span class="entity"><span>RHS</span></span><span class="main"><span>)</span></span><span>
    
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sequent''</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.instantiate</span><span> </span><span class="main"><span>(</span></span><span>TVars.empty</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>inst</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>sequent'</span></span><span>
               </span><span>|&gt;</span><span> </span><span>Tactic.rule_by_tactic</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span> </span><span>SOLVED'</span><span> </span><span class="main"><span>(</span></span><span>
                    </span><span class="entity"><span>Induct.cases_tac</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>true</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span>SOME</span><span> </span><span class="entity"><span>condition_term</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span>THEN_ALL_NEW</span><span>
                    </span><span class="entity"><span>Simplifier.asm_simp_tac</span></span><span> </span><span class="main"><span>(</span></span><span>Simplifier.clear_simpset</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>addsimps</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.refl|fact"><span>HOL.refl</span></a><span class="antiquote"><span>}</span></span></span></span><span> </span><span>::</span><span> </span><span class="entity"><span>reds</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent''</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>Seq.empty</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span></pre>
</body>

</html>