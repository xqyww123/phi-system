<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹library/reasoning/quantifier.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹library/reasoning/quantifier.ML›</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>BI_QUANTIFIERS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> defined_Ex </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>cterm</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>thm</span><span> </span><span>option</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>BI_Quantifiers</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>BI_QUANTIFIERS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="comment1"><span>(*
fun bi_conv (rule_L, rule_R) C ctxt ctm =
  (case (C ctxt (Thm.dest_arg1 ctm), C ctxt (Thm.dest_arg ctm))
     of (SOME th1, SOME th2) =&gt;
          SOME ((Conv.combination_conv (Conv.arg_conv (K th1)) (K th2) then_conv
                 Conv.rewr_conv rule_L then_conv
                 Conv.arg_conv (Conv.abs_conv (fn _ =&gt;
                   Conv.rewr_conv rule_R) ctxt)) ctm)
      | (SOME th1, _) =&gt;
          SOME ((Conv.arg1_conv (K th1) then_conv
                 Conv.rewr_conv rule_L) ctm)
      | (_, SOME th2) =&gt;
          SOME ((Conv.arg_conv (K th2) then_conv
                 Conv.rewr_conv rule_R) ctm)
      | _ =&gt; NONE)

fun skolemize_conv ctxt ctm =
  case Thm.term_of ctm
    of Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹disj›, _) $ _ $ _ =&gt;
        bi_conv (@{thm' ex_simps(3)[symmetric, folded atomize_eq]},
                 @{thm' ex_simps(4)[symmetric, folded atomize_eq]})
                skolemize_conv ctxt ctm
     | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹conj›, _) $ _ $ _ =&gt;
        bi_conv (@{thm' ex_simps(1)[symmetric, folded atomize_eq]},
                 @{thm' ex_simps(2)[symmetric, folded atomize_eq]})
                skolemize_conv ctxt ctm
*)</span></span><span>
</span><span class="comment1"><span>(*
fun lift_Boolean_Ex_to_BI_Ex ctxt ctm =
  case Thm.term_of ctm
    of Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹ExBI›, _) $ Abs _ =&gt;
        Conv.arg_conv (Conv.abs_conv (lift_Boolean_Ex_to_BI_Ex o snd) ctxt) ctm
     | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹Subjection›, _) $  *)</span></span><span>





</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>quick_check</span></span><span> </span><span class="entity"><span>quantifier</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lv</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lv</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>A</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="entity"><span>B</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Ex|const"><span>HOL.Ex</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lv</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>X</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>qchk</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>quantifier</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>qchk</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lv</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>false</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>qchk</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.Subjection|const"><span>Subjection</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>qchkB</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="entity"><span>P</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span>
            </span><span class="entity"><span>Phi_Syntax.forall_item_of_assertion</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.\&lt;phi&gt;Type|const"><span>φType</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>T</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>true</span><span> </span><span class="comment1"><span>(*not (Term.loose_bvar1 (T, lv))*)</span></span><span>
                 </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span>Term.loose_bvar1</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>X</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>lv</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>X</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>qchk</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>qchk</span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ExBI_boolean_Ex_lift</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>lemma</span></span><span>
        </span><span class="quoted"><span>‹ </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="keyword1"><span>𝗌𝗎𝖻𝗃</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="keyword1"><span>𝗌𝗎𝖻𝗃</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> ›</span></span><span>
        </span><span class="quasi_keyword"><span>by</span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.BI_eq_iff|fact"><span>BI_eq_iff</span></a><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span>)</span></span><span class="antiquote"><span>}</span></span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ExBI_boolean_Ex_lift'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>lemma</span></span><span>
        </span><span class="quoted"><span>‹ </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="keyword1"><span>𝗌𝗎𝖻𝗃</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Ex|const"><span>∃</span></a></span><span class="bound"><span>y</span></span><span class="main"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>≡</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="keyword1"><span>𝗌𝗎𝖻𝗃</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="bound"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>∧</span></a></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><span>)</span></span><span> ›</span></span><span>
        </span><span class="quasi_keyword"><span>by</span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.BI_eq_iff|fact"><span>BI_eq_iff</span></a><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/ISABELLE_HOME/src/Provers/clasimp.ML.html#HOL.clarsimp|method"><span class="operator"><span>clarsimp</span></span></a><span class="main"><span>)</span></span><span class="antiquote"><span>}</span></span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>sink_Ex_quantifier</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
       </span><span class="main"><span>(</span></span><span>  </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.BI_Ex_comm|fact"><span>BI_Ex_comm</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>then_conv</span><span>
          </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Conv.abs_conv_eta</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conv</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
        </span><span>else_conv</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>ExBI_boolean_Ex_lift'</span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                   </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
        </span><span>else_conv</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>ExBI_boolean_Ex_lift</span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                   </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
        </span><span>else_conv</span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>conv</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>defined_Ex_direct</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*Ex*)</span></span><span> </span><span>$</span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="comment1"><span>(*Subj*)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>X</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.ExBI_defined|fact"><span>ExBI_defined</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>ctm</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.ExBI_defined|fact"><span>ExBI_defined</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>ctm</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"BI.defined_Ex"</span></span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"BI.defined_Ex"</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>move_ex_L</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_simps|fact"><span>ex_simps</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
    </span><span>then_conv</span><span> </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span>Conv.abs_conv</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>move_ex_L</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span>else_conv</span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>move_ex_R</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_simps|fact"><span>ex_simps</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
    </span><span>then_conv</span><span> </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span>Conv.abs_conv</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>move_ex_R</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span>else_conv</span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>apply_conv</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>Conv.all_conv</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.eq|const"><span>HOL.eq</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.eq_commute|fact"><span>eq_commute</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>A</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="entity"><span>A</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                          </span><span>Conv.arg1_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                          </span><span class="entity"><span>move_ex_L</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.try_conv</span><span> </span><span class="main"><span>(</span></span><span>
                            </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj_assoc|fact"><span>conj_assoc</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="entity"><span>B</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                          </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                          </span><span class="entity"><span>move_ex_R</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                            </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj_left_commute|fact"><span>conj_left_commute</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>else_conv</span><span>
                             </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj_commute|fact"><span>conj_commute</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Ex|const"><span>HOL.Ex</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                          </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span>Conv.abs_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>C</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                       </span><span class="main"><span>(</span></span><span class="entity"><span>qchkB</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lv</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>qchkB</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>qchk</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.ExBI|const"><span>ExBI</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.Subjection|const"><span>Subjection</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                            </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span>Conv.abs_conv</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                            </span><span class="entity"><span>sink_Ex_quantifier</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>defined_Ex_direct</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                       </span><span class="main"><span>(</span></span><span class="entity"><span>qchkB</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lv</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>P</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>qchk</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.ExBI|const"><span>ExBI</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.BI_Ex_comm|fact"><span>BI_Ex_comm</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>then_conv</span><span>
                                </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Conv.abs_conv_eta</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>C</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="main"><span>(</span></span><span class="entity"><span>qchk</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lv</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>qchk</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>

   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>qchk</span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="comment1"><span>(*

fun move_conj qvar =
  let fun pop_left ctm =
        case Thm.term_of ctm
          of Const _ (*conj*) $ (Const (<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.eq›, _) $ _ $ _) $ _   =&gt; Conv.all_conv ctm
           | Const _ (*conj*) $ (Const (<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ _ $ _) $ _ =&gt; Conv.rewr_conv @{thm' conj_assoc[folded atomize_eq]} ctm
           | _ =&gt; error "BI.defined_Ex"

      fun pop_right ctm =
        case Thm.term_of ctm
          of Const _ (*conj*) $ _ $ (Const (<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.eq›, _) $ _ $ _)   =&gt; Conv.rewr_conv @{thm' conj_commute[folded atomize_eq]} ctm
           | Const _ (*conj*) $ _ $ (Const (<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ _ $ _) =&gt; Conv.rewr_conv @{thm' conj_left_commute[folded atomize_eq]} ctm
           | _ =&gt; error "BI.defined_Ex"

      fun conv ctm =
        case Thm.term_of ctm
          of Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.eq›, _) $ Free x $ Free y =&gt;
              if x = qvar then SOME (Conv.all_conv ctm)
              else if y = qvar then SOME (Conv.rewr_conv @{thm' eq_commute[folded atomize_eq]} ctm)
              else NONE
           | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.eq›, _) $ Free x $ _ =&gt;
              if x = qvar then SOME (Conv.all_conv ctm)
                          else NONE
           | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.eq›, _) $ _ $ Free x =&gt;
              if x = qvar then SOME (Conv.rewr_conv @{thm' eq_commute[folded atomize_eq]} ctm)
                          else NONE
           | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ _ $ _ =&gt;
             (case (conv (Thm.dest_arg1 ctm), conv (Thm.dest_arg ctm))
                of (SOME rewr, _) =&gt; SOME ((Conv.arg1_conv (K rewr) then_conv pop_left) ctm)
                 | (_, SOME rewr) =&gt; SOME ((Conv.arg_conv (K rewr) then_conv pop_right) ctm)
                 | _ =&gt; NONE)
           | _ =&gt; NONE
   in conv
  end

(*fun lift_boolean*)

*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>defined_Ex</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>NO_CONV</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>quick_check</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_BI.Phi_BI.html#Phi_BI.ExBI|const"><span>ExBI</span></a><span>›</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>cv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>(</span></span><span class="entity"><span>apply_conv</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>NONE</span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="comment1"><span>(*
fun defined_Ex ctxt ctm =
  let exception NO_CONV
   in if quick_check <span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹ExBI› (Thm.term_of ctm)
      then SOME (sink_Ex_quantifier (fn ctxt =&gt; fn ctm =&gt; 
              ((fn ctm =&gt;
                Conv.arg_conv (Phi_Conv.abs_conv_eta (fn (qvar, _) =&gt;
                  Conv.arg_conv (fn ctm =&gt;
                    case move_conj (dest_Free (Thm.term_of qvar)) ctm
                      of SOME ret =&gt; ret
                       | NONE =&gt; raise NO_CONV)
                ) ctxt) ctm
                handle NO_CONV =&gt; Conv.all_conv ctm) then_conv
              defined_Ex_direct) ctm)
              ctxt ctm)
      else NONE
  end
*)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="comment1"><span>(*
structure BI_Quantifiers = Quantifier1 (

  fun dest_eq (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.eq›,_) $ s $ t) = SOME (s, t)
    | dest_eq _ = NONE;
  fun dest_conj (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›,_) $ s $ t) = SOME (s, t)
    | dest_conj _ = NONE;
  fun dest_imp (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.implies›,_) $ s $ t) = SOME (s, t)
    | dest_imp _ = NONE;
  val conj = HOLogic.conj
  val imp  = HOLogic.imp

  val iff_reflection = @{thm' eq_reflection}
  val ex_iffI = @{lemma' ‹(P ⟹ Q) ⟹ (Q ⟹ P) ⟹ (A 𝗌𝗎𝖻𝗃 P) = (A 𝗌𝗎𝖻𝗃 Q)›
                     by (simp add: BI_eq_iff, blast)}
  val iff_trans = @{thm' trans}
  val conjI= @{thm' conjI}
  val conjE= @{thm' conjE}
  val impI = @{thm' impI}
  val mp   = @{thm' mp}
  val uncurry = @{thm' uncurry}
  val ex_comm = @{thm' BI_Ex_comm}
  val all_comm = @{thm' BI_All_comm}
  val iff_exI = @{thm' BI_iff_exI}
  val iff_allI = @{thm' BI_iff_allI}
  val exE = @{thm' BI_exE}

  val atomize =
    let val rules = @{thms atomize_all atomize_imp atomize_eq atomize_conj}
    in fn ctxt =&gt; Raw_Simplifier.rewrite ctxt true rules end
)

(*


signature BI_QUANTIFIER1 = sig
include QUANTIFIER1

val nominal : ctyp -&gt; cterm
val nominal_sat : ctyp -&gt; cterm

end

structure BI_Quantifiers : BI_QUANTIFIER1 = struct

val nominal0_idx = (("'c",0),<span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span>‹type›)
val nominal0_ty = <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹set ‹TVar nominal0_idx››
val nominal0_tm = Free("_𝖼_", nominal0_ty)
val nominal0_sat_tm = <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Satisfaction nominal0_ty› $ nominal0_tm
val nominal0_cty = Thm.trim_context_cty (Thm.ctyp_of <span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span> nominal0_ty)
val nominal0 = Thm.trim_context_cterm (Thm.cterm_of <span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span> nominal0_tm)
val nominal0_sat = Thm.trim_context_cterm (Thm.cterm_of <span class="hidden">\&lt;^</span><span class="control">context</span><span class="hidden">&gt;</span> nominal0_sat_tm)

fun nominal cty = Thm.instantiate_cterm (TVars.make [(nominal0_idx, cty)], Vars.empty) nominal0
fun nominal_sat cty = Thm.instantiate_cterm (TVars.make [(nominal0_idx, cty)], Vars.empty) nominal0_sat
  

structure Q1 = Quantifier1 (

  fun dest_eq (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.eq›,_) $ s $ t) = SOME (s, t)
    | dest_eq _ = NONE;
  fun dest_conj (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›,_) $ s $ t) = SOME (s, t)
    | dest_conj _ = NONE;
  fun dest_imp (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.implies›,_) $ s $ t) = SOME (s, t)
    | dest_imp _ = NONE;
  val conj = HOLogic.conj
  val imp  = HOLogic.imp

  val iff_reflection = @{thm' eq_reflection}
  val iffI = @{thm' iffI}
  val iff_trans = @{thm' trans}
  val conjI= @{thm' conjI}
  val conjE= @{thm' conjE}
  val impI = @{thm' impI}
  val mp   = @{thm' mp}
  val uncurry = @{thm' uncurry}

  val exI = @{lemma' ‹nominal0 ⊨ S x ⟹ nominal0 ⊨ (ExBI S)›
                  by (simp, blast)}
)

open Q1

end
*)
*)</span></span></pre>
</body>

</html>