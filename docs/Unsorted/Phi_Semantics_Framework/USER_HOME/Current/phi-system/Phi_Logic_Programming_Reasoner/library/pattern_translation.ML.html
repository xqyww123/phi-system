<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹library/pattern_translation.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹library/pattern_translation.ML›</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>PATTERN_REWRITE_GLOBAL</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>redex_residues</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spattern</span></span><span> * </span><span>term</span><span> </span><span>list</span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>redex_residue</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>spattern</span></span><span> * </span><span>term</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rewrites </span><span class="main"><span>:</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>PLPR_Pattern.fixed_bounds</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bvs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>redex_residues</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span>option</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rewrite  </span><span class="main"><span>:</span></span><span> </span><span>theory</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>PLPR_Pattern.fixed_bounds</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bvs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>redex_residue</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>option</span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>PATTERN_REWRITE</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>ML_rewr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>spattern</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span>option</span><span>
</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>rewrite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>By_Pattern</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> term list
                 </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>By_ML</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> ML_rewr
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> rewrite_eq </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rewrite</span></span><span> * </span><span class="entity"><span>rewrite</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>rewr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int</span><span> * </span><span class="entity"><span>spattern</span></span><span> * </span><span>Position.T</span><span> * </span><span class="entity"><span>rewrite</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> add </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rewr</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> remove </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>rewr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Context.generic</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> translate </span><span class="main"><span>:</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>bvs</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> setup_attribute </span><span class="main"><span>:</span></span><span> </span><span>binding</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span>
                  </span><span class="main"><span>-&gt;</span></span><span> </span><span>theory</span><span>
                  </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>ML_rewr</span></span><span> </span><span>option</span><span> </span><span>Unsynchronized.ref</span><span> * </span><span>theory</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> list_rewrites </span><span class="main"><span>:</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rewr</span></span><span> </span><span>list</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> print_rewrite  </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>rewr</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>Pretty.T</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> print_rewrites </span><span class="main"><span>:</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>unit</span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Pattern_Translation</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>PATTERN_REWRITE_GLOBAL</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>redex_residues</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>term</span><span> * </span><span>term</span><span> </span><span>list</span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>redex_residue</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>term</span><span> * </span><span>term</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rewrites</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>fixed_bounds</span></span><span> </span><span class="entity"><span>bvs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span class="entity"><span>rets</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>PLPR_Pattern.smatch</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>fixed_bounds</span></span><span> </span><span class="entity"><span>bvs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>term</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Vartab.empty</span><span class="main"><span>,</span></span><span> </span><span>Vartab.empty</span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Envir.subst_term</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rets</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>Pattern.MATCH</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>NONE</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rewrite</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>fixed_bounds</span></span><span> </span><span class="entity"><span>bv_typs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Option.map</span><span> </span><span>hd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rewrites</span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="entity"><span>fixed_bounds</span></span><span> </span><span class="entity"><span>bv_typs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span class="entity"><span>ret</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>term</span></span><span class="main"><span>)</span></span><span>

      

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>PLP_Reasoner_Pattern_Parse_Sender</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Data</span><span> </span><span class="main"><span>(</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span>option</span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>init</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>K</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>functor</span></span></span><span> </span><span class="entity"><span>Pattern_Translation</span></span><span> </span><span class="main"><span>(</span></span><span>Config </span><span class="main"><span>:</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> parse_pattern </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> check_pattern </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span>list</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> multi_translation_err_msg </span><span class="main"><span>:</span></span><span> </span><span>string</span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>PATTERN_REWRITE</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>ML_rewr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Context.generic</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>spattern</span></span><span> </span><span>list</span><span> </span><span>option</span><span>
</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>rewrite</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>By_Pattern</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> term list </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>By_ML</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> ML_rewr

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Store</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Term_Pattern_Store</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>T</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>rewrite</span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>By_Pattern</span></span><span> </span><span class="entity"><span>tms1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>By_Pattern</span></span><span> </span><span class="entity"><span>tms2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>eq_list</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>tms1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>tms2</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>By_ML</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>By_ML</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>eq</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>export</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>By_Pattern</span></span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="entity"><span>By_Pattern</span></span><span> </span><span class="main"><span>(</span></span><span>Variable.export_terms</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span> </span><span class="entity"><span>terms</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>export</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>By_ML</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>By_ML</span></span><span> </span><span class="entity"><span>f</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>rewr</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Store.entry</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>add</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Store.add</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>remove</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Store.remove</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>list_rewrites</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Store.list</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rewrite_eq</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Store.Config.eq</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>local</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Pretty</span><span> </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_rewrite</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span class="entity"><span>pos</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>By_Pattern</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>dest</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>item</span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span>str</span><span> </span><span class="inner_quoted"><span>"("</span></span><span class="main"><span>,</span></span><span> </span><span>str</span><span> </span><span class="main"><span>(</span></span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>str</span><span> </span><span class="inner_quoted"><span>") "</span></span><span class="main"><span>,</span></span><span> </span><span>block</span><span> </span><span class="main"><span>[</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pat</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>str</span><span> </span><span class="inner_quoted"><span>" ⇒ "</span></span><span class="main"><span>,</span></span><span> </span><span>block</span><span> </span><span class="main"><span>[</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>dest</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>str</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span>here</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_rewrite</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span class="entity"><span>pos</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>By_Pattern</span></span><span> </span><span class="entity"><span>dests</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>item</span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span>str</span><span> </span><span class="inner_quoted"><span>"("</span></span><span class="main"><span>,</span></span><span> </span><span>str</span><span> </span><span class="main"><span>(</span></span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>str</span><span> </span><span class="inner_quoted"><span>") "</span></span><span class="main"><span>,</span></span><span> </span><span>block</span><span> </span><span class="main"><span>[</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pat</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>str</span><span> </span><span class="inner_quoted"><span>" ⇒ "</span></span><span class="main"><span>,</span></span><span> </span><span>block</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>d</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>item</span><span> </span><span class="main"><span>[</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>d</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>dests</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>str</span><span> </span><span class="inner_quoted"><span>" "</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span>here</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>print_rewrite</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span class="entity"><span>pos</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>By_ML</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>item</span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span>str</span><span> </span><span class="inner_quoted"><span>"("</span></span><span class="main"><span>,</span></span><span> </span><span>str</span><span> </span><span class="main"><span>(</span></span><span>string_of_int</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>str</span><span> </span><span class="inner_quoted"><span>") "</span></span><span class="main"><span>,</span></span><span> </span><span>block</span><span> </span><span class="main"><span>[</span></span><span>Syntax.pretty_term</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>pat</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
            </span><span>str</span><span> </span><span class="inner_quoted"><span>" ⇒ ML rewriter "</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span> </span><span>here</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>print_rewrites</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> 
      </span><span>writeln</span><span> </span><span class="main"><span>(</span></span><span>chunks</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>print_rewrite</span></span><span> </span><span class="main"><span>(</span></span><span>Context.proof_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>list_rewrites</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>do_rewrite</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bvs</span></span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pat0</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>By_Pattern</span></span><span> </span><span class="entity"><span>ret0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Pattern_Translation.rewrites</span></span><span> </span><span class="main"><span>(</span></span><span>Context.theory_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bvs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ret0</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>term</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>do_rewrite</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bvs</span></span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>By_ML</span></span><span> </span><span class="entity"><span>rewr</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>Option.map</span><span> </span><span class="main"><span>(</span></span><span>pair</span><span> </span><span class="entity"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rewr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>term</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rewr_clash</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>ret2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>error</span><span> </span><span class="main"><span>(</span></span><span>Pretty.string_of</span><span> </span><span class="main"><span>(</span></span><span>Pretty.chunks</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"Multiple potential patterns are available:"</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
        </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_term</span><span> </span><span class="main"><span>(</span></span><span>Context.proof_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
        </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="inner_quoted"><span>"versus"</span></span><span class="main"><span>]</span></span><span> </span><span>@</span><span>
        </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Syntax.pretty_term</span><span> </span><span class="main"><span>(</span></span><span>Context.proof_of</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ret2</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span>
        </span><span class="main"><span>[</span></span><span>Pretty.str</span><span> </span><span class="entity"><span>Config.multi_translation_err_msg</span></span><span class="main"><span>]</span></span><span>
     </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>get_distinct_seq</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>seq</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Seq.pull</span><span> </span><span class="entity"><span>seq</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>n'</span></span><span class="main"><span>,</span></span><span class="entity"><span>ret'</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>seq'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>n'</span></span><span> </span><span>&lt;</span><span> </span><span class="entity"><span>n</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>ret</span></span><span>
                                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>eq_set</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>op</span></span></span><span> </span><span>aconv</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ret</span></span><span class="main"><span>,</span></span><span class="entity"><span>ret'</span></span><span class="main"><span>)</span></span><span>
                                 </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>get_distinct_seq</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>seq'</span></span><span>
                                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>rewr_clash</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n'</span></span><span class="main"><span>,</span></span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ret</span></span><span>

</span><span class="comment1"><span>(*the term cannot contain loose bounded variables*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_translate</span></span><span> </span><span class="entity"><span>rewr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>get</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Store.get</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>bvs</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>term</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
       </span><span class="entity"><span>get</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bvs</span></span><span> </span><span class="entity"><span>term</span></span><span>
    </span><span>|&gt;</span><span> </span><span>Seq.of_list</span><span>
    </span><span>|&gt;</span><span> </span><span>Seq.map_filter</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rewr</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>bvs</span></span><span> </span><span class="entity"><span>term</span></span><span class="main"><span>)</span></span><span>
    </span><span>|&gt;</span><span> </span><span>Seq.pull</span><span>
    </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>seq</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>get_distinct_seq</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>n</span></span><span class="main"><span>,</span></span><span class="entity"><span>ret</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>seq</span></span><span>
         </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>translate</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_translate</span></span><span> </span><span class="entity"><span>do_rewrite</span></span><span>

</span><span class="comment1"><span>(*fun parse_pats ctxt ((p1,p2),n) =
  let val ctxt_p = Proof_Context.set_mode Proof_Context.mode_pattern ctxt
      val (p1'::p2') = Config.check_pattern ctxt_p (Config.parse_pattern ctxt_p p1 ::
                                               map (Config.parse_pattern ctxt_p) p2)
   in (n,p1', By_Pattern p2')
  end*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>app2</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>app2</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h1</span></span><span>::</span><span class="entity"><span>L1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h2</span></span><span>::</span><span class="entity"><span>L2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>h1</span></span><span class="main"><span>,</span></span><span class="entity"><span>h2</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="entity"><span>app2</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>L1</span></span><span> </span><span class="entity"><span>L2</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(*
val pat2 =
   ((Scan.lift (Parse.position Args.internal_term --| (<span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span>‹=&gt;› || <span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span>‹⇒›) --
     Scan.repeat1 Args.internal_term --| <span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span>‹(› -- Parse.nat --| <span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span>‹)›))
  &gt;&gt; (fn (((p1,pos),p2),n) =&gt; (n,p1,pos, By_Pattern p2)))
|| ((Args.context -- Scan.lift (Parse.position (Parse.token Parse.embedded) --| (<span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span>‹=&gt;› || <span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span>‹⇒›)
                  -- Scan.repeat1 (Parse.token Parse.embedded) --| <span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span>‹(› -- Parse.nat --| <span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span>‹)›))
  &gt;&gt; (fn (ctxt,(((tok_p1,pos),tok_p2),n)) =&gt;
    let val p1 = Token.inner_syntax_of tok_p1
        val p2 = map (Token.inner_syntax_of) tok_p2
        val ctxt_p = Proof_Context.set_mode Proof_Context.mode_pattern ctxt
        val (p1'::p2') = Config.check_pattern ctxt_p (Config.parse_pattern ctxt_p p1 ::
                                                 map (Config.parse_pattern ctxt_p) p2)
        val _ = Token.assign (SOME (Token.Term p1')) tok_p1
        val _ = app2 (fn (tok,p') =&gt; Token.assign (SOME (Token.Term p')) tok) tok_p2 p2'
     in (n,p1',pos, By_Pattern p2')
     end))

val term_pattern = Scan.peek (fn generic =&gt; Parse.position (Args.named_term (
      let val ctxt = Proof_Context.set_mode Proof_Context.mode_pattern (Context.proof_of generic)
       in singleton (Config.check_pattern ctxt) o Config.parse_pattern ctxt end)))

val pat_ML = (Args.context -- term_pattern -- Scan.lift ((<span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span>‹=&gt;› || <span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span>‹⇒›)
                          |-- Parse.ML_source --| <span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span>‹(› -- Parse.nat --| <span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span>‹)›))
  &gt;&gt; (fn ((ctxt,(p1',pos)),(src,n)) =&gt;
    let val ctxt' = Context.Proof ctxt
            |&gt; ML_Context.expression (Input.pos_of src)
              (ML_Lex.read "Theory.local_setup (PLP_Reasoner_Pattern_Parse_Sender.put ((" @
               ML_Lex.read_source src @
               ML_Lex.read ") : Context.generic -&gt; term -&gt; term list option))")
     in (n,p1',pos, By_ML (PLP_Reasoner_Pattern_Parse_Sender.get (Context.the_proof ctxt')))
     end)
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cached_parser</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Scan.repeat1</span><span> </span><span>Args.internal_term</span><span> </span><span>&gt;&gt;</span><span> </span><span class="entity"><span>By_Pattern</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>T_parser</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Scan.repeat1</span><span> </span><span class="main"><span>(</span></span><span>Parse.token</span><span> </span><span>Parse.embedded</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>setup_attribute</span></span><span> </span><span class="entity"><span>binding</span></span><span> </span><span class="entity"><span>access_to_sender</span></span><span> </span><span class="entity"><span>comment</span></span><span> </span><span class="main"><span>=</span></span><span>
    </span><span class="entity"><span>Store.setup_decl_attr</span></span><span> </span><span class="entity"><span>binding</span></span><span> </span><span class="entity"><span>cached_parser</span></span><span> </span><span class="entity"><span>T_parser</span></span><span>
      </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p1</span></span><span class="main"><span>,</span></span><span class="entity"><span>emb</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>p2</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Token.inner_syntax_of</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>emb</span></span><span>
              </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p1'</span></span><span>::</span><span class="entity"><span>p2'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Config.check_pattern</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                                    </span><span class="main"><span>(</span></span><span class="entity"><span>Config.parse_pattern</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>p1</span></span><span> </span><span>::</span><span>
                                     </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Config.parse_pattern</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>p2</span></span><span class="main"><span>)</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>p1'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>By_Pattern</span></span><span> </span><span class="entity"><span>p2'</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>comment</span></span><span>
 </span><span>#&gt;</span><span> </span><span class="entity"><span>Store.setup_decl_ML_attr</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.suffix_name</span><span> </span><span class="inner_quoted"><span>"_ML"</span></span><span> </span><span class="entity"><span>binding</span></span><span class="main"><span>)</span></span><span>
                             </span><span class="entity"><span>access_to_sender</span></span><span>
                             </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>singleton</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Config.check_pattern</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Config.parse_pattern</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                             </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>By_ML</span></span><span class="main"><span>)</span></span><span>
                             </span><span class="entity"><span>comment</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre>
</body>

</html>