<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹library/tools/patch_for_Ex.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹library/tools/patch_for_Ex.ML›</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>PHI_REASONERS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>include</span></span></span><span> </span><span class="entity"><span>PHI_REASONERS</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> existential_obligation </span><span class="main"><span>:</span></span><span> </span><span>int</span><span> </span><span>Config.T</span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Phi_Reasoners</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>PHI_REASONERS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Phi_Reasoners</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>existential_obligation</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Config.declare_int</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Phi_Reasoners.existential_obligation"</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span class="entity"><span>⌂</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Theory.setup</span><span> </span><span class="main"><span>(</span></span><span>
  </span><span class="entity"><span>Attrib.setup</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">binding</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="entity_def" id="PLPR.\&lt;phi&gt;reason_mode_existential_obligation|attribute"><span>φreason_mode_existential_obligation</span></span><span>›</span></span></span><span> </span><span class="main"><span>(</span></span><span>
    </span><span>Scan.lift</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>=</span></span><span>›</span></span></span><span> </span><span>|--</span><span>
      </span><span class="main"><span>(</span></span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"yes"</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span>||</span><span> </span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"no"</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span>||</span><span> </span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"enhanced"</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="inner_numeral"><span>2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span>&gt;&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.declaration_attribute</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="main"><span>(</span></span><span>Config.put_generic</span><span> </span><span class="entity"><span>existential_obligation</span></span><span> </span><span class="entity"><span>mode</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>)</span></span><span> </span><span class="inner_quoted"><span>"set the mode how φ-LPR generates existential quantificatino in the obligation.\n\
    \0: do not generate existence in obligations, leaving them schematic variables\n\
    \1: generate existence in obligations\n\
    \2: generate existence in obligations and apply a special patch on them to enhance the automation\
    \of Isabelle for solving them (using introduction rules)"</span></span><span>
</span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>PHI_CONV</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>include</span></span></span><span> </span><span class="entity"><span>PHI_CONV</span></span><span>

</span><span class="comment1"><span>(* (P ⟶ Q1) ∧ (P ⟶ Q2) ∧ … ∧ (P --&gt; Qn)
 --------------------------------------------
   P ⟶ (Q1 ∧ Q2 ∧ ... ∧ Qn)
 *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> zip_conjs </span><span class="main"><span>:</span></span><span> </span><span>conv</span><span>
</span><span class="comment1"><span>(*recursively for each nested implication*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> zip_conjs_recursively </span><span class="main"><span>:</span></span><span> </span><span>conv</span><span>

</span><span class="comment1"><span>(* (* (∀x. P1 x) ∧ (∀x. P2 x) … ∧ (∀x. Pn x) ⟶ (∀x. P1 x ∧ P2 x ∧ … Pn x)) *)
val zip_Alls : conv
val zip_Alls_recursively : Proof.context -&gt; conv *)</span></span><span>

</span><span class="comment1"><span>(*
val zip_All_conj_recursively : Proof.context -&gt; conv
*)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> move_Ex_inside_All </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> move_Ex_inside_All_recursive </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> move_sp_Ex_inside_All </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> move_sp_Ex_inside_All_recursive </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> move_Ex_downto_Disj </span><span class="main"><span>:</span></span><span> </span><span>conv</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> move_Ex_downto_Disj_recursive </span><span class="main"><span>:</span></span><span> </span><span>conv</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> move_sp_Ex_downto_Disj </span><span class="main"><span>:</span></span><span> </span><span>conv</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> move_sp_Ex_downto_Disj_recursive </span><span class="main"><span>:</span></span><span> </span><span>conv</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>

</span><span class="comment1"><span>(*move inside to ∀ and ∨, with zipping over ∧*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> move_Ex_inside </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> move_sp_Ex_inside </span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>conv</span><span>

</span><span class="comment1"><span>(*
(*move to inside any ∀ and ∨, with zip over ∧ and ∀, exhaustively*)
val move_Ex_inside_exhaustively : Proof.context -&gt; conv
val move_sp_Ex_inside_exhaustively : Proof.context -&gt; conv*)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Phi_Conv</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>PHI_CONV</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>
</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Phi_Conv</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>zip_conjs</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.imp_conjR|fact"><span>imp_conjR</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>ctm</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.simp_thms|fact"><span>HOL.simp_thms</span></a><span class="main"><span>(</span></span><span>21</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>ctm</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.simp_thms|fact"><span>HOL.simp_thms</span></a><span class="main"><span>(</span></span><span>22</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>ctm</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span>Conv.arg1_conv</span><span> </span><span class="entity"><span>zip_conjs</span></span><span> </span><span>then_conv</span><span> </span><span class="entity"><span>zip_conjs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="main"><span>(</span></span><span>Conv.arg_conv</span><span> </span><span class="entity"><span>zip_conjs</span></span><span> </span><span>then_conv</span><span> </span><span class="entity"><span>zip_conjs</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
     </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Phi_Conv.zip_conjs"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>zip_conjs_recursively</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>zip_conjs</span></span><span> </span><span>then_conv</span><span> </span><span class="entity"><span>HOLogic.imp_conv</span></span><span> </span><span>Conv.all_conv</span><span> </span><span class="entity"><span>zip_conjs_recursively</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.all_conv</span><span> </span><span class="entity"><span>ctm</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>zip_conjs_recursively1</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>zip_conjs</span></span><span> </span><span>then_conv</span><span> </span><span class="entity"><span>zip_conjs_recursively</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>bound_occurs</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span>Bound</span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>j</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>bound_occurs</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bound_occurs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>X</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>bound_occurs</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>bound_occurs</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>A</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span> </span><span class="entity"><span>bound_occurs</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="entity"><span>B</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>bound_occurs</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="comment1"><span>(*mv_over_conj: (Qx. A ∧ B x) ≡ A ∧ (Qx. B)
  rm_trivial: (Qx. A) ≡ A *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>sink_quantifier_over_conjs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>quant_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mv_over_conj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rm_trivial</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>swap_rule</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>part</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>All</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>No</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Mix</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> thm
      </span><span class="comment1"><span>(*given a conj-tree containing some leaves that are ex-quantified or not,
        this process sorts the tree such that all the quantified leaves are in the right child of the root
        and all the not-quantified are in the left child.
        All means the current subtree's leaves are all quantified,
        No means none of leaves are,
        Mix means all quantified leaves are in the right child and all that not are in the left,
            after the conversion given as the thm*)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>partition_conj</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>partition_conj</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>partition_conj</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>No</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>No</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>      </span><span class="entity"><span>No</span></span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>No</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>All</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>     </span><span class="entity"><span>Mix</span></span><span> </span><span class="main"><span>(</span></span><span>Conv.all_conv</span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>No</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Mix</span></span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>  </span><span class="entity"><span>Mix</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                                            </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj_assoc|fact"><span>HOL.conj_assoc</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>All</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>No</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>     </span><span class="entity"><span>Mix</span></span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj_commute|fact"><span>HOL.conj_commute</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>All</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>All</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>    </span><span class="entity"><span>All</span></span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>All</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Mix</span></span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Mix</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>th</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                                           </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj_left_commute|fact"><span>HOL.conj_left_commute</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Mix</span></span><span> </span><span class="entity"><span>tha</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>No</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Mix</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Conv.arg1_conv</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>tha</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                                            </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.partition_conj_MN|fact"><span>partition_conj_MN</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Mix</span></span><span> </span><span class="entity"><span>tha</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>All</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Mix</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Conv.arg1_conv</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>tha</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                                             </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj_assoc|fact"><span>HOL.conj_assoc</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Mix</span></span><span> </span><span class="entity"><span>tha</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Mix</span></span><span> </span><span class="entity"><span>thb</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Mix</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Conv.arg1_conv</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>tha</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                                                 </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>thb</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                                                 </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.partition_conj_MM|fact"><span>partition_conj_MM</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>exists_subterm</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>N'</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>N'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>X</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>All</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>No</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>quick_chk1</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>A</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
           </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>quick_chk1</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>quick_chk1</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>All</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>All</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>All</span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>No</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>No</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>No</span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>Mix</span></span><span> </span><span>Drule.dummy_thm</span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>quick_chk1</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>bound_occurs</span></span><span> </span><span class="entity"><span>var</span></span><span> </span><span class="entity"><span>X</span></span><span>
                             </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>All</span></span><span>
                             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>No</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>quick_chk</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Y</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>quant_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>quick_chk</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>quick_chk1</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="entity"><span>Y</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>quick_chk</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="main"><span>(</span></span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>quick_chk</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lv</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>X</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>quick_chk</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>quick_chk1</span></span><span> </span><span class="entity"><span>lv</span></span><span> </span><span class="entity"><span>X</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>quick_chk0</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>quant_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>quick_chk</span></span><span> </span><span class="inner_numeral"><span>~1</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"sink_quantifier_over_conjs"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"sink_quantifier_over_conjs"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>open_quant</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>quant_name</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                             </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>Conv.arg_conv</span><span> </span><span class="entity"><span>Phi_Conv.inverse_eta_conv</span></span><span> </span><span>then_conv</span><span>
                                     </span><span class="entity"><span>open_quant</span></span><span> </span><span class="entity"><span>C</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>)</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"sink_quantifier_over_conjs"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>   </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"sink_quantifier_over_conjs"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>quick_chk0</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>All</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"sink_quantifier_over_conjs: unfeasible"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>No</span></span><span>  </span><span class="main"><span>=&gt;</span></span><span> </span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>rm_trivial</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
      </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
        </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>open_quant</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>tm</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                 </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Conv.quant_conv</span></span><span> </span><span class="entity"><span>quant_name</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cvar</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>cvar</span></span><span>
                     </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>partition_conj</span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                          </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>Mix</span></span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>th</span></span><span>
                           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"BUG sWz5mwYCSD2Wd08rPgFKEQ"</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
                  </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                  </span><span>then_conv</span><span> </span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>mv_over_conj</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
             </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>quant_name</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>swap_rule</span></span><span> </span><span>then_conv</span><span>
                        </span><span class="entity"><span>Phi_Conv.quant_conv</span></span><span> </span><span class="entity"><span>quant_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conv</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"sink_quantifier_over_conjs: no conj"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
             </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"sink_quantifier_over_conjs: no conj"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
       </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sink_All_over_conjs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>sink_quantifier_over_conjs</span></span><span>
        </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.All|const"><span>HOL.All</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.all_simps|fact"><span>HOL.all_simps</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.simp_thms|fact"><span>HOL.simp_thms</span></a><span class="main"><span>(</span></span><span>35</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
                              </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.all_comm|fact"><span>HOL.all_comm</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(*
fun zip_Alls ctm =
  case Thm.term_of ctm
    of Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ _ $ _) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ _ $ _) =&gt;
        HOLogic.conj_conv zip_Alls zip_Alls ctm
     | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ _) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ _ $ _) =&gt;
        HOLogic.conj_conv Conv.all_conv zip_Alls ctm
     | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ _) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ _ ) =&gt;
        Conv.rewr_conv @{thm' all_conj_distrib[folded atomize_eq, symmetric]} ctm
     | _ =&gt; raise CTERM ("Phi_Conv.zip_Alls", [ctm])

fun zip_Alls_recursively ctxt ctm =
  (zip_Alls then_conv HOLogic.All_conv (zip_Alls_recursively o snd) ctxt) ctm
  handle CTERM _ =&gt; Conv.all_conv ctm


fun zip_Alls__same_quantifier' (Name,cTy) =
  let val Ty = Thm.typ_of cTy
      val name = (Name, Ty)
      fun has_the_quantifier (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ Abs (N,Ty,X))
          (*It is not the strongest as it does not consider the quantifiers hidden down to conjunctions*)
            = name = (N,Ty) orelse has_the_quantifier X
        | has_the_quantifier (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.implies›, _) $ _ $ X) = has_the_quantifier X
        | has_the_quantifier _ = false

      fun swap_the_quantifier ctm =
        case Thm.term_of ctm
          of Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ Abs (N,Ty,_) =&gt;
              if name = (N,Ty) then Conv.all_conv ctm
              else (swap_the_quantifier then_conv Conv.rewr_conv @{thm' all_comm[folded atomize_eq]}) ctm
           | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.implies›, _) $ _ $ _ =&gt;
              (swap_the_quantifier then_conv Conv.rewr_conv @{thm' HOL.all_simps(6)[folded atomize_eq, symmetric]}) ctm
           | _ =&gt; raise CTERM ("Phi_Conv.swap_the_quantifier", [ctm])

      val rule0 = @{thm' HOL.simp_thms(35)[folded atomize_eq, symmetric]}
               |&gt; Thm.instantiate (TVars.make [((("b",0),<span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span>‹type›),cTy)], Vars.empty)
      val P = Var (("P",0),<span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹bool›)
      val prop = <span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹Pure.eq <span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span>‹bool›› $ P $ (<span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span>‹HOL.All Ty› $ Abs (Name,Ty,P))
      val rule = Thm.renamed_prop prop rule0

      fun swap_the_quantifier_or_wear_the_hat ctm =
        if has_the_quantifier (Thm.term_of ctm)
        then swap_the_quantifier ctm
        else Conv.rewr_conv rule ctm (*wear a hat*)

      fun zip ctm =
        case Thm.term_of ctm
          of Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ _ $ _) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ _ $ _) =&gt;
                HOLogic.conj_conv zip zip ctm
           | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ XX)
                                            $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ _ $ _) =&gt;
                (case XX of Abs (N,Ty,_) =&gt;
                    if name = (N,Ty) then HOLogic.conj_conv Conv.all_conv zip ctm
                    else (Conv.arg1_conv swap_the_quantifier_or_wear_the_hat then_conv zip) ctm
                  | _ =&gt; (Conv.arg1_conv (Conv.arg_conv Phi_Conv.inverse_eta_conv) then_conv zip) ctm)
           | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ _ $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ _ $ _) =&gt;
                (Conv.arg1_conv swap_the_quantifier_or_wear_the_hat then_conv zip) ctm
           | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ X1)
                                            $ (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ X2) =&gt;
               (case X1 of Abs (Na,Tya,_) =&gt;
                 (case X2 of Abs (Nb,Tyb,_) =&gt;
                      if name &lt;&gt; (Na,Tya)
                      then (Conv.arg1_conv swap_the_quantifier_or_wear_the_hat then_conv zip) ctm
                      else if name &lt;&gt; (Nb,Tyb)
                      then (Conv.arg_conv swap_the_quantifier_or_wear_the_hat then_conv zip) ctm
                      else Conv.rewr_conv @{thm' all_conj_distrib[folded atomize_eq, symmetric]} ctm
                    | _ =&gt; (Conv.arg_conv (Conv.arg_conv Phi_Conv.inverse_eta_conv) then_conv zip) ctm)
                 | _ =&gt; (Conv.arg1_conv (Conv.arg_conv Phi_Conv.inverse_eta_conv) then_conv zip) ctm)
           | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ X $ Y =&gt;
              ((case X of Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ _ =&gt; Conv.all_conv
                        | _ =&gt; Conv.arg1_conv swap_the_quantifier_or_wear_the_hat) then_conv
               (case Y of Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ _ =&gt; Conv.all_conv
                        | _ =&gt; Conv.arg_conv  swap_the_quantifier_or_wear_the_hat) then_conv
               zip) ctm
           | _ =&gt; raise CTERM ("Phi_Conv.zip_Alls__same_name", [ctm])

   in zip
  end

fun choose_zip_All_quantifier tm =
  let fun collect_quantifiers_one (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ Abs (N,Ty,X)) =
              (N,Ty) :: collect_quantifiers_one X
        | collect_quantifiers_one (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ X) = collect_quantifiers_one X
        | collect_quantifiers_one (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.implies›, _) $ _ $ X) = collect_quantifiers_one X
        | collect_quantifiers_one (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ A $ B) =
            let val La = collect_quantifiers_one A
                val Lb = collect_quantifiers_one B
             in if length La &gt;= length Lb then La else Lb
            end
        | collect_quantifiers_one _ = []
      fun collect_quantifiers (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ A $ B) =
            collect_quantifiers A @ collect_quantifiers B
        | collect_quantifiers X = [collect_quantifiers_one X]
      val quantifiers = collect_quantifiers tm
      fun is_leader quantifier = forall (fn (h::L) =&gt; h = quantifier orelse not (member (op =) L quantifier)
                                          | [] =&gt; true) quantifiers
   in get_first (fn [] =&gt; NONE
                  | (h::_) =&gt; if is_leader h then SOME h else NONE) quantifiers
  end

fun zip_Alls__same_quantifier ctxt ctm =
  case choose_zip_All_quantifier (Thm.term_of ctm)
    of NONE =&gt; raise CTERM ("zip_Alls__same_quantifier", [ctm])
     | SOME (Name,Ty) =&gt; zip_Alls__same_quantifier' (Name, Thm.ctyp_of ctxt Ty)
*)</span></span><span>

</span><span class="comment1"><span>(*
fun zip_All_conj_recursively ctxt ctm =
  case Thm.term_of ctm
    of Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ _ =&gt;
        HOLogic.All_conv (zip_All_conj_recursively o snd) ctxt ctm
     | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.implies›, _) $ _ $ _ =&gt;
        HOLogic.imp_conv Conv.all_conv (zip_All_conj_recursively ctxt) ctm
     | Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ X $ _ =&gt; let
            fun has_leading_All (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ X $ Y) =
                  has_leading_All X andalso has_leading_All Y
              | has_leading_All (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ _) = true
              | has_leading_All _ = false
            fun has_leading_imp (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ X $ Y) =
                  has_leading_imp X andalso has_leading_imp Y
              | has_leading_imp (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.implies›, _) $ _ $ _) = true
              | has_leading_imp _ = false
            val term = Thm.cterm_of ctm
            fun parse (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.conj›, _) $ X $ _) = parse X
              | parse (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.All›, _) $ _) =
                  zip_Alls then_conv zip_All_conj_recursively ctxt
              | parse (Const(<span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span>‹HOL.implies›, _) $ _ $ _) =
                  zip_conjs then_conv zip_All_conj_recursively ctxt
              | parse _ = Conv.all_conv
         in if has_leading_All term then (zip_Alls__same_quantifier ctxt)
        end
     | _ =&gt; Conv.all_conv ctm
*)</span></span><span>

</span><span class="comment1"><span>(*requires beta eta normalized*)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_move_Ex_inside_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ex_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>err</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"move_Ex_inside_All"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="entity"><span>Ex_name'</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‹</span><span>fun</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span></span><span> </span><span class="main"><span>_</span></span><span>›</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                     </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>Ex_name'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Ex_name</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>err</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>err</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cTy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.ctyp_of_cterm</span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(*the type of the Ex binder, (f ⇒ _) ⇒ _*)</span></span><span>
             </span><span>|&gt;</span><span> </span><span>Thm.dest_ctyp0</span><span> </span><span>|&gt;</span><span> </span><span>Thm.dest_ctyp0</span><span> </span><span class="comment1"><span>(*the type of the f*)</span></span><span>
             </span><span>|&gt;</span><span> </span><span>Thm.dest_ctyp0</span><span> </span><span class="comment1"><span>(*the type of the universally quantified variable*)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule_of_hat</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.simp_thms|fact"><span>HOL.simp_thms</span></a><span class="main"><span>(</span></span><span>35</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
                     </span><span>|&gt;</span><span> </span><span>Thm.instantiate</span><span> </span><span class="main"><span>(</span></span><span>TVars.make</span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"'b"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">sort</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.type|class"><span>type</span></a><span>›</span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>cTy</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>Vars.empty</span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>wear_hat</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>rule_of_hat</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>ret</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>RFound</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RNot_Occur</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>Not_Occur</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>Found</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>int</span><span>
      </span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>Inconsistent</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>find_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Bound</span><span> </span><span class="entity"><span>i</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lev</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>RFound</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>RNot_Occur</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>find_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ni</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Ni</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bounds</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lev</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>RFound</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>RNot_Occur</span></span><span> 
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>find_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ni</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Free</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Nj</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Ni</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bounds</span></span><span>
                </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>find_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Nj</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>bounds</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lev</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>RFound</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span> </span><span>-</span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>RNot_Occur</span></span><span> 
            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>find_All</span></span><span> </span><span class="entity"><span>lev</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.All|const"><span>All</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>find_All</span></span><span> </span><span class="entity"><span>lev</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>X</span></span><span>
                                  </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"x"</span></span><span class="main"><span>,</span></span><span> </span><span>dummyT</span><span class="main"><span>,</span></span><span> </span><span>Term.incr_boundvars</span><span> </span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span>$</span><span> </span><span>Bound</span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>find_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>find_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>X</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>find_All</span></span><span> </span><span class="entity"><span>lev</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>X</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Y</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
           </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>find_All</span></span><span> </span><span class="entity"><span>lev</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>find_All</span></span><span> </span><span class="entity"><span>lev</span></span><span> </span><span class="entity"><span>Y</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RFound</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>RFound</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>RFound</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Inconsistent</span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RFound</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>RNot_Occur</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>RFound</span></span><span> </span><span class="entity"><span>i</span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RNot_Occur</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>RFound</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>RFound</span></span><span> </span><span class="entity"><span>i</span></span><span>
               </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>RNot_Occur</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>RNot_Occur</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>RNot_Occur</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>find_All</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>RNot_Occur</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>ret3</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TFound</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> int </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TNot_Occur</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>TConv</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> thm
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>try3</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>TConv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>Not_Occur</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>TNot_Occur</span></span><span>
                                          </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Found</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>TFound</span></span><span> </span><span class="entity"><span>i</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>move_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.All|const"><span>All</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="comment1"><span>(*((HOLogic.All_conv (fn (cv, ctxt) =&gt;
                            move_All (lev+1, Term.term_name (Thm.term_of cv) :: bounds) ctxt) ctxt
                         then_conv Conv.rewr_conv @{thm' all_comm[folded atomize_eq]}) ctm
                        handle Found i =&gt; if i = lev+1 then Conv.all_conv ctm else raise Found i)*)</span></span><span>

                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sink_All_over_conjs</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                   </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>th</span></span><span> </span><span>then_conv</span><span> </span><span class="entity"><span>move_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                    </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>
                        </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.All_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cv</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                            </span><span class="entity"><span>move_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span class="main"><span>,</span></span><span> </span><span>Term.term_name</span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>cv</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
                         </span><span>then_conv</span><span> </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.all_comm|fact"><span>all_comm</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                        </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>Found</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>lev</span></span><span>+</span><span class="inner_numeral"><span>1</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span>Conv.all_conv</span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Found</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                
           </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>Y</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>find_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>X</span></span><span>
                   </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>RFound</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>
                        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>find_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>Y</span></span><span>
                          </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>RFound</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Found</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Inconsistent</span></span><span>
                           </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RNot_Occur</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Found</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RNot_Occur</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                        </span><span class="main"><span>(</span></span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>move_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span>then_conv</span><span>
                         </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.all_simps|fact"><span>HOL.all_simps</span></a><span class="main"><span>(</span></span><span>6</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.simp_thms|fact"><span>HOL.simp_thms</span></a><span class="main"><span>(</span></span><span>22</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>then_conv</span><span>
                 </span><span class="entity"><span>move_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.simp_thms|fact"><span>HOL.simp_thms</span></a><span class="main"><span>(</span></span><span>21</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span> </span><span>then_conv</span><span>
                 </span><span class="entity"><span>move_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>conj_conv</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
                     </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>try3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>move_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg1</span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                            </span><span class="entity"><span>try3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>move_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.dest_arg</span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TFound</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TFound</span></span><span> </span><span class="entity"><span>j</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>j</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Found</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Inconsistent</span></span><span>
                         </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TFound</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TNot_Occur</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Found</span></span><span> </span><span class="entity"><span>i</span></span><span>
                         </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TNot_Occur</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TFound</span></span><span> </span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Found</span></span><span> </span><span class="entity"><span>i</span></span><span>
                         </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TFound</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Inconsistent</span></span><span>
                         </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TFound</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Inconsistent</span></span><span>
                         </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TConv</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TConv</span></span><span> </span><span class="entity"><span>th2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.conj_conv</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>th2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                         </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TConv</span></span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TNot_Occur</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.conj_conv</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>th1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>wear_hat</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                         </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TNot_Occur</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TConv</span></span><span> </span><span class="entity"><span>th2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>HOLogic.conj_conv</span></span><span> </span><span class="entity"><span>wear_hat</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>th2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                         </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>TNot_Occur</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>TNot_Occur</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Not_Occur</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conj_conv</span></span><span> </span><span>then_conv</span><span>
                     </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.all_conj_distrib|fact"><span>all_conj_distrib</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>find_All</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>lev</span></span><span class="main"><span>,</span></span><span class="entity"><span>bounds</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span>
                     </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>RFound</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Found</span></span><span> </span><span class="entity"><span>i</span></span><span>
                      </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>RNot_Occur</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Not_Occur</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>move_All_top</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cv</span></span><span class="main"><span>,</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>move_All</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span class="main"><span>[</span></span><span>Term.term_name</span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>cv</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>the_move</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="entity"><span>Ex_name'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span>Abs</span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.All|const"><span>All</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>Ex_name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Ex_name'</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"move_Ex_inside_All"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Ex</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctm1</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>ctm</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span> </span><span class="entity"><span>f</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctm2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_abs_global</span><span> </span><span class="entity"><span>ctm1</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Al</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctm3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_comb</span><span> </span><span class="entity"><span>ctm2</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span> </span><span class="entity"><span>x</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.dest_abs_global</span><span> </span><span class="entity"><span>ctm3</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>fx</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.apply</span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>x</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Q</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.lambda</span><span> </span><span class="entity"><span>x</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.lambda</span><span> </span><span class="entity"><span>fx</span></span><span> </span><span class="entity"><span>body</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Q"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>Q</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>rule</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"BUG wXYN5fcXRhuYi/3CGR+zVQ"</span></span><span> </span><span class="comment1"><span>(*the previous move_All_top is not finished.*)</span></span><span>

   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Conv.quant_conv</span></span><span> </span><span class="entity"><span>Ex_name</span></span><span> </span><span class="entity"><span>move_All_top</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>then_conv</span><span>
       </span><span class="entity"><span>the_move</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
   </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>Found</span></span><span> </span><span class="main"><span>_</span></span><span>   </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"move_Ex_inside_All: fail to move the universal quantification to the top"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Not_Occur</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"move_Ex_inside_All: the quantified variable does not occur at all"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>Inconsistent</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"move_Ex_inside_All: the quantified variable is applied to different terms"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>msg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>warning</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"gen_move_Ex_inside_All fails\n"</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>msg</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
                               </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>msg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>move_Ex_inside_All</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_move_Ex_inside_All</span></span><span>
      </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Ex|const"><span>Ex</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.choice_iff|fact"><span>choice_iff</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>move_sp_Ex_inside_All</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_move_Ex_inside_All</span></span><span>
      </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.special_Ex|const"><span>special_Ex</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.choice_iff|fact"><span>choice_iff</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.special_Ex_def|fact"><span>special_Ex_def</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>move_Ex_inside_All_recursive</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>move_Ex_inside_All</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>then_conv</span><span>
   </span><span class="entity"><span>hol_all_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>move_Ex_inside_All_recursive</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>move_sp_Ex_inside_All_recursive</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="entity"><span>move_sp_Ex_inside_All</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>then_conv</span><span>
   </span><span class="entity"><span>hol_all_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>move_sp_Ex_inside_All_recursive</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>move_Ex_downto_Disj</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_disj_distrib|fact"><span>HOL.ex_disj_distrib</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>move_sp_Ex_downto_Disj</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Conv.rewr_conv</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_disj_distrib|fact"><span>HOL.ex_disj_distrib</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.special_Ex_def|fact"><span>special_Ex_def</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_move_Ex_downto_Disj_recursive</span></span><span> </span><span class="entity"><span>move_Ex_downto_Disj</span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>move_Ex_downto_Disj_recursive</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="main"><span>(</span></span><span class="entity"><span>move_Ex_downto_Disj</span></span><span> </span><span>then_conv</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span>
           </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.disj|const"><span>HOL.disj</span></a><span>›</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                </span><span>Conv.combination_conv</span><span> </span><span class="main"><span>(</span></span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>move_Ex_downto_Disj_recursive</span></span><span> </span><span class="entity"><span>C</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                                      </span><span class="main"><span>(</span></span><span class="entity"><span>move_Ex_downto_Disj_recursive</span></span><span> </span><span class="entity"><span>C</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
            </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"BUG MOPPI5TrSk6+fBN7oHwPbQ"</span></span><span>
       </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
      </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>move_Ex_downto_Disj_recursive</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>move_Ex_downto_Disj_recursive</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_move_Ex_downto_Disj_recursive</span></span><span> </span><span class="entity"><span>move_Ex_downto_Disj</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>move_sp_Ex_downto_Disj_recursive</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_move_Ex_downto_Disj_recursive</span></span><span> </span><span class="entity"><span>move_sp_Ex_downto_Disj</span></span><span>




</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_move_Ex_inside</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ex_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mv_all</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mv_disj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mv_over_conj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule_mv_imp</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ex_imp_to_all</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rm_trivial</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>swap_quant</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="entity"><span>swap_ex</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>swap_sp_ex</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>open_ex</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>Thm.term_of</span><span> </span><span class="entity"><span>ctm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="entity"><span>N</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>N</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ex_name</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Abs</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>X</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                             </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>Conv.arg_conv</span><span> </span><span class="entity"><span>Phi_Conv.inverse_eta_conv</span></span><span> </span><span>then_conv</span><span>
                                     </span><span class="entity"><span>open_ex</span></span><span> </span><span class="entity"><span>C</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>)</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Phi_Conv.move_Ex_inside_exhaustively"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>   </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Phi_Conv.move_Ex_inside_exhaustively"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>ctm</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>trivial_case_chk</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="entity"><span>open_ex</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>bound_occurs</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>rm_trivial</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>open_ex</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>tm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>ctm</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>tm</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.All|const"><span>HOL.All</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Conv.quant_conv</span></span><span> </span><span class="entity"><span>ex_name</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sink_All_over_conjs</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
               </span><span>then_conv</span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.disj|const"><span>HOL.disj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>mv_disj</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span> 
           </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.conj|const"><span>HOL.conj</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>bound_occurs</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="entity"><span>tm</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span>try</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>sink_quantifier_over_conjs</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ex_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>mv_over_conj</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rm_trivial</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>swap_quant</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                      </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>th</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>th</span></span><span> </span><span>then_conv</span><span>
                                     </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span>
                                       </span><span class="entity"><span>Phi_Conv.quant_conv</span></span><span> </span><span class="entity"><span>ex_name</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>zip_conjs_recursively</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>then_conv</span><span>
                                       </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                       </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Conv.quant_conv</span></span><span> </span><span class="entity"><span>ex_name</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span class="entity"><span>zip_conjs_recursively1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>then_conv</span><span>
                                  </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>rm_trivial</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.implies|const"><span>HOL.implies</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>A</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>B</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Term.is_dependent</span><span> </span><span class="entity"><span>A</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>Term.is_dependent</span><span> </span><span class="entity"><span>B</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>ex_imp_to_all</span></span><span> </span><span>then_conv</span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>rule_mv_imp</span></span><span> </span><span>then_conv</span><span>
                    </span><span>Conv.arg_conv</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Ex|const"><span>HOL.Ex</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>swap_ex</span></span><span> </span><span>then_conv</span><span>
               </span><span class="entity"><span>Phi_Conv.quant_conv</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Ex|const"><span>HOL.Ex</span></a><span>›</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conv</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span>Const</span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.special_Ex|const"><span>special_Ex</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
              </span><span class="main"><span>(</span></span><span>Conv.rewr_conv</span><span> </span><span class="entity"><span>swap_sp_ex</span></span><span> </span><span>then_conv</span><span>
               </span><span class="entity"><span>Phi_Conv.quant_conv</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.special_Ex|const"><span>special_Ex</span></a><span>›</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conv</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
        </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
        </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>CTERM</span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span class="main"><span>(</span></span><span class="entity"><span>mv_all</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>then_conv</span><span> </span><span class="entity"><span>hol_all_conv</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>conv</span></span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
           </span><span>else_conv</span><span> </span><span class="entity"><span>C</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctm</span></span><span>
        
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>trivial_case_chk</span></span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>Phi_Conv.quant_conv</span></span><span> </span><span class="entity"><span>ex_name</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
          </span><span>Raw_Simplifier.rewrite</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span>true</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thms'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.simp_thms|fact"><span>HOL.simp_thms</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
        </span><span>then_conv</span><span> </span><span class="entity"><span>conv</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>move_Ex_inside</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_move_Ex_inside</span></span><span>
      </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.Ex|const"><span>Ex</span></a><span>›</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>move_Ex_inside_All</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>move_Ex_downto_Disj_recursive</span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_simps|fact"><span>HOL.ex_simps</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_simps|fact"><span>HOL.ex_simps</span></a><span class="main"><span>(</span></span><span>6</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_simps|fact"><span>HOL.ex_simps</span></a><span class="main"><span>(</span></span><span>5</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.simp_thms|fact"><span>HOL.simp_thms</span></a><span class="main"><span>(</span></span><span>36</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_comm|fact"><span>HOL.ex_comm</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_comm|fact"><span>HOL.ex_comm</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.sp_ex_ex_comm|fact"><span>sp_ex_ex_comm</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>move_sp_Ex_inside</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_move_Ex_inside</span></span><span>
      </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‹</span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.special_Ex|const"><span>special_Ex</span></a><span>›</span></span><span class="main"><span>,</span></span><span>
       </span><span class="entity"><span>move_sp_Ex_inside_All</span></span><span class="main"><span>,</span></span><span>
       </span><span class="entity"><span>move_sp_Ex_downto_Disj_recursive</span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_simps|fact"><span>HOL.ex_simps</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.special_Ex_def|fact"><span>special_Ex_def</span></a><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_simps|fact"><span>HOL.ex_simps</span></a><span class="main"><span>(</span></span><span>6</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.special_Ex_def|fact"><span>special_Ex_def</span></a><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_simps|fact"><span>HOL.ex_simps</span></a><span class="main"><span>(</span></span><span>5</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.special_Ex_def|fact"><span>special_Ex_def</span></a><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.simp_thms|fact"><span>HOL.simp_thms</span></a><span class="main"><span>(</span></span><span>36</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.special_Ex_def|fact"><span>special_Ex_def</span></a><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_comm|fact"><span>HOL.ex_comm</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.special_Ex_def|fact"><span>special_Ex_def</span></a><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.sp_ex_ex_comm|fact"><span>sp_ex_ex_comm</span></a><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
       </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.ex_comm|fact"><span>HOL.ex_comm</span></a><span class="main"><span>[</span></span><span class="operator"><span>folded</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.special_Ex_def|fact"><span>special_Ex_def</span></a><span> </span><a class="entity_ref" href="../../../../../../../../HOL/HOL/HOL.html#HOL.atomize_eq|fact"><span>atomize_eq</span></a><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
</span></pre>
</body>

</html>