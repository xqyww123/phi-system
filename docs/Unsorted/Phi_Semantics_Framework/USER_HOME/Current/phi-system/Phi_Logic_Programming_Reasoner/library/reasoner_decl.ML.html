<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‹library/reasoner_decl.ML›</title>
</head>


<body>
<div class="head">
<h1>File ‹library/reasoner_decl.ML›</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>NU_REASONER</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>priority</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int</span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>pattern</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>term</span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>term</span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>ML_guard</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>context_state</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>action</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>cterm</span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>cut_mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>NO_CUT</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>LOCAL_CUT</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>GLOBAL_CUT</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>backtrack_mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ALLOW_BACKTRACK</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NO_BACKTRACK</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NO_EXPLORATIVE_BACKTRACK</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cut_mode</span></span><span> * </span><span class="entity"><span>backtrack_mode</span></span><span>
  </span><span class="comment1"><span>(* declare by NO_BACKTRACK to disable applying the reasoner during backtracking.
        It causes the reasoner will not be applied once there is another reasoner of a higher priority,
        no matter if that reasoner's application succeeds.
        It is therefore useful to declare `default' rules which works when user does not give any
        specific rule and to be overrided once any rule is given.

     In exhaustive reasoning mode, in order to obtain all reachable solution of a reasoning goal,
     the reasoning will not terminate even when a success is reached. Instead, a special `explorative'
     backtrack is triggered to backtrack to other branches.
     NO_EXPLORATIVE_BACKTRACK disables the rule to be applied in this explorative backtracking.
     It can be for consideration of performance.
 *)</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mode_ord </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>mode</span></span><span> * </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>order</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> NORMAL_MODE </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>mode</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> NORMAL_LOCAL_CUT </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>mode</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> TO_BE_OVERRIDE </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>mode</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>backtracking</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>NO_BACKTRACKING</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BACKTRACKING</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>EXPLORATIVE_BACKTRACKING</span></span><span>

  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> cut_mode_parser </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>cut_mode</span></span><span> </span><span>parser</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> backtrack_mode_parser </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>backtrack_mode</span></span><span> </span><span>parser</span><span>
  </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> default_mode_of </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>priority</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>cut_mode</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Phi_Reasoner</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>NU_REASONER</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>priority</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>int</span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>pattern</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>term</span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>term</span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>ML_guard</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>context_state</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>bool</span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>action</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>cterm</span><span>

</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>cut_mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>NO_CUT</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>LOCAL_CUT</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>GLOBAL_CUT</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>backtrack_mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ALLOW_BACKTRACK</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NO_BACKTRACK</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>NO_EXPLORATIVE_BACKTRACK</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>mode</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>cut_mode</span></span><span> * </span><span class="entity"><span>backtrack_mode</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>NORMAL_MODE</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NO_CUT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ALLOW_BACKTRACK</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>NORMAL_LOCAL_CUT</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LOCAL_CUT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ALLOW_BACKTRACK</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>TO_BE_OVERRIDE</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NO_CUT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>NO_BACKTRACK</span></span><span class="main"><span>)</span></span><span>

</span><span class="comment1"><span>(* NO_CUT &lt; LOCAL_CUT &lt; GLOBAL_CUT *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>cut_mode_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>GLOBAL_CUT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>GLOBAL_CUT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EQUAL</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cut_mode_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LOCAL_CUT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>GLOBAL_CUT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>LESS</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cut_mode_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>LOCAL_CUT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>LOCAL_CUT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EQUAL</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cut_mode_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NO_CUT</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>NO_CUT</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EQUAL</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cut_mode_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NO_CUT</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>LESS</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>cut_mode_ord</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>GREATER</span><span>

</span><span class="comment1"><span>(* ALLOW_BACKTRACK &lt; NO_EXPLORATIVE_BACKTRACK &lt; NO_BACKTRACK *)</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>backtrack_mode_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NO_BACKTRACK</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>NO_BACKTRACK</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EQUAL</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>backtrack_mode_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NO_EXPLORATIVE_BACKTRACK</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>NO_BACKTRACK</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>LESS</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>backtrack_mode_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>NO_EXPLORATIVE_BACKTRACK</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>NO_EXPLORATIVE_BACKTRACK</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EQUAL</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>backtrack_mode_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ALLOW_BACKTRACK</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ALLOW_BACKTRACK</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>EQUAL</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>backtrack_mode_ord</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ALLOW_BACKTRACK</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>LESS</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>backtrack_mode_ord</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>GREATER</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mode_ord</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>prod_ord</span><span> </span><span class="entity"><span>cut_mode_ord</span></span><span> </span><span class="entity"><span>backtrack_mode_ord</span></span><span>


</span><span class="keyword1"><span class="keyword"><span>datatype</span></span></span><span> </span><span class="entity"><span>backtracking</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>NO_BACKTRACKING</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>BACKTRACKING</span></span><span> </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>EXPLORATIVE_BACKTRACKING</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>cut_mode_parser</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>!</span></span><span>›</span></span></span><span> </span><span>|--</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>!</span></span><span>›</span></span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>GLOBAL_CUT</span></span><span class="main"><span>)</span></span><span>
                   </span><span>||</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>!</span></span><span>›</span></span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>LOCAL_CUT</span></span><span class="main"><span>)</span></span><span>
                   </span><span>||</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">keyword</span><span class="hidden">&gt;</span></span></span><span>‹</span><span class="keyword2"><span>?</span></span><span>›</span></span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>NO_CUT</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>backtrack_mode_parser</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"default"</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>NO_BACKTRACK</span></span><span class="main"><span>)</span></span><span>
                         </span><span>||</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"no"</span></span><span> </span><span>--</span><span> </span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"backtrack"</span></span><span class="main"><span>)</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>NO_BACKTRACK</span></span><span class="main"><span>)</span></span><span>
                         </span><span>||</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"no"</span></span><span> </span><span>--</span><span> </span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"explorative"</span></span><span> </span><span>--</span><span> </span><span>Args.$$$</span><span> </span><span class="inner_quoted"><span>"backtrack"</span></span><span class="main"><span>)</span></span><span> </span><span>&gt;&gt;</span><span> </span><span>K</span><span> </span><span class="entity"><span>NO_EXPLORATIVE_BACKTRACK</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>default_mode_of</span></span><span> </span><span class="entity"><span>priority</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>priority</span></span><span> </span><span>&gt;=</span><span> </span><span class="inner_numeral"><span>1000000</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>GLOBAL_CUT</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>priority</span></span><span> </span><span>&gt;=</span><span> </span><span class="inner_numeral"><span>1000</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>LOCAL_CUT</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>NO_CUT</span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre>
</body>

</html>