<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>File ‚Äπlibrary/generic_element_access.ML‚Ä∫</title>
</head>


<body>
<div class="head">
<h1>File ‚Äπlibrary/generic_element_access.ML‚Ä∫</h1>
</div>

<pre class="source"><span class="keyword1"><span class="keyword"><span>signature</span></span></span><span> </span><span class="entity"><span>GENERIC_ELEMENT_ACCESS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>sig</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>include</span></span></span><span> </span><span class="entity"><span>GENERIC_ELEMENT_ACCESS</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> Agg_Path_Encoders </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>HANDLERS</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> Agg_Constructors </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>HANDLERS</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_dot_opr </span><span class="main"><span>:</span></span><span> </span><span>Position.T</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.opr_frame</span></span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.meta_operator</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> mk_element_index_input </span><span class="main"><span>:</span></span><span> </span><span>thm</span><span> </span><span>list</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span>term</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> gen_access </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> * </span><span>string</span><span>
              </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>Position.T</span><span class="main"><span>)</span></span><span> * </span><span class="entity"><span>Phi_Opr_Stack.arg_name</span></span><span>
              </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_CP_IDE.eval_cfg</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.context</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> gen_constructor </span><span class="main"><span>:</span></span><span> </span><span>string</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="main"><span>(</span></span><span>string</span><span> * </span><span>Position.T</span><span class="main"><span>)</span></span><span> * </span><span class="entity"><span>Phi_Opr_Stack.arg_name</span></span><span>
                   </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_CP_IDE.eval_cfg</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.context</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> Bracket_Opr_Read
</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> Bracket_Opr_Write </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Position.T</span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dot_triangle_opr </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.meta_opr</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dot_triangle_update_opr </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.meta_opr</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> dot_triangle_assignment </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.meta_opr</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> open_bracket_opr </span><span class="main"><span>:</span></span><span> </span><span>Position.T</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_CP_IDE.eval_cfg</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.context</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> close_bracket </span><span class="main"><span>:</span></span><span> </span><span>Position.T</span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_CP_IDE.eval_cfg</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.context</span></span><span> </span><span class="main"><span>-&gt;</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.context</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> err_assignment </span><span class="main"><span>:</span></span><span> </span><span>Position.T</span><span> </span><span class="main"><span>-&gt;</span></span><span> 'a

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Generic_Element_Access</span></span><span> </span><span class="main"><span>:</span></span><span> </span><span class="entity"><span>GENERIC_ELEMENT_ACCESS</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>struct</span></span></span><span>

</span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Generic_Element_Access</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_mk_element_index_input</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_path'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>HOLogic.mk_prod</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Syntax.dest_satisfaction</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prop_of</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>HOLogic.mk_list</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><span class="main"><a class="entity_ref" href="../../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>√ó</span></a></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.BI|type"><span>BI</span></a><span>‚Ä∫</span></span></span><span> </span><span class="entity"><span>raw_path'</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>prod_VAL_VALset</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../HOL/HOL/Product_Type.html#Product_Type.Pair|const"><span>Pair</span></a><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><span class="main"><span>‚áí</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.BI|type"><span>BI</span></a><span> </span><span class="main"><span>‚áí</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><span class="main"><a class="entity_ref" href="../../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>√ó</span></a></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.BI|type"><span>BI</span></a><span>‚Ä∫</span></span></span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_list_c</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>Nil</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../HOL/HOL/List.html#List.list.Nil|const"><span>Nil</span></a><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><span class="main"><a class="entity_ref" href="../../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>√ó</span></a></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.BI|type"><span>BI</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../../../../../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span>‚Ä∫</span></span></span></span><span>
    </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>Cons</span></span><span> </span><span class="entity"><span>t</span></span><span> </span><span class="entity"><span>u</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.apply</span><span>
      </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="antiquoted"><span class="entity"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">cterm</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../HOL/HOL/List.html#List.list.Cons|const"><span>Cons</span></a><span> </span><span class="main"><span>::</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><span class="main"><a class="entity_ref" href="../../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>√ó</span></a></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.BI|type"><span>BI</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>‚áí</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><span class="main"><a class="entity_ref" href="../../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>√ó</span></a></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.BI|type"><span>BI</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../../../../../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>‚áí</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><span class="main"><a class="entity_ref" href="../../../../../../../HOL/HOL/Product_Type.html#Product_Type.prod|type"><span>√ó</span></a></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.BI|type"><span>BI</span></a><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../../../../../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span>‚Ä∫</span></span></span></span><span> </span><span class="entity"><span>t</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>u</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_rev</span><span> </span><span class="entity"><span>Cons</span></span><span> </span><span class="entity"><span>ts</span></span><span> </span><span class="entity"><span>Nil</span></span><span> </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span class="main"><span>;</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_mk_element_index_input_c</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>raw_path'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>Phi_Syntax.dest_satisfaction_c</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.cprop_of</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>f</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>A</span></span><span class="main"><span>,</span></span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Thm.apply</span><span> </span><span class="main"><span>(</span></span><span>Thm.apply</span><span> </span><span class="entity"><span>prod_VAL_VALset</span></span><span> </span><span class="entity"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>mk_list_c</span></span><span> </span><span class="entity"><span>raw_path'</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>mk_element_index_input</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_mk_element_index_input</span></span><span> </span><span>I</span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Agg_Path_Encoders</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Handlers</span></span><span> </span><span class="main"><span>(</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>arg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>Position.T</span><span> * </span><span>thm</span><span class="main"><span>)</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>context_state</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>ret</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Proof.context</span></span><span> * </span><span>cterm</span><span> </span><span class="comment1"><span>(*raw index*)</span></span><span class="main"><span>)</span></span><span>
</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>Bracket_Opr_Read</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>Bracket_Opr_Write</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>Position.T</span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>chk_arg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"named argument is not supported here "</span></span><span> </span><span>^</span><span> </span><span>Position.here</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>chk_arg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>error</span><span> </span><span class="main"><span>(</span></span><span>Position.here</span><span> </span><span class="entity"><span>pos</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" the expression returns more than one value"</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>chk_arg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
      </span><span>error</span><span> </span><span class="main"><span>(</span></span><span>Position.here</span><span> </span><span class="entity"><span>pos</span></span><span> </span><span>^</span><span> </span><span class="inner_quoted"><span>" the expression returns no value!"</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>chk_arg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pos</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>v</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_element_index_input_internal</span></span><span> </span><span class="entity"><span>args0</span></span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idx_input</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>gen_mk_element_index_input_c</span></span><span> </span><span>snd</span><span> </span><span class="entity"><span>args0</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>distinct</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>rule1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>rule2</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span>pointer_eq</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>rule1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule2</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="keyword"><span>orelse</span></span></span><span>
            </span><span>Thm.concl_of</span><span> </span><span class="entity"><span>rule1</span></span><span> </span><span>aconv</span><span> </span><span>Thm.concl_of</span><span> </span><span class="entity"><span>rule2</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args0</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>pattern_of</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Trueprop</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>H1</span></span><span> </span><span class="keyword1"><span class="keyword"><span>as</span></span></span><span> </span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.Satisfaction|const"><span>Satisfaction</span></a><span>‚Ä∫</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>V</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>S</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Int.max</span><span> </span><span class="main"><span>(</span></span><span>maxidx_of_term</span><span> </span><span class="entity"><span>H1</span></span><span class="main"><span>,</span></span><span> </span><span>maxidx_of_term</span><span> </span><span class="entity"><span>V</span></span><span class="main"><span>)</span></span><span> </span><span>+</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
               </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>Trueprop</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Action_Tag|const"><span>Action_Tag</span></a><span>‚Ä∫</span></span><span> </span><span>$</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>H1</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>V</span></span><span> </span><span>$</span><span> </span><span>Var</span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"S"</span></span><span class="main"><span>,</span></span><span class="entity"><span>i</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>fastype_of</span><span> </span><span class="entity"><span>S</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                                                </span><span>$</span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../PhSm_Ag_Base.html#PhSm_Ag_Base.\&lt;A&gt;parse_eleidx|const"><span>ùíúparse_eleidx</span></a><span>‚Ä∫</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>pattern_of</span></span><span> </span><span class="entity"><span>X</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span>TERM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"bad rule Y6uYVPRLRYeA3oqKVPXWGQ"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>X</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>reasoning_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pos</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>rule</span></span><span> </span><span>RS</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Action_Tag_I|fact"><span>Action_Tag_I</span></a><span class="main"><span>[</span></span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/ISABELLE_HOME/src/HOL/Eisbach/eisbach_rule_insts.ML.html#Eisbach.where|attribute"><span class="operator"><span>where</span></span></a><span> A</span><span class="main"><span class="main"><span>=</span></span></span><span class="quoted"><span>‚Äπ</span><a class="entity_ref" href="../../../../../PhSm_Ag_Base.html#PhSm_Ag_Base.\&lt;A&gt;parse_eleidx|const"><span>ùíúparse_eleidx</span></a><span>‚Ä∫</span></span><span class="main"><span>]</span></span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>,</span></span><span>
             </span><span class="entity"><span>Phi_Reasoner.NORMAL_LOCAL_CUT'</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>reasoner_group</span></span><span> </span><span class="main"><span>%</span></span><span>ùíúparse_eleidx</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
             </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="entity"><span>pattern_of</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.prop_of</span><span> </span><span class="entity"><span>rule</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Proof_Context.theory_of</span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pats</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pattern_of</span></span><span> </span><span>o</span><span> </span><span>Thm.prop_of</span><span> </span><span>o</span><span> </span><span>snd</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
   </span><span>|&gt;</span><span> </span><span>Config.map</span><span> </span><span class="entity"><span>Phi_Reasoner.trace</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span>
   </span><span>|&gt;</span><span> </span><span>Context.proof_map</span><span> </span><span class="main"><span>(</span></span><span>
        </span><span class="entity"><span>Phi_Reasoner.del_reasoners</span></span><span> </span><span class="main"><span>[</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">pattern_prop</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‚Äπ</span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span> </span><span class="main"><span>::</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_BI.Phi_BI.html#Phi_BI.Satisfaction|const"><span>‚ä®</span></a></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Action_Tag|const"><span>@tag</span></a></span><span> </span><a class="entity_ref" href="../../../../../PhSm_Ag_Base.html#PhSm_Ag_Base.\&lt;A&gt;parse_eleidx|const"><span>ùíúparse_eleidx</span></a><span>‚Ä∫</span></span></span><span class="main"><span>]</span></span><span>
          </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>r</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>exists</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>pat</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>Pattern.matches</span><span> </span><span class="entity"><span>thy</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pat</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>#</span></span><span>name </span><span class="entity"><span>r</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pats</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span>|&gt;</span><span> </span><span>Context.proof_map</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Reasoner.add_rules</span></span><span> </span><span class="entity"><span>reasoning_rules</span></span><span class="main"><span>)</span></span><span>
   </span><span>|&gt;</span><span> </span><span>Config.restore</span><span> </span><span class="entity"><span>Phi_Reasoner.trace</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
   </span><span>|&gt;</span><span> </span><span>pair</span><span> </span><span class="entity"><span>idx_input</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_empty</span></span><span> </span><span class="main"><span>(</span></span><span>Const</span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">const_name</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../HOL/HOL/List.html#List.list.Nil|const"><span>Nil</span></a><span>‚Ä∫</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
  </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_empty</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>

</span><span class="keyword1"><span class="keyword"><span>exception</span></span></span><span> </span><span class="entity"><span>RW_RETURN</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.opr_frame</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>context_state</span></span><span>
</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>rw_access</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>read_rule_name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>write_rule_name</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>read_or_write</span></span><span> </span><span class="entity"><span>idx_input</span></span><span> </span><span class="entity"><span>cfg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>post_app</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Phi_CP_IDE.Post_App.invoke</span></span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs'1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx_input'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt'1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent'1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>oprs</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Opr_Stack.Meta_Opr</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"$"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Opr_Stack.String_Param</span></span><span> </span><span class="entity"><span>vname</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>oprs'</span></span><span class="main"><span>)</span></span><span>
              </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span>
                 </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>attempt</span></span><span> </span><span class="entity"><span>prohibit_remains_idx</span></span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s</span></span><span>
                            </span><span>|&gt;</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Generic_Element_Access.enable_report_unprocessed_element_index</span></span><span> </span><span class="entity"><span>prohibit_remains_idx</span></span><span class="main"><span>)</span></span><span>
                            </span><span>|&gt;</span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>idx</span></span><span>
                            </span><span>|&gt;</span><span> </span><span class="entity"><span>post_app</span></span><span> </span><span class="entity"><span>cfg</span></span><span>
                          </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Application Fail"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                            </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Generic_Element_Access.Remaining_Eleidx</span></span><span> </span><span class="entity"><span>idx</span></span><span>
                        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>hook</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Generic_Element_Access.get_unprocessed_element_index</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>s'</span></span><span class="main"><span>)</span></span><span>
                                     </span><span>|&gt;</span><span> </span><span>the_default</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Generic_Element_Access.EIHook_none</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs'</span></span><span class="main"><span>,</span></span><span class="entity"><span>s''</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_empty</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>idx'</span></span><span class="main"><span>)</span></span><span>
                                          </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Generic_Element_Access.evaluate_hook</span></span><span> </span><span class="entity"><span>hook</span></span><span> </span><span class="entity"><span>read_or_write</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span class="entity"><span>s'</span></span><span class="main"><span>)</span></span><span>
                                          </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s'</span></span><span class="main"><span>)</span></span><span>
                        </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>prohibit_remains_idx</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_empty</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>idx'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                                </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Generic_Element_Access.Remaining_Eleidx</span></span><span> </span><span class="entity"><span>idx'</span></span><span>
                                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
                     </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s''</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>read_or_write</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>attempt</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>idx_input</span></span><span>
                            </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Reasoners.wrap''</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Generic_Variable_Access.get_value</span></span><span> </span><span class="entity"><span>vname</span></span><span class="main"><span>)</span></span><span>
                            </span><span class="main"><span>(</span></span><span class="entity"><span>oprs'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>attempt</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>empty_input</span></span><span>
                                </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Reasoners.wrap''</span></span><span> </span><span>o</span><span> </span><span class="entity"><span>Generic_Variable_Access.get_value</span></span><span> </span><span class="entity"><span>vname</span></span><span class="main"><span>)</span></span><span>
                                </span><span class="main"><span>(</span></span><span class="entity"><span>oprs'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                   </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs'</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx_input</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> 
                </span><span class="comment1"><span>(*let (*the commented programs allows ":=" to assign / alter a variable *)
                      fun fallback () =
                            attempt false empty_input
                                (Phi_Reasoners.wrap'' o Generic_Variable_Access.get_value vname)
                                (ctxt,sequent)
                              |&gt; (fn (_, s') =&gt; (oprs', (idx_input, s')))
                   in attempt true idx_input
                            (fn idx =&gt; Generic_Variable_Access.assignment' [(NONE, (Binding.make (vname, pos), idx))])
                            (ctxt,sequent)
                        |&gt; (fn idx_stat =&gt; raise RW_RETURN (oprs', snd idx_stat))
                      handle Generic_Element_Access.Remaining_Eleidx _ =&gt; fallback()
                           | Generic_Variable_Access.ASSIGN_FAIL _ =&gt; fallback()
                  end*)</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
           </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx_input</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>r_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Phi_App_Rules.get_overloadings</span></span><span> </span><span class="entity"><span>ctxt'1</span></span><span> </span><span class="entity"><span>read_rule_name</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>w_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>read_or_write</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span>
                    </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Phi_App_Rules.get_overloadings</span></span><span> </span><span class="entity"><span>ctxt'1</span></span><span> </span><span class="entity"><span>write_rule_name</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>process_index</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>finish</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>apfst</span><span> </span><span class="entity"><span>Generic_Element_Access.stop_reporting_unprocessed_element_index</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>loopback_w</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_empty</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>finish</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"Bad configuration of rules: still has unprocess element indexes"</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>loopback_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_empty</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>finish</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>process_index</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>attempt</span></span><span> </span><span class="entity"><span>prohibit_remains_idx</span></span><span> </span><span class="entity"><span>rules0</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt'1</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"input_index"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rules0</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>s'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>s</span></span><span>
                         </span><span>|&gt;</span><span> </span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Generic_Element_Access.enable_report_unprocessed_element_index</span></span><span> </span><span class="entity"><span>prohibit_remains_idx</span></span><span class="main"><span>)</span></span><span>
                         </span><span>|&gt;</span><span> </span><span class="entity"><span>Phi_Reasoners.wrap''</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Apply.apply</span></span><span> </span><span class="entity"><span>rules</span></span><span class="main"><span>)</span></span><span>
                         </span><span>|&gt;</span><span> </span><span class="entity"><span>post_app</span></span><span> </span><span class="entity"><span>cfg</span></span><span>
                    </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span>THM</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Application Fail"</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                        </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Generic_Element_Access.Remaining_Eleidx</span></span><span> </span><span class="entity"><span>idx</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>hook</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Generic_Element_Access.get_unprocessed_element_index</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>s'</span></span><span class="main"><span>)</span></span><span>
                            </span><span>|&gt;</span><span> </span><span>the_default</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Generic_Element_Access.EIHook_none</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs'</span></span><span class="main"><span>,</span></span><span class="entity"><span>s''</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_empty</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>idx'</span></span><span class="main"><span>)</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>Generic_Element_Access.evaluate_hook</span></span><span> </span><span class="entity"><span>hook</span></span><span> </span><span class="entity"><span>read_or_write</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span class="entity"><span>s'</span></span><span class="main"><span>)</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s'</span></span><span class="main"><span>)</span></span><span>
                    </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>prohibit_remains_idx</span></span><span> </span><span class="keyword1"><span class="keyword"><span>andalso</span></span></span><span> </span><span>not</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>is_empty</span></span><span> </span><span class="main"><span>(</span></span><span>Thm.term_of</span><span> </span><span class="entity"><span>idx'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>raise</span></span></span><span> </span><span class="entity"><span>Generic_Element_Access.Remaining_Eleidx</span></span><span> </span><span class="entity"><span>idx'</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
                 </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s''</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
           </span><span class="comment1"><span>(*fun assert_nonempty idx =
                if is_empty (Thm.term_of idx) then idx
                else error "Bad configuration of access rules: the writer cannot process all element index while\
                            \ the reader can..." *)</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>read_or_write</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>loopback_r</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>attempt</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>r_rules</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>loopback_w</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>attempt</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>w_rules</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                   </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>Generic_Element_Access.Remaining_Eleidx</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                      </span><span class="entity"><span>process_index</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>attempt</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>r_rules</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
         </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>Generic_Element_Access.Remaining_Eleidx</span></span><span> </span><span class="entity"><span>idx</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
            </span><span class="entity"><span>Generic_Element_Access.error_unprocessed_element_index</span></span><span> </span><span class="main"><span>(</span></span><span>fst</span><span> </span><span class="entity"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>idx</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>process_index</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs'1</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx_input'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt'1</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent'1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="keyword3"><span class="keyword"><span>handle</span></span></span><span> </span><span class="entity"><span>RW_RETURN</span></span><span> </span><span class="entity"><span>ret</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ret</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_access</span></span><span> </span><span class="entity"><span>named_thm_of_rules</span></span><span> </span><span class="entity"><span>pos_and_first_args</span></span><span> </span><span class="entity"><span>cfg</span></span><span> </span><span class="entity"><span>stat</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>invoke</span></span><span> </span><span class="entity"><span>read_or_write</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx_input</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_element_index_input_internal</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>rw_access</span></span><span> </span><span class="entity"><span>named_thm_of_rules</span></span><span> </span><span class="entity"><span>read_or_write</span></span><span> </span><span class="entity"><span>idx_input</span></span><span> </span><span class="entity"><span>cfg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt'</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>wrap</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a'</span></span><span class="main"><span>,</span></span><span class="entity"><span>c'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>f</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>a</span></span><span class="main"><span>,</span></span><span class="entity"><span>c</span></span><span class="main"><span>)</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>a'</span></span><span class="main"><span>,</span></span><span class="entity"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>c'</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="comment1"><span>(*let val (idx_input, ctxt') = mk_element_index_input_internal args ctxt
            val rules = Phi_App_Rules.get_overloadings ctxt'
                            ((if read_or_write then fst else snd) named_thm_of_rules)
                      |&gt; map (Drule.infer_instantiate ctxt' [(("input_index", 0), idx_input)])
         in (oprs, Phi_Reasoners.wrap'' (Phi_Apply.apply1 rules) (ctxt', sequent))
        end*)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>invoke'</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>Bracket_Opr_Read</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vals</span></span><span> </span><span class="entity"><span>opr_ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>opr_ctxt</span></span><span>
            </span><span>|&gt;</span><span> </span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Generic_Variable_Access.push_values</span></span><span> </span><span class="entity"><span>vals</span></span><span class="main"><span>)</span></span><span>
            </span><span>|&gt;</span><span> </span><span class="entity"><span>wrap</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>invoke</span></span><span> </span><span>true</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>chk_arg</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>invoke'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cfg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Bracket_Opr_Write</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vals</span></span><span> </span><span class="entity"><span>opr_ctxt</span></span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>Phi_Opr_Stack.push_meta_operator</span></span><span> </span><span class="entity"><span>cfg</span></span><span>
                </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_numeral"><span>1001</span></span><span class="main"><span>,</span></span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>priority</span></span><span> </span><span class="main"><span>%</span></span><span>œÜlang_update_opr</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>":="</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span>
                 </span><span>K</span><span> </span><span class="main"><span>(</span></span><span> </span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Generic_Variable_Access.push_values</span></span><span> </span><span class="entity"><span>vals</span></span><span class="main"><span>)</span></span><span>
                  </span><span>#&gt;</span><span> </span><span class="entity"><span>invoke</span></span><span> </span><span>false</span><span> </span><span class="main"><span>(</span></span><span>map</span><span> </span><span class="entity"><span>chk_arg</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>opr_ctxt</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>invoke'</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span>error</span><span> </span><span class="inner_quoted"><span>"Bad free_arg in Generic_Element_Access"</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>invoke'3</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cfg</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vals</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>free_arg</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>s</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>vals</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>invoke'</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cfg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>free_arg</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>vals</span></span><span> </span><span class="entity"><span>s</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Bad Syntax: There must be one target of aggregate access. "</span></span><span> </span><span>^</span><span>
                         </span><span>Position.here</span><span> </span><span class="main"><span>(</span></span><span>snd</span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>pos_and_first_args</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>invoke'3</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"BUG qgjNc1ebSHCtqRNU7y9/Cw"</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.meta_apply</span></span><span> </span><span class="entity"><span>cfg</span></span><span> </span><span class="entity"><span>pos_and_first_args</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>priority</span></span><span> </span><span class="main"><span>%</span></span><span>œÜlang_app</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>invoke'3</span></span><span> </span><span class="entity"><span>stat</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>structure</span></span></span><span> </span><span class="entity"><span>Agg_Constructors</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Handlers</span></span><span> </span><span class="main"><span>(</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>arg</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>string</span><span> </span><span class="comment1"><span>(*user's source hint, indicating which object to be constructed*)</span></span><span>
           * </span><span class="entity"><span>Phi_Opr_Stack.named_arg</span></span><span> </span><span>list</span><span> * </span><span class="entity"><span>context_state</span></span><span>
  </span><span class="keyword1"><span class="keyword"><span>type</span></span></span><span> </span><span class="entity"><span>ret</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Proof.context</span></span><span> * </span><span>cterm</span><span> </span><span class="comment1"><span>(*constructor*)</span></span><span> * </span><span>term</span><span> </span><span>list</span><span> </span><span class="comment1"><span>(*arguments*)</span></span><span>
</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_constructor</span></span><span> </span><span class="entity"><span>kind</span></span><span> </span><span class="entity"><span>settings</span></span><span> </span><span class="entity"><span>cfg</span></span><span> </span><span class="entity"><span>stat</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>invoke</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vals_before</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>args0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>free_arg</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>free_arg</span></span><span> </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
                       </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"Bad free_arg 1ibvpcveSdePAKyDJuJefA"</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Generic_Variable_Access.push_values</span></span><span> </span><span class="entity"><span>vals_before</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt0</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent0</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>kind'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>kind</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"structure"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>kind</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Agg_Constructors.invoke</span></span><span> </span><span class="main"><span>(</span></span><span>Context.Proof</span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>)</span></span><span>
                                                               </span><span class="main"><span>(</span></span><span class="entity"><span>kind</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args0</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                      </span><span>|&gt;</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>ret</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>ret</span></span><span>
                           </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Don't know how to construct "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>kind'</span></span><span> </span><span>^</span><span>
                                              </span><span class="inner_quoted"><span>" using the given arguments."</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>HOLogic.mk_list</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.\&lt;phi&gt;arg|type"><span>œÜarg</span></a><span>‚Ä∫</span></span></span><span> </span><span class="entity"><span>args'</span></span><span class="main"><span>)</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>pos_rules</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rules</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>sym</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>name</span></span><span>
                                  </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>str</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                        </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../HOL/HOL/Sum_Type.html#Sum_Type.Inl|const"><span>Inl</span></a><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_BI.PhiTool_Symbol.html#PhiTool_Symbol.symbol|type"><span>symbol</span></a><span>‚Ä∫</span></span></span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span>‚Ä∫</span></span></span><span>‚Ä∫</span></span><span>
                                                </span><span>$</span><span> </span><span class="entity"><span>Phi_Tool_Symbol.mk_symbol</span></span><span> </span><span class="entity"><span>str</span></span><span>
                                   </span><span class="main"><span>|</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>=&gt;</span></span><span>
                                        </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../HOL/HOL/Sum_Type.html#Sum_Type.Inr|const"><span>Inr</span></a><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span>‚Ä∫</span></span></span><span> </span><span class="quoted"><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Type</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_BI.PhiTool_Symbol.html#PhiTool_Symbol.symbol|type"><span>symbol</span></a><span>‚Ä∫</span></span></span><span>‚Ä∫</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>HOLogic.mk_nat</span></span><span> </span><span class="entity"><span>i</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>csym</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Thm.cterm_of</span><span> </span><span class="entity"><span>ctxt</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">Const</span><span class="hidden">&gt;</span></span></span><span>‚Äπ</span><a class="entity_ref" href="../../../../../PhSm_Ag_Base.html#PhSm_Ag_Base.\&lt;A&gt;ctr_arg|const"><span>ùíúctr_arg</span></a><span>‚Ä∫</span></span><span> </span><span>$</span><span> </span><span class="entity"><span>sym</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rules'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>map</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>tag</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>Drule.infer_instantiate</span><span> </span><span class="entity"><span>ctxt</span></span><span>
                                              </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"A"</span></span><span class="main"><span>,</span></span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>csym</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Logic_Programming_Reasoner.PLPR.html#PLPR.Action_Tag_I|fact"><span>Action_Tag_I</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                             </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>rule</span></span><span> </span><span>RS</span><span> </span><span class="entity"><span>tag</span></span><span>
                            </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span> </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>rules</span></span><span>
                   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pos</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>rules'</span></span><span class="main"><span>)</span></span><span>
                  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span> </span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>args0</span></span><span>

            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>ctxt''</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>Generic_Variable_Access.register_value_spec_thms_no_dup</span></span><span> </span><span class="main"><span>(</span></span><span>K</span><span> </span><span>I</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>pos_rules</span></span><span> </span><span class="entity"><span>ctxt'</span></span><span>
            </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>rule'</span></span><span> </span><span class="main"><span>=</span></span><span>
                </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>thm'</span></span><span> </span><a class="entity_ref" href="../../../../../PhSm_Ag_Base.html#PhSm_Ag_Base.op_construct_aggregate_\&lt;phi&gt;app|fact"><span>op_construct_aggregate_œÜapp</span></a><span class="antiquote"><span>}</span></span></span></span><span>
                  </span><span>|&gt;</span><span> </span><span>Thm.transfer'</span><span> </span><span class="entity"><span>ctxt''</span></span><span>
                  </span><span>|&gt;</span><span> </span><span>Thm.instantiate</span><span> </span><span class="main"><span>(</span></span><span>TVars.empty</span><span class="main"><span>,</span></span><span> </span><span>Vars.make</span><span> </span><span class="main"><span>[</span></span><span>
                        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"constructor"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>‚áí</span></span><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span>‚Ä∫</span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctor</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
                        </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"args"</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>0</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="operator"><span><span class="hidden">\&lt;^</span><span class="control">typ</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span>‚Äπ</span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.VAL|type"><span>VAL</span></a><span> </span><a class="entity_ref" href="../../../../../../Phi_Semantics_Framework/Phi_Semantics_Framework.html#Phi_Semantics_Framework.\&lt;phi&gt;arg|type"><span>œÜarg</span></a><span> </span><a class="entity_ref" href="../../../../../../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span>‚Ä∫</span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span>
                      </span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>
                  </span><span>|&gt;</span><span> </span><span class="entity"><span>Phi_Reasoner.reason1</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="inner_quoted"><span>"Fail to construct "</span></span><span> </span><span>^</span><span> </span><span class="entity"><span>kind'</span></span><span class="main"><span>)</span></span><span> </span><span>NONE</span><span> </span><span class="main"><span>(</span></span><span>SOME</span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>ctxt''</span></span><span>
         </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt'</span></span><span> </span><span class="comment1"><span>(*not ctxt''!*)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Phi_Apply.apply1</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>rule'</span></span><span class="main"><span>]</span></span><span> </span><span class="entity"><span>ctxt''</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>invoke</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>error</span><span> </span><span class="inner_quoted"><span>"BUG 2CG4WNzYQqirWulpFUkQQA"</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.meta_apply</span></span><span> </span><span class="entity"><span>cfg</span></span><span> </span><span class="entity"><span>settings</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>priority</span></span><span> </span><span class="main"><span>%</span></span><span>œÜlang_push_val</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="entity"><span>invoke</span></span><span> </span><span class="entity"><span>stat</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>



</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>gen_dot_triangle_opr</span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="entity"><span>right_arity</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cfg</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vals0</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>stack</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt0</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent0</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>chk_vals</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>v</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>SOME</span><span> </span><span class="entity"><span>v</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>chk_vals</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>[</span></span><span> </span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>NONE</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>chk_vals</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Bad ‚Ä£ operation "</span></span><span> </span><span>^</span><span> </span><span>Position.here</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>right_operands</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>Generic_Variable_Access.extract_values</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_numeral"><span>~1</span></span><span class="main"><span>,</span></span><span> </span><span>true</span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt0</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent0</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span>length</span><span> </span><span class="entity"><span>right_operands</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>right_arity</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>)</span></span><span>
              </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.error_arity_opr</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"right"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>right_arity</span></span><span class="main"><span>,</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>right_operands</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vals0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>right_operands</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"‚Ä£"</span></span><span>
                                </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>chk_vals</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>vals0</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>right_operands</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span>tl</span><span> </span><span class="entity"><span>right_operands</span></span><span class="main"><span>)</span></span><span>
                                </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>[</span></span><span class="entity"><span>chk_vals</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>vals0</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>right_operands</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>collect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>poss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>valss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.Meta_Opr</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"‚Ä£"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vals</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>L</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="entity"><span>collect</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pos</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>poss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>chk_vals</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>vals</span></span><span>::</span><span class="entity"><span>valss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>L</span></span><span class="main"><span>)</span></span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>collect</span></span><span> </span><span class="entity"><span>ret_L</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>ret_L</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>poss</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vals</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stack'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>collect</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>name</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="inner_quoted"><span>"‚Ä£"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>[</span></span><span class="entity"><span>pos</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vals0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stack</span></span><span class="main"><span>)</span></span><span>
      </span><span class="comment1"><span>(*val (args', (ctxt',sequent')) =
              Generic_Variable_Access.extract_values (length poss, true) (ctxt,sequent)*)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>poss</span></span><span> </span><span>~~</span><span> </span><span>map</span><span> </span><span>the</span><span> </span><span class="main"><span>(</span></span><span>tl</span><span> </span><span class="entity"><span>vals</span></span><span class="main"><span>)</span></span><span>

      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>idx_input'0</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>mk_element_index_input_internal</span></span><span> </span><span class="entity"><span>args</span></span><span> </span><span class="entity"><span>ctxt</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>idx_input</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>idx_input'0</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt'3</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent'3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
              </span><span class="entity"><span>Generic_Variable_Access.push_values</span></span><span> </span><span class="main"><span>(</span></span><span>the_list</span><span> </span><span class="main"><span>(</span></span><span>hd</span><span> </span><span class="entity"><span>vals</span></span><span class="main"><span>)</span></span><span> </span><span>@</span><span> </span><span class="entity"><span>right_operands</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt'2</span></span><span class="main"><span>,</span></span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>F</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cfg</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>name</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stack'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx_input</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'3</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent'3</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>err_assignment</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span>error</span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"Bad Syntax: The assignment does not assign to a (generic) variable."</span></span><span> </span><span>^</span><span>
         </span><span>Position.here</span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dot_triangle_assignment</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>gen_dot_triangle_opr</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stack</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx_input</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>stack'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vname</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
          </span><span class="keyword2"><span class="keyword"><span>case</span></span></span><span> </span><span class="entity"><span>stack</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>of</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Opr_Stack.Meta_Opr</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"$"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Phi_Opr_Stack.String_Param</span></span><span> </span><span class="entity"><span>vname</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>stack'</span></span><span class="main"><span>)</span></span><span>
                </span><span class="main"><span>=&gt;</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>stack'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vname</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span>
             </span><span class="main"><span>|</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="entity"><span>err_assignment</span></span><span> </span><span class="entity"><span>pos</span></span><span>
     </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>stack'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>Generic_Variable_Access.assignment_cmd</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span>Binding.make</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>vname</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx_input</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  </span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>
 

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dot_triangle_opr</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>gen_dot_triangle_opr</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cfg</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stack'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx_input</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'3</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent'3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>rw_access</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>œÜoverloading</span></span><span> "</span><span>‚Ä£</span><span>"</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="inner_quoted"><span>""</span></span><span class="main"><span>)</span></span><span> </span><span>true</span><span> </span><span class="entity"><span>idx_input</span></span><span> </span><span class="entity"><span>cfg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>stack'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt'3</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent'3</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>dot_triangle_update_opr</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="entity"><span>gen_dot_triangle_opr</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cfg</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stack'</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>idx_input</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>ctxt'3</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent'3</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
    </span><span class="entity"><span>rw_access</span></span><span> </span><span class="main"><span>(</span></span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>œÜoverloading</span></span><span> "</span><span>‚Ä£</span><span>"</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>œÜoverloading</span></span><span> "</span><span>:=</span><span>"</span><span class="antiquote"><span>}</span></span></span><span class="main"><span>)</span></span><span> </span><span>false</span><span> </span><span class="entity"><span>idx_input</span></span><span> </span><span class="entity"><span>cfg</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>stack'</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>ctxt'3</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>sequent'3</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>)</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>calc_dot_priority</span></span><span> </span><span class="entity"><span>oprs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword3"><span class="keyword"><span>open</span></span></span><span> </span><span>Phi_Opr_Stack</span><span>
      </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>is_the_first</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Meta_Opr</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"‚Ä£"</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>false</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_the_first</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Meta_Opr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pr</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>L</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>pr</span></span><span> </span><span>&gt;</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>priority</span></span><span> </span><span class="main"><span>%</span></span><span>œÜlang_app</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>is_the_first</span></span><span> </span><span class="entity"><span>L</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>true</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_the_first</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Opr</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>pr</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>L</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
            </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>pr</span></span><span> </span><span>&gt;</span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>priority</span></span><span> </span><span class="main"><span>%</span></span><span>œÜlang_app</span><span class="antiquote"><span>}</span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="entity"><span>is_the_first</span></span><span> </span><span class="entity"><span>L</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span>true</span><span>
        </span><span class="main"><span>|</span></span><span> </span><span class="entity"><span>is_the_first</span></span><span> </span><span class="main"><span>_</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>true</span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>is_the_first</span></span><span> </span><span class="entity"><span>oprs</span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>priority</span></span><span> </span><span class="quasi_keyword"><span>loose</span></span><span> </span><span class="main"><span>%</span></span><span>œÜlang_push_val</span><span class="main"><span>+</span></span><span>1</span><span class="antiquote"><span>}</span></span></span></span><span>
      </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>priority</span></span><span> </span><span class="quasi_keyword"><span>loose</span></span><span> </span><span class="main"><span>%</span></span><span>œÜlang_dot_opr</span><span class="main"><span>+</span></span><span>1</span><span class="antiquote"><span>}</span></span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>mk_dot_opr</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>oprs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="entity"><span>calc_dot_priority</span></span><span> </span><span class="entity"><span>oprs</span></span><span class="main"><span>,</span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>priority</span></span><span> </span><span class="main"><span>%</span></span><span>œÜlang_dot_opr</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>,</span></span><span>
        </span><span class="main"><span>(</span></span><span class="entity"><span>VAR_ARITY_IN_OPSTACK</span></span><span class="main"><span>,</span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"‚Ä£"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>dot_triangle_opr</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>build_dot_opr_stack</span></span><span> </span><span class="entity"><span>cfg</span></span><span> </span><span class="entity"><span>idxs</span></span><span> </span><span class="entity"><span>oprs</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="comment1"><span>(*val mode = Phi_Working_Mode.mode1 (#1 (#2 opr_ctxt))
      val (_, _, oprs, stat) = Phi_Opr_Stack.eval_until
              (Context.Proof (#1 (#2 opr_ctxt)))
              (lprio, ~1)
              (mode, true, cfg)
              (NONE, Markup.operator, ("", Position.none))
              (#1 opr_ctxt) (#2 opr_ctxt)
              *)</span></span><span>
      </span><span class="keyword1"><span class="keyword"><span>val</span></span></span><span> </span><span class="entity"><span>last</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span>length</span><span> </span><span class="entity"><span>idxs</span></span><span> </span><span>-</span><span> </span><span class="inner_numeral"><span>1</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span>fold_index</span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>i</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="entity"><span>vals</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="entity"><span>L</span></span><span> </span><span class="main"><span>=&gt;</span></span><span>
        </span><span class="entity"><span>Phi_Opr_Stack.Meta_Opr</span></span><span> </span><span class="main"><span>(</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>last</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>priority</span></span><span> </span><span class="quasi_keyword"><span>loose</span></span><span> </span><span class="main"><span>%</span></span><span>œÜlang_push_val</span><span class="antiquote"><span>}</span></span></span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="antiquoted"><span class="entity"><span class="antiquote"><span>@{</span></span><span class="operator"><span>priority</span></span><span> </span><span class="quasi_keyword"><span>loose</span></span><span> </span><span class="main"><span>%</span></span><span>œÜlang_dot_opr</span><span class="antiquote"><span>}</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span>SOME</span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>last</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_numeral"><span>0</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_numeral"><span>1</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>last</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="inner_quoted"><span>"&lt;val&gt;"</span></span><span> </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="inner_quoted"><span>"‚Ä£"</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span>
            </span><span class="main"><span>#</span></span><span>id </span><span class="entity"><span>cfg</span></span><span class="main"><span>,</span></span><span>
            </span><span>NONE</span><span class="main"><span>,</span></span><span>
            </span><span class="entity"><span>vals</span></span><span class="main"><span>,</span></span><span>
            </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>if</span></span></span><span> </span><span class="entity"><span>i</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="entity"><span>last</span></span><span> </span><span class="keyword2"><span class="keyword"><span>then</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span class="keyword"><span>fn</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>vals</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=&gt;</span></span><span> </span><span>apsnd</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>Generic_Variable_Access.push_values</span></span><span> </span><span class="entity"><span>vals</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
             </span><span class="keyword2"><span class="keyword"><span>else</span></span></span><span> </span><span class="entity"><span>dot_triangle_opr</span></span><span class="main"><span>)</span></span><span>
          </span><span class="main"><span>)</span></span><span> </span><span>::</span><span> </span><span class="entity"><span>L</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>idxs</span></span><span> </span><span class="entity"><span>oprs</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>
  

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>open_bracket_opr</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>cfg</span></span><span> </span><span class="entity"><span>opr_ctxt</span></span><span> </span><span class="main"><span>=</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>let</span></span></span><span> </span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>invoke</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cfg</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>_</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>stack</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stat</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
           </span><span class="main"><span>(</span></span><span>apfst</span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>build_dot_opr_stack</span></span><span> </span><span class="entity"><span>cfg</span></span><span> </span><span class="entity"><span>args</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>stack</span></span><span class="main"><span>,</span></span><span> </span><span class="entity"><span>stat</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword2"><span class="keyword"><span>in</span></span></span><span> </span><span class="entity"><span>Phi_Opr_Stack.meta_apply</span></span><span> </span><span class="entity"><span>cfg</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="inner_quoted"><span>"["</span></span><span class="main"><span>,</span></span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>,</span></span><span class="main"><span>(</span></span><span>NONE</span><span class="main"><span>,</span></span><span class="entity"><span>pos</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
                               </span><span class="main"><span>(</span></span><span class="entity"><span>calc_dot_priority</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>opr_ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>invoke</span></span><span> </span><span class="entity"><span>opr_ctxt</span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="keyword"><span>fun</span></span></span><span> </span><span class="entity"><span>close_bracket</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="entity"><span>cfg</span></span><span> </span><span class="entity"><span>opr_ctxt</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="main"><span>(</span></span><span>
  </span><span class="entity"><span>Phi_Opr_Stack.check_meta_apply_balance</span></span><span> </span><span class="inner_quoted"><span>"["</span></span><span> </span><span class="entity"><span>pos</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>#</span></span><span class="inner_numeral"><span>1</span></span><span> </span><span class="entity"><span>opr_ctxt</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>;</span></span><span>
  </span><span class="entity"><span>Phi_Opr_Stack.close_parenthesis</span></span><span> </span><span class="main"><span>(</span></span><span class="entity"><span>cfg</span></span><span class="main"><span>,</span></span><span> </span><span>NONE</span><span class="main"><span>,</span></span><span> </span><span>false</span><span class="main"><span>)</span></span><span> </span><span class="entity"><span>opr_ctxt</span></span><span> </span><span class="main"><span>)</span></span><span>


</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre>
</body>

</html>